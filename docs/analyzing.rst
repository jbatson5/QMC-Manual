.. _analyzing:

Analyzing QMCPACK data
======================

.. _qmca:

Using the qmca tool to obtain total energies and related quantities
-------------------------------------------------------------------

The ``qmca`` tool is the primary means of analyzing scalar-valued data
generated by QMCPACK. Output files that contain scalar-valued data are
``*.scalar.dat`` and ``*.dmc.dat`` (see :ref:`output-overview` for a detailed description of these files).
Quantities that are available for analysis in ``*.scalar.dat`` files
include the local energy and its variance, kinetic energy, potential
energy and its components, acceptance ratio, and the average CPU time
spent per block, among others. The ``*.dmc.dat`` files provide
information regarding the DMC walker population in addition to the local
energy.

Basic capabilities of ``qmca`` include calculating mean values and
associated error bars, processing multiple files at once in batched
fashion, performing twist averaging, plotting mean values by series, and
plotting traces (per block or step) of the underlying data. These
capabilities are explained with accompanying examples in the following
subsections.

To use ``qmca``, installations of Python and NumPy must be present on
the local machine. For graphical plotting, the matplotlib module must
also be available.

An overview of all supported input flags to ``qmca`` can be obtained by
typing ``qmca`` at the command line with no other inputs (also try
``qmca -x`` for a short list of examples):

::

  >qmca
    no files provided, please see help info below

    Usage: qmca [options] [file(s)]

    Options:
      --version             show program's version number and exit
      -v, --verbose         Print detailed information (default=False).
      -q QUANTITIES, --quantities=QUANTITIES
                            Quantity or list of quantities to analyze.  See names
                            and abbreviations below (default=all).
      -u UNITS, --units=UNITS
                            Desired energy units.  Can be Ha (Hartree), Ry
                            (Rydberg), eV (electron volts), kJ_mol (k.
                            joule/mole), K (Kelvin), J (Joules) (default=Ha).
      -e EQUILIBRATION, --equilibration=EQUILIBRATION
                            Equilibration length in blocks (default=auto).
      -a, --average         Average over files in each series (default=False).
      -w WEIGHTS, --weights=WEIGHTS
                            List of weights for averaging (default=None).
      -b, --reblock         (pending) Use reblocking to calculate statistics
                            (default=False).
      -p, --plot            Plot quantities vs. series (default=False).
      -t, --trace           Plot a trace of quantities (default=False).
      -h, --histogram       (pending) Plot a histogram of quantities
                            (default=False).
      -o, --overlay         Overlay plots (default=False).
      --legend=LEGEND       Placement of legend.  None for no legend, outside for
                            outside legend (default=upper right).
      --noautocorr          Do not calculate autocorrelation. Warning: error bars
                            are no longer valid! (default=False).
      --noac                Alias for --noautocorr (default=False).
      --sac                 Show autocorrelation of sample data (default=False).
      --sv                  Show variance of sample data (default=False).
      -i, --image           (pending) Save image files (default=False).
      -r, --report          (pending) Write a report (default=False).
      -s, --show_options    Print user provided options (default=False).
      -x, --examples        Print examples and exit (default=False).
      --help                Print help information and exit (default=False).
      -d DESIRED_ERROR, --desired_error=DESIRED_ERROR
                            Show number of samples needed for desired error bar
                            (default=none).
      -n PARTICLE_NUMBER, --enlarge_system=PARTICLE_NUMBER
                            Show number of samples needed to maintain error bar on
                            larger system: desired particle number first, current
                            particle number second (default=none)

.. _qmca-mean-error:

Obtaining a statistically correct mean and error bar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A rough guess at the mean and error bar of the local energy can be
obtained in the following way with ``qmca``:

::

  >qmca -q e qmc.s000.scalar.dat
  qmc  series 0  LocalEnergy           =  -45.876150 +/- 0.017688

In this case the VMC energy of an 8-atom cell of diamond is estimated to
be :math:`-45.876(2)` Hartrees (Ha). This rough guess should not be used
for production-level or publication-quality estimates.

To obtain production-level results, the underlying data should first be
inspected visually to ensure that all data included in the averaging can
be attributed to a distribution sharing the same mean. The first steps
of essentially any MC calculation (the “equilibration phase”) do not
belong to the equilibrium distribution and should be excluded from
estimates of the mean and its error bar.

We can plot a data trace (``-t``) of the local energy in the
following way:

::

  >qmca -t -q e -e 0 qmc.s000.scalar.dat

.. _fig4:
.. figure:: /figs/qmca_mean_error_trace.pdf
  :width: 400
  :align: center

  Trace of the VMC local energy for an 8-atom cell of diamond generated
  with ``qmca``. The x-axis (“samples”) refers to the VMC block index in
  this case.

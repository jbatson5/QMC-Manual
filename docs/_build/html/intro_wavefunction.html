

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Trial wavefunction specificaion &mdash; QMC Manual 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Hamiltonian and Observables" href="hamiltonianobservable.html" />
    <link rel="prev" title="Specifying the system to be simulated" href="simulationcell.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> QMC Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features of QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Obtaining, installing, and validating QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units used in QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_overview.html">Input file overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulationcell.html">Specifying the system to be simulated</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Trial wavefunction specificaion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-determinant-wavefunctons">Single determinant wavefunctons</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-particle-orbitals">Single-particle orbitals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spline-basis-sets">Spline basis sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gaussian-basis-tests">Gaussian basis tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#detailed-description-of-attributes">Detailed description of attributes:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hybrid-orbital-representation">Hybrid orbital representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plane-wave-basis-sets">Plane-wave basis sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#homogeneous-electron-gas">Homogeneous electron gas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jastrow-factors">Jastrow Factors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#one-body-jastrow-functions">One-body Jastrow functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#input-specification">Input Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#two-body-jastrow-functions">Two-body Jastrow functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Input Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-functional-form">User defined functional form</a></li>
<li class="toctree-l3"><a class="reference internal" href="#long-ranged-jastrow-factors">Long-ranged Jastrow factors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#long-ranged-jastrow-k-space-jastrow">Long-ranged Jastrow: k-space Jastrow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#three-body-jastrow-functions">Three-body Jastrow functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id20">Example use case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multideterminant-wavefunctions">Multideterminant wavefunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#backflow-wavefunctions">Backflow Wavefunctions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-specifications">Input specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">Example Use Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimization-tips">Optimization Tips</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#get-a-good-starting-guess-for-psi-t">Get a good starting guess for <span class="math notranslate nohighlight">\(\Psi_T\)</span>:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimizing-backflow-terms">Optimizing Backflow Terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tweaking-the-optimization-run">Tweaking the Optimization Run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#finite-difference-linear-response-wave-functions">Finite-difference linear response wave functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id26">Input specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">Example Use Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gaussian-product-wavefunction">Gaussian Product Wavefunction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id28">Example Use Case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hamiltonianobservable.html">Hamiltonian and Observables</a></li>
<li class="toctree-l1"><a class="reference internal" href="methods.html">Quantum Monte Carlo Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_overview.html">Output Overview</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QMC Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Trial wavefunction specificaion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/intro_wavefunction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="trial-wavefunction-specificaion">
<span id="intro-wavefunction"></span><h1>Trial wavefunction specificaion<a class="headerlink" href="#trial-wavefunction-specificaion" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="trial-intro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This section describes the input blocks associated with the specification of the trial wavefunction in a QMCPACK calculation. These sections are contained within the <code class="docutils literal notranslate"><span class="pre">&lt;wavefunction&gt;</span></code> <span class="math notranslate nohighlight">\(...\)</span>  <code class="docutils literal notranslate"><span class="pre">&lt;/wavefunction&gt;</span></code> xml blocks. <strong>Users are expected to rely on converters to generate the input blocks described in this section.</strong> The converters and the workflows are designed such that input blocks require minimum modifications from users. Unless the workflow requires modification of wavefunction blocks (e.g., setting the cutoff in a multideterminant calculation), only expert users should directly alter them.</p>
<p>The trial wavefunction in QMCPACK has a general product form:</p>
<div class="math notranslate nohighlight" id="equation-eq1">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq1" title="Permalink to this equation">¶</a></span>\[\Psi_T(\vec{r}) = \prod_k \Theta_k(\vec{r}) ,\]</div>
<p>where each <span class="math notranslate nohighlight">\(\Theta_k(\vec{r})\)</span> is a function of the electron coordinates
(and possibly ionic coordinates and variational parameters).
For problems involving electrons, the overall trial wavefunction
must be antisymmetric with respect to electron exchange,
so at least one of the functions in the product must be
antisymmetric. Notice that, although QMCPACK allows for the
construction of arbitrary trial wavefunctions based on the
functions implemented in the code
(e.g., slater determinants, jastrow functions),
the user must make sure that a correct wavefunction is
used for the problem at hand. From here on, we assume a
standard trial wavefunction for an electronic structure problem</p>
<div class="math notranslate nohighlight" id="equation-eq2">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq2" title="Permalink to this equation">¶</a></span>\[Psi_T(\vec{r}) =  \textit{A}(\vec{r}) \prod_k \textit{J}_k(\vec{r}),\]</div>
<p>where <span class="math notranslate nohighlight">\(\textit{A}(\vec{r})\)</span>
is one of the antisymmetric functions: (1) slater determinant, (2) multislater determinant, or (3) pfaffian and <span class="math notranslate nohighlight">\(\textit{J}_k\)</span>
is any of the Jastrow functions (described in <a class="reference internal" href="#jastrow"><span class="std std-ref">Jastrow Factors</span></a>).  The antisymmetric functions are built from a set of single particle orbitals <code class="docutils literal notranslate"><span class="pre">(sposet)</span></code>. QMCPACK implements four different types of <code class="docutils literal notranslate"><span class="pre">sposet</span></code>, described in the following section. Each <code class="docutils literal notranslate"><span class="pre">sposet</span></code> is designed for a different type of calculation, so their definition and generation varies accordingly.</p>
</div>
<div class="section" id="single-determinant-wavefunctons">
<span id="singledeterminant"></span><h2>Single determinant wavefunctons<a class="headerlink" href="#single-determinant-wavefunctons" title="Permalink to this headline">¶</a></h2>
<p>Placing a single determinant for each spin is the most used ansatz for the antisymmetric part of a trial wavefunction.
The input xml block for <code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code> is given in <a class="reference internal" href="#listing-1"><span class="std std-ref">Listing 1</span></a>. A list of options is given in
<a class="reference internal" href="#table2"><span class="std std-numref">Table 2</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code> element:</p>
<table class="docutils align-default" id="table2">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">determinantset</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Child elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">determinant</span></code></p></td>
</tr>
</tbody>
</table>
<p>Attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 14%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Datatype</p></th>
<th class="head"><p>Values</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">delay_rank</span></code></p></td>
<td><p>Integer</p></td>
<td><p>&gt;=0</p></td>
<td><p>1</p></td>
<td><p>Number of delayed updates.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">optimize</span></code></p></td>
<td><p>Text</p></td>
<td><p>yes/no</p></td>
<td><p>yes</p></td>
<td><p>Enable orbital optimization.</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong>Table 2 Options for the <code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code> xml-block.</strong></p><div class="literal-block-wrapper docutils container" id="listing-1">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text">Slaterdeterminant set XML element.</span><a class="headerlink" href="#listing-1" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">slaterdeterminant</span> <span class="n">delay_rank</span><span class="o">=</span><span class="s2">&quot;32&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">determinant</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;updet&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;208&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">occupation</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ground&quot;</span> <span class="n">spindataset</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">occupation</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">determinant</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">determinant</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;downdet&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;208&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">occupation</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ground&quot;</span> <span class="n">spindataset</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">occupation</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">determinant</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">slaterdeterminant</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>Additional information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">delay_rank</span></code> This option enables delayed updates of the Slater matrix inverse when particle-by-particle move is used.
By default or if <code class="docutils literal notranslate"><span class="pre">delay_rank=0</span></code> given in the input file, QMCPACK sets 1 for Slater matrices with a leading dimension <span class="math notranslate nohighlight">\(&lt;192\)</span> and 32 otherwise.
<code class="docutils literal notranslate"><span class="pre">delay_rank=1</span></code> uses the Fahy’s variant <a class="bibtex reference internal" href="#fahy1990" id="id1">[FWL90]</a> of the Sherman-Morrison rank-1 update, which is mostly using memory bandwidth-bound BLAS-2 calls.
With <code class="docutils literal notranslate"><span class="pre">delay_rank&gt;1</span></code>, the delayed update algorithm <a class="bibtex reference internal" href="#luo2018delayedupdate" id="id2">[LK18]</a><a class="bibtex reference internal" href="#mcdaniel2017" id="id3">[MDAzevedoL+17]</a> turns most of the computation to compute bound BLAS-3 calls.
Tuning this parameter is highly recommended to gain the best performance on medium-to-large problem sizes (<span class="math notranslate nohighlight">\(&gt;200\)</span> electrons).
We have seen up to an order of magnitude speedup on large problem sizes.
When studying the performance of QMCPACK, a scan of this parameter is required and we recommend starting from 32.
The best <code class="docutils literal notranslate"><span class="pre">delay_rank</span></code> giving the maximal speedup depends on the problem size.
Usually the larger <code class="docutils literal notranslate"><span class="pre">delay_rank</span></code> corresponds to a larger problem size.
On CPUs, <code class="docutils literal notranslate"><span class="pre">delay_rank</span></code> must be chosen as a multiple of SIMD vector length for good performance of BLAS libraries.
The best <code class="docutils literal notranslate"><span class="pre">delay_rank</span></code> depends on the processor microarchitecture.
GPU support is under development.</p></li>
</ul>
</div>
<div class="section" id="single-particle-orbitals">
<span id="singleparticle"></span><h2>Single-particle orbitals<a class="headerlink" href="#single-particle-orbitals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="spline-basis-sets">
<span id="spo-spline"></span><h3>Spline basis sets<a class="headerlink" href="#spline-basis-sets" title="Permalink to this headline">¶</a></h3>
<p>In this section we describe the use of spline basis sets to expand the <code class="docutils literal notranslate"><span class="pre">sposet</span></code>.
Spline basis sets are designed to work seamlessly with plane wave DFT code (e.g.,Quantum ESPRESSO as a trial wavefunction generator).</p>
<p>In QMC algorithms, all the SPOs <span class="math notranslate nohighlight">\(\{\phi(\vec{r})\}\)</span> need to be updated
every time a single electron moves. Evaluating SPOs takes a very large portion of computation time.
In principle, PW basis set can be used to express SPOs directly in QMC, as in DFT.
But it introduces an unfavorable scaling because the basis set size increases linearly as the system size.
For this reason, it is efficient to use a localized basis with compact
support and a good transferability from the plane wave basis.</p>
<p>In particular, 3D tricubic B-splines provide a basis in which only
64 elements are nonzero at any given point in <a class="bibtex reference internal" href="#blips4qmc" id="id4">[AlfeG04]</a>.
The 1D cubic B-spline is given by</p>
<div class="math notranslate nohighlight" id="equation-eq3">
<span class="eqno">(3)<a class="headerlink" href="#equation-eq3" title="Permalink to this equation">¶</a></span>\[f(x) = \sum_{i'=i-1}^{i+2} b^{i'\!,3}(x)\,\,  p_{i'},\]</div>
<p>where <span class="math notranslate nohighlight">\(b^{i}(x)\)</span> is the piecewise cubic polynomial basis functions
and <span class="math notranslate nohighlight">\(i = \text{floor}(\Delta^{-1} x)\)</span> is the index of the first
grid point <span class="math notranslate nohighlight">\(\le x\)</span>. Constructing a tensor product in each
Cartesian direction, we can represent a 3D orbital as</p>
<div class="math notranslate nohighlight" id="equation-eq4">
<span class="eqno">(4)<a class="headerlink" href="#equation-eq4" title="Permalink to this equation">¶</a></span>\[\phi_n(x,y,z) =
    \!\!\!\!\sum_{i'=i-1}^{i+2} \!\! b_x^{i'\!,3}(x)
    \!\!\!\!\sum_{j'=j-1}^{j+2} \!\! b_y^{j'\!,3}(y)
    \!\!\!\!\sum_{k'=k-1}^{k+2} \!\! b_z^{k'\!,3}(z) \,\, p_{i', j', k',n}.\]</div>
<p>This allows the rapid evaluation of each orbital in constant time.
Furthermore, this basis is systematically improvable with a single spacing
parameter so that accuracy is not compromised compared with the plane wave basis.</p>
<p>The use of 3D tricubic B-splines greatly improves computational efficiency.
The gain in computation time from a plane wave basis set to an equivalent B-spline basis set
becomes increasingly large as the system size grows.
On the downside, this computational efficiency comes at
the expense of increased memory use, which is easily overcome, however, by the large
aggregate memory available per node through OpenMP/MPI hybrid QMC.</p>
<p>The input xml block for the spline SPOs is given in <a class="reference internal" href="#listing-2"><span class="std std-ref">Listing 2</span></a>. A list of options is given in
<a class="reference internal" href="#table3"><span class="std std-numref">Table 3</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="listing-2">
<div class="code-block-caption"><span class="caption-number">Listing 2 </span><span class="caption-text">Determinant set XML element.</span><a class="headerlink" href="#listing-2" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">determinantset</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;bspline&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;i&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;pwscf.h5&quot;</span>
                <span class="n">tilematrix</span><span class="o">=</span><span class="s2">&quot;1 1 3 1 2 -1 -2 1 0&quot;</span> <span class="n">twistnum</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span> <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="n">meshfactor</span><span class="o">=</span><span class="s2">&quot;0.8&quot;</span>
                <span class="n">twist</span><span class="o">=</span><span class="s2">&quot;0  0  0&quot;</span> <span class="n">precision</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">slaterdeterminant</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">determinant</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;updet&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;208&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">occupation</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ground&quot;</span> <span class="n">spindataset</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">occupation</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">determinant</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">determinant</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;downdet&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;208&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">occupation</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ground&quot;</span> <span class="n">spindataset</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">occupation</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">determinant</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">slaterdeterminant</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">determinantset</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">determinantset</span></code> element:</p>
<table class="docutils align-default" id="table3">
<colgroup>
<col style="width: 43%" />
<col style="width: 58%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wavefunction</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Child elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code></p></td>
</tr>
</tbody>
</table>
<p>attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 10%" />
<col style="width: 22%" />
<col style="width: 8%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Datatype</p></th>
<th class="head"><p>Values</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>Text</p></td>
<td><p>Bspline</p></td>
<td></td>
<td><p>Type of <code class="docutils literal notranslate"><span class="pre">sposet</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">href</span></code></p></td>
<td><p>Text</p></td>
<td></td>
<td></td>
<td><p>Path to hdf5 file from pw2qmcpack.x.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tilematrix</span></code></p></td>
<td><p>9 integers</p></td>
<td></td>
<td></td>
<td><p>Tiling matrix used to expand supercell.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">twistnum</span></code></p></td>
<td><p>Integer</p></td>
<td></td>
<td></td>
<td><p>Index of the super twist.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">twist</span></code></p></td>
<td><p>3 floats</p></td>
<td></td>
<td></td>
<td><p>Super twist.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">meshfactor</span></code></p></td>
<td><p>Float</p></td>
<td><p><span class="math notranslate nohighlight">\(\le 1.0\)</span></p></td>
<td></td>
<td><p>Grid spacing ratio.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">precision</span></code></p></td>
<td><p>Text</p></td>
<td><p>Single/double</p></td>
<td></td>
<td><p>Precision of spline coefficients</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">gpu</span></code></p></td>
<td><p>Text</p></td>
<td><p>Yes/no</p></td>
<td></td>
<td><p>GPU switch.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">gpusharing</span></code></p></td>
<td><p>Text</p></td>
<td><p>Yes/no</p></td>
<td><p>No</p></td>
<td><p>Share B-spline table across GPUs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Spline_Size_Limit_MB</span></code></p></td>
<td><p>Integer</p></td>
<td></td>
<td></td>
<td><p>Limit B-spline table size on GPU.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">check_orb_norm</span></code></p></td>
<td><p>Text</p></td>
<td><p>Yes/no</p></td>
<td><p>Yes</p></td>
<td><p>Check norms of orbitals from h5 file.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">save_coefs</span></code></p></td>
<td><p>Text</p></td>
<td><p>Yes/no</p></td>
<td><p>No</p></td>
<td><p>Save the spline coefficients to h5 file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p>Text</p></td>
<td><p>Any</p></td>
<td><p>Ion0</p></td>
<td><p>Particle set with atomic positions.</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong>Table 3 Options for the <code class="docutils literal notranslate"><span class="pre">determinantset</span></code> xml-block associated with B-spline single particle orbital sets.</strong></p><p>Additional information:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code>. Only effective on CPU versions without mixed
precision, “single” is always imposed with mixed precision. Using
single precision not only saves memory use but also speeds up the
B-spline evaluation. We recommend using single precision since we saw
little chance of really compromising the accuracy of calculation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">meshfactor</span></code>. The ratio of actual grid spacing of B-splines used in
QMC calculation with respect to the original one calculated from h5.
A smaller meshfactor saves memory use but reduces accuracy. The
effects are similar to reducing plane wave cutoff in DFT
calculations. Use with caution!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">twistnum</span></code>. If positive, it is the index. We recommend not taking
this way since the indexing might show some uncertainty. If negative,
the super twist is referred by <code class="docutils literal notranslate"><span class="pre">twist</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_coefs</span></code>. If yes, dump the real-space B-spline coefficient
table into an h5 file on the disk. When the orbital transformation
from k space to B-spline requires more than the available amount of
scratch memory on the compute nodes, users can perform this step on
fat nodes and transfer back the h5 file for QMC calculations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpusharing</span></code>. If enabled, spline data is shared across multiple
GPUs on a given computational node. For example, on a
two-GPU-per-node system, each GPU would have half of the orbitals.
This enables larger overall spline tables than would normally fit in
the memory of individual GPUs to be used, potentially up to the total
GPU memory on a node. To obtain high performance, large electron
counts or a high-performing CPU-GPU interconnect is required. To use
this feature, the following needs to be done:</p>
<blockquote>
<div><ul class="simple">
<li><p>The CUDA Multi-Process Service (MPS) needs to be used (e.g., on</p></li>
</ul>
<p>Summit/SummitDev use “-alloc_flags gpumps” for bsub). If MPS is not
detected, sharing will be disabled.</p>
<ul class="simple">
<li><p>CUDA_VISIBLE_DEVICES needs to be properly set to control each rank’s</p></li>
</ul>
<p>visible CUDA devices (e.g., on OLCF Summit/SummitDev one needs to
create a resource set containing all GPUs with the respective number
of ranks with “jsrun –task-per-rs Ngpus -g Ngpus”).</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Spline_Size_Limit_MB</span></code>. Allows distribution of the B-spline
coefficient table between the host and GPU memory. The compute kernels
access host memory via zero-copy. Although the performance penalty
introduced by it is significant, it allows large calculations to go
through.</p></li>
</ul>
</div>
<div class="section" id="gaussian-basis-tests">
<span id="gaussianbasis"></span><h3>Gaussian basis tests<a class="headerlink" href="#gaussian-basis-tests" title="Permalink to this headline">¶</a></h3>
<p>In this section we describe the use of localized basis sets to expand the <code class="docutils literal notranslate"><span class="pre">sposet</span></code>. The general form of a single particle orbital in this case is given by:</p>
<div class="math notranslate nohighlight" id="equation-eq5">
<span class="eqno">(5)<a class="headerlink" href="#equation-eq5" title="Permalink to this equation">¶</a></span>\[\phi_i(\vec{r}) = \sum_k C_{i,k} \ \eta_k(\vec{r}),\]</div>
<p>where <span class="math notranslate nohighlight">\(\{\eta_k(\vec{r})\}\)</span> is a set of M atom-centered basis
functions and <span class="math notranslate nohighlight">\(C_{i,k}\)</span> is a coefficient matrix. This should be
used in calculations of finite systems employing an atom-centered basis
set and is typically generated by the <em>convert4qmc</em> converter. Examples
include calculations of molecules using Gaussian basis sets or
Slater-type basis functions. Initial support for periodic systems is
described in <span class="xref std std-ref">LCAO</span>. Even though this section is called
“Gaussian basis sets” (by far the most common atom-centered basis set),
QMCPACK works with any atom-centered basis set based on either spherical
harmonic angular functions or Cartesian angular expansions. The radial
functions in the basis set can be expanded in either Gaussian functions,
Slater-type functions, or numerical radial functions.</p>
<p>In this section we describe the input sections for the atom-centered basis set and the <code class="docutils literal notranslate"><span class="pre">sposet</span></code> for a single Slater determinant trial wavefunction. The input sections for multideterminant trial wavefunctions are described in <a class="reference internal" href="#multideterminants"><span class="std std-ref">Multideterminant wavefunctions</span></a>. The basic structure for the input block of a single Slater determinant is given in <a class="reference internal" href="#listing-3"><span class="std std-ref">Listing 3</span></a>.
A list of options for <code class="docutils literal notranslate"><span class="pre">determinantset</span></code> associated with this <code class="docutils literal notranslate"><span class="pre">sposet</span></code> is given in <a class="reference internal" href="#table4"><span class="std std-numref">Table 4</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="listing-3">
<div class="code-block-caption"><span class="caption-number">Listing 3 </span><span class="caption-text">Basic input block for a single determinant trial wavefunction using a <code class="docutils literal notranslate"><span class="pre">sposet</span></code> expanded on an atom-centered basis set.</span><a class="headerlink" href="#listing-3" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">wavefunction</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;psi0&quot;</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">determinantset</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">basisset</span><span class="o">&gt;</span>
       <span class="o">...</span>
     <span class="o">&lt;/</span><span class="n">basisset</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">slaterdeterminant</span><span class="o">&gt;</span>
       <span class="o">...</span>
     <span class="o">&lt;/</span><span class="n">slaterdeterminant</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">determinantset</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">wavefunction</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>The definition of the set of atom-centered basis functions is given by the <code class="docutils literal notranslate"><span class="pre">basisset</span></code> block, and the <code class="docutils literal notranslate"><span class="pre">sposet</span></code> is defined within <code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code>. The <code class="docutils literal notranslate"><span class="pre">basisset</span></code> input block is composed from a collection of <code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code> input blocks, one for each atomic species in the simulation where basis functions are centered. The general structure for <code class="docutils literal notranslate"><span class="pre">basisset</span></code> and <code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code> are given in <a class="reference internal" href="#listing-4"><span class="std std-ref">Listing 4</span></a>, and the corresponding lists of options are given in
<a class="reference internal" href="#table5"><span class="std std-numref">Table 5</span></a> and <a class="reference internal" href="#table6"><span class="std std-numref">Table 6</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">determinantset</span></code> element:</p>
<table class="docutils align-default" id="table4">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wavefunction</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Child elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">basisset</span></code> , <code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code> , <code class="docutils literal notranslate"><span class="pre">sposet</span></code> , <code class="docutils literal notranslate"><span class="pre">multideterminant</span></code></p></td>
</tr>
</tbody>
</table>
<p>Attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 13%" />
<col style="width: 14%" />
<col style="width: 12%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name/id</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>‘’ ‘’</p></td>
<td><p>Name of determinant set</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>Text</p></td>
<td><p>See below</p></td>
<td><p>‘’ ‘’</p></td>
<td><p>Type of <code class="docutils literal notranslate"><span class="pre">sposet</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">keyword</span></code></p></td>
<td><p>Text</p></td>
<td><p>NMO, GTO, STO</p></td>
<td><p>NMO</p></td>
<td><p>Type of orbital set generated</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">transform</span></code></p></td>
<td><p>Text</p></td>
<td><p>Yes/no</p></td>
<td><p>Yes</p></td>
<td><p>Transform to numerical radial functions?</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>Ion0</p></td>
<td><p>Particle set with the position of atom centers</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cuspCorrection</span></code></p></td>
<td><p>Text</p></td>
<td><p>Yes/no</p></td>
<td><p>No</p></td>
<td><p>Apply cusp correction scheme to <code class="docutils literal notranslate"><span class="pre">sposet</span></code>?</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong>Table 4 Options for the <code class="docutils literal notranslate"><span class="pre">determinantset</span></code> xml-block associated with atom-centered single particle orbital sets.</strong></p><div class="literal-block-wrapper docutils container" id="listing-4">
<div class="code-block-caption"><span class="caption-number">Listing 4 </span><span class="caption-text">Basic input block for <code class="docutils literal notranslate"><span class="pre">basisset</span></code>.</span><a class="headerlink" href="#listing-4" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">basisset</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LCAOBSet&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">atomicBasisSet</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Gaussian-G2&quot;</span> <span class="n">angular</span><span class="o">=</span><span class="s2">&quot;cartesian&quot;</span> <span class="n">elementType</span><span class="o">=</span><span class="s2">&quot;C&quot;</span> <span class="n">normalized</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">grid</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span> <span class="n">ri</span><span class="o">=</span><span class="s2">&quot;1.e-6&quot;</span> <span class="n">rf</span><span class="o">=</span><span class="s2">&quot;1.e2&quot;</span> <span class="n">npts</span><span class="o">=</span><span class="s2">&quot;1001&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">basisGroup</span> <span class="n">rid</span><span class="o">=</span><span class="s2">&quot;C00&quot;</span> <span class="n">n</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">l</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Gaussian&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">radfunc</span> <span class="n">exponent</span><span class="o">=</span><span class="s2">&quot;5.134400000000e-02&quot;</span> <span class="n">contraction</span><span class="o">=</span><span class="s2">&quot;1.399098787100e-02&quot;</span><span class="o">/&gt;</span>
      <span class="o">...</span>
    <span class="o">&lt;/</span><span class="n">basisGroup</span><span class="o">&gt;</span>
    <span class="o">...</span>
  <span class="o">&lt;/</span><span class="n">atomicBasisSet</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">atomicBasisSet</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Gaussian-G2&quot;</span> <span class="n">angular</span><span class="o">=</span><span class="s2">&quot;cartesian&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Gaussian&quot;</span> <span class="n">elementType</span><span class="o">=</span><span class="s2">&quot;C&quot;</span> <span class="n">normalized</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="o">&gt;</span>
    <span class="o">...</span>
  <span class="o">&lt;/</span><span class="n">atomicBasisSet</span><span class="o">&gt;</span>
  <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">basisset</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">basisset</span></code> element:</p>
<table class="docutils align-default" id="table5">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">determinantset</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Child elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code></p></td>
</tr>
</tbody>
</table>
<p>Attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 15%" />
<col style="width: 13%" />
<col style="width: 14%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code> / <code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>” “</p></td>
<td><p>Name of atom-centered basis set</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong>Table 5 Options for the <code class="docutils literal notranslate"><span class="pre">basisset</span></code> xml-block associated with atom-centered single particle orbital sets.</strong></p><p><code class="docutils literal notranslate"><span class="pre">AtomicBasisSet</span></code> element:</p>
<table class="docutils align-default" id="table6">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">basisset</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Child elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">grid</span></code> , <code class="docutils literal notranslate"><span class="pre">basisGroup</span></code></p></td>
</tr>
</tbody>
</table>
<p>Attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 13%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code> / <code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>” “</p></td>
<td><p>Name of atomic basis set</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">angular</span></code></p></td>
<td><p>Text</p></td>
<td><p>See below</p></td>
<td><p>Default</p></td>
<td><p>Type of angular functions</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">expandYlm</span></code></p></td>
<td><p>Text</p></td>
<td><p>See below</p></td>
<td><p>Yes</p></td>
<td><p>Expand Ylm shells?</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">expM</span></code></p></td>
<td><p>Text</p></td>
<td><p>See below</p></td>
<td><p>Yes</p></td>
<td><p>Add sign for <span class="math notranslate nohighlight">\((-1)^{m}\)</span>?</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">elementType/species</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>e</p></td>
<td><p>Atomic species where functions are centered</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">normalized</span></code></p></td>
<td><p>Text</p></td>
<td><p>Yes/no</p></td>
<td><p>Yes</p></td>
<td><p>Are single particle functions normalized?</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong>Table 6 Options for the <code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code> xml-block.</strong></p><p><code class="docutils literal notranslate"><span class="pre">basicGroup</span></code> element:</p>
<table class="docutils align-default" id="table7">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AtomicBasisSet</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Child elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">radfunc</span></code></p></td>
</tr>
</tbody>
</table>
<p>Attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rid/id</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>‘’ ‘’</p></td>
<td><p>Name of the basisGroup</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>‘’ ‘’</p></td>
<td><p>Type of basisGroup</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">n/l/m/s</span></code></p></td>
<td><p>Integer</p></td>
<td><p><em>Any</em></p></td>
<td><p>0</p></td>
<td><p>Quantum numbers of basisGroup</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong><a class="reference internal" href="#table7"><span class="std std-numref">Table 7</span></a> Options for the <code class="docutils literal notranslate"><span class="pre">basisGroup</span></code> xml-block.</strong></p><div class="literal-block-wrapper docutils container" id="listing-5">
<div class="code-block-caption"><span class="caption-number">Listing 5 </span><span class="caption-text">Basic input block for <code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code> with an atom-centered <code class="docutils literal notranslate"><span class="pre">sposet</span></code>.</span><a class="headerlink" href="#listing-5" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">&lt;</span><span class="n">slaterdeterminant</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">slaterdeterminant</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>element:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 71%" />
<col style="width: 29%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements:</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Child elements:</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>Attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 18%" />
<col style="width: 16%" />
<col style="width: 17%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name/id</span></code></p></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>‘’ ‘’</p></td>
<td><p>Name of determinant set</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Text</p></td>
<td><p><em>Any</em></p></td>
<td><p>‘’ ‘’</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="section" id="detailed-description-of-attributes">
<h4>Detailed description of attributes:<a class="headerlink" href="#detailed-description-of-attributes" title="Permalink to this headline">¶</a></h4>
<p>In the following, we give a more detailed description of all the options presented in the various xml-blocks described in this section. Only nontrivial attributes are described. Those with simple yes/no options and whose previous description is enough to explain the intended behavior are not included.</p>
<p><code class="docutils literal notranslate"><span class="pre">determinantset</span></code> attributes:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>Type of <code class="docutils literal notranslate"><span class="pre">sposet</span></code>. For atom-centered based <code class="docutils literal notranslate"><span class="pre">sposets</span></code>, use type=”MolecularOrbital” or type=“MO.”
Other options described elsewhere in this manual are “spline,”
“composite,” “pw,” “heg,” “linearopt,” etc.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">keyword/key</span></code></dt><dd><p>Type of basis set generated, which does not necessarily match the type of basis set on the input block. The three possible options are: NMO (numerical molecular orbitals), GTO (Gaussian-type orbitals), and STO (Slater-type orbitals). The default option is NMO. By default, QMCPACK will generate numerical orbitals from both GTO and STO types and use cubic or quintic spline interpolation to evaluate the radial functions. This is typically more efficient than evaluating the radial functions in the native basis (Gaussians or exponents) and allows for arbitrarily large contractions without any additional cost. To force use of the native expansion (not recommended), use GTO or STO for each type of input basis set.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">transform</span></code></dt><dd><p>Request (or avoid) a transformation of the radial functions to NMO type. The default and recommended behavior is to transform to numerical radial functions. If <code class="docutils literal notranslate"><span class="pre">transform</span></code> is set to <em>yes</em>, the option <code class="docutils literal notranslate"><span class="pre">keyword</span></code> is ignored.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cuspCorrection</span></code></dt><dd><p>Enable (disable) use of the cusp correction algorithm (CASINO REFERENCE) for a <code class="docutils literal notranslate"><span class="pre">basisset</span></code> built with GTO functions. The algorithm is implemented as described in (CASINO REFERENCE) and works only with transform=”yes” and an input GTO basis set. No further input is needed.</p>
</dd>
</dl>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code> attributes:</p>
<ul>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name/id</span></code></dt><dd><p>Name of the basis set. Names should be unique.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">angular</span></code></dt><dd><p>Type of angular functions used in the expansion. In general, two angular basis functions are allowed: “spherical” (for spherical Ylm functions) and “Cartesian” (for functions of the type <span class="math notranslate nohighlight">\(x^{n}y^{m}z^{l}\)</span>).</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">expandYlm</span></code></dt><dd><p>Determines whether each basis group is expanded across the corresponding shell of m values (for spherical type) or consistent powers (for Cartesian functions). Options:</p>
<blockquote>
<div><ul class="simple">
<li><p>“No”: Do not expand angular functions across corresponding angular shell.</p></li>
<li><p>“Gaussian”: Expand according to Gaussian03 format. This function is compatible only with angular=”spherical.” For a given input (l,m), the resulting order of the angular functions becomes (1,-1,0) for l=1 and (0,1,-1,2,-2,…,l,-l) for general l.</p></li>
<li><p>“Natural”: Expand angular functions according to (-l,-l+1,…,l-1,l).</p></li>
<li><p>“Gamess”: Expand according to Gamess’ format for Cartesian functions. Notice that this option is compatible only with angular=”Cartesian.” If angular=”Cartesian” is used, this option is not necessary.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">expM</span></code></dt><dd><p>Determines whether the sign of the spherical Ylm function associated with m (<span class="math notranslate nohighlight">\(-1^{m}\)</span>) is included in the coefficient matrix or not.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">elementType/species</span></code></dt><dd><p>Name of the species where basis functions are centered. Only one <code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code> block is allowed per species. Additional blocks are ignored. The corresponding species must exist in the <code class="docutils literal notranslate"><span class="pre">particleset</span></code> given as the <code class="docutils literal notranslate"><span class="pre">source</span></code> option to <code class="docutils literal notranslate"><span class="pre">determinantset</span></code>. Basis functions for all the atoms of the corresponding species are included in the basis set, based on the order of atoms in the <code class="docutils literal notranslate"><span class="pre">particleset</span></code>.</p>
</dd>
</dl>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">basisGroup</span></code> attributes:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>Type of input basis radial function. Note that this refers to the type of radial function in the input xml-block, which might not match the radial function generated internally and used in the calculation (if <code class="docutils literal notranslate"><span class="pre">transform</span></code> is set to “yes”). Also note that different <code class="docutils literal notranslate"><span class="pre">basisGroup</span></code> blocks within a given <code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code> can have different <code class="docutils literal notranslate"><span class="pre">types</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">n/l/m/s</span></code></dt><dd><p>Quantum numbers of the basis function. Note that if
<code class="docutils literal notranslate"><span class="pre">expandYlm</span></code> is set to <em>“yes”</em> in <code class="docutils literal notranslate"><span class="pre">atomicBasisSet</span></code>, a
full shell of basis functions with the appropriate values of
<em>“m”</em> will be defined for the corresponding value of
<em>“l.”</em> Otherwise a single basis function will be given for the
specific combination of <em>“(l,m).”</em></p>
</dd>
</dl>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">radfunc</span></code> attributes for <code class="docutils literal notranslate"><span class="pre">type</span></code> = <em>“Gaussian”</em>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TBDoc</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">slaterdeterminant</span></code> attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TBDoc</span></code></p></li>
</ul>
</div>
</div>
<div class="section" id="hybrid-orbital-representation">
<span id="spo-hybrid"></span><h3>Hybrid orbital representation<a class="headerlink" href="#hybrid-orbital-representation" title="Permalink to this headline">¶</a></h3>
<p>The hybrid representation of the single particle orbitals combines a localized atomic basis set around atomic cores and B-splines in the interstitial regions to reduce memory use while retaining high evaluation speed and either retaining or increasing overall accuracy. Full details are provided in <a class="bibtex reference internal" href="#luo2018hyb" id="id5">[LEKS18]</a>, and <strong>users of this feature are kindly requested to cite this paper</strong>.
In practice, we have seen that using a meshfactor=0.5 is often possible and achieves huge memory savings.
<a class="reference internal" href="#fig3"><span class="std std-numref">Fig. 3</span></a> illustrates how the regions are assigned.</p>
<div class="figure align-center" id="id29">
<span id="fig3"></span><a class="reference internal image-reference" href="_images/hybrid_new.jpg"><img alt="_images/hybrid_new.jpg" src="_images/hybrid_new.jpg" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Regular and hybrid orbital representation. Regular B-spline representation (left panel) contains only one region and a sufficiently fine mesh to resolve orbitals near the nucleus. The hybrid orbital representation (right panel) contains near nucleus regions (A) where spherical harmonics and radial functions are used, buffers or interpolation regions (B), and an interstitial region (C) where a coarse B-spline mesh is used.</span><a class="headerlink" href="#id29" title="Permalink to this image">¶</a></p>
</div>
<p>Orbitals within region A are computed as</p>
<div class="math notranslate nohighlight">
\[\phi^A_n({\bf r})=R_{n,l,m}(r)Y_{l,m}(\hat{r})\]</div>
<p>Orbitals in region C are computed as the regular B-spline basis described in <a class="reference internal" href="#spo-spline"><span class="std std-ref">Spline basis sets</span></a> above. The region B interpolates between A and C as</p>
<div class="math notranslate nohighlight" id="equation-eq6">
<span class="eqno">(6)<a class="headerlink" href="#equation-eq6" title="Permalink to this equation">¶</a></span>\[\phi^B_n({\bf r}) = S(r) \phi^A_n({\bf r}) + (1-S(r))\phi^C_n({\bf r})\]</div>
<div class="math notranslate nohighlight" id="equation-eq7">
<span class="eqno">(7)<a class="headerlink" href="#equation-eq7" title="Permalink to this equation">¶</a></span>\[(S(r) = \frac{1}{2}-\frac{1}{2} tanh \left[\alpha\left(\frac{r-r_{\rm A/B}}{r_{\rm B/C}-r_{\rm A/B}}-\frac{1}{2}\right)\right]\]</div>
<p>To enable hybrid orbital representation, the input XML needs to see the tag <code class="docutils literal notranslate"><span class="pre">hybridrep=&quot;yes&quot;</span></code> shown in <a class="reference internal" href="#listing-6"><span class="std std-ref">Listing 6</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="listing-6">
<div class="code-block-caption"><span class="caption-number">Listing 6 </span><span class="caption-text">Hybrid orbital representation input example.</span><a class="headerlink" href="#listing-6" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">determinantset</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;bspline&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;i&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;pwscf.h5&quot;</span>
              <span class="n">tilematrix</span><span class="o">=</span><span class="s2">&quot;1 1 3 1 2 -1 -2 1 0&quot;</span> <span class="n">twistnum</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span> <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="n">meshfactor</span><span class="o">=</span><span class="s2">&quot;0.8&quot;</span>
              <span class="n">twist</span><span class="o">=</span><span class="s2">&quot;0  0  0&quot;</span> <span class="n">precision</span><span class="o">=</span><span class="s2">&quot;single&quot;</span> <span class="n">hybridrep</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
  <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">determinantset</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>Second, the information describing the atomic regions is required in the particle set, shown in <a class="reference internal" href="#listing-7"><span class="std std-ref">Listing 7</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="listing-7">
<div class="code-block-caption"><span class="caption-number">Listing 7 </span><span class="caption-text">particleset elements for ions with information needed by hybrid orbital representation.</span><a class="headerlink" href="#listing-7" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">group</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ni&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;charge&quot;</span><span class="o">&gt;</span>          <span class="mi">18</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;valence&quot;</span><span class="o">&gt;</span>         <span class="mi">18</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;atomicnumber&quot;</span> <span class="o">&gt;</span>   <span class="mi">28</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cutoff_radius&quot;</span> <span class="o">&gt;</span> <span class="mf">1.6</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inner_cutoff&quot;</span> <span class="o">&gt;</span>  <span class="mf">1.3</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lmax&quot;</span> <span class="o">&gt;</span>            <span class="mi">5</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;spline_radius&quot;</span> <span class="o">&gt;</span> <span class="mf">1.8</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;spline_npoints&quot;</span><span class="o">&gt;</span>  <span class="mi">91</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>The parameters specific to hybrid representation are listed as</p>
<p><code class="docutils literal notranslate"><span class="pre">attrib</span></code> element</p>
<p>Attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 14%" />
<col style="width: 12%" />
<col style="width: 13%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cutoff_radius</span></code></p></td>
<td><p>Real</p></td>
<td><p>&gt;=0.0</p></td>
<td><p><em>None</em></p></td>
<td><p>Cutoff radius for B/C boundary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">lmax</span></code></p></td>
<td><p>Integer</p></td>
<td><p>&gt;=0</p></td>
<td><p><em>None</em></p></td>
<td><p>Largest angular channel</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">inner_cutoff</span></code></p></td>
<td><p>Real</p></td>
<td><p>&gt;=0.0</p></td>
<td><p>Dep.</p></td>
<td><p>Cutoff radius for A/B boundary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">spline_radius</span></code></p></td>
<td><p>Real</p></td>
<td><p>&gt;0.0</p></td>
<td><p>Dep.</p></td>
<td><p>Radial function radius used in spine</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spline_npoints</span></code></p></td>
<td><p>Integer</p></td>
<td><p>&gt;0</p></td>
<td><p>Dep.</p></td>
<td><p>Number of spline knots</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cutoff_radius</span></code>  is required for every species. If a species is intended to not be covered by atomic regions, setting the value 0.0 will put default values for all the reset parameters. A good value is usually a bit larger than the core radius listed in the pseudopotential file. After a parametric scan, pick the one from the flat energy region with the smallest variance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lmax</span></code> is required if <code class="docutils literal notranslate"><span class="pre">cutoff_radius</span></code> <span class="math notranslate nohighlight">\(&gt;\)</span> 0.0. This value usually needs to be at least the highest angular momentum plus 2.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inner_cutoff</span></code> is optional and set as <code class="docutils literal notranslate"><span class="pre">cutoff_radius</span></code> <span class="math notranslate nohighlight">\(-0.3\)</span> by default, which is fine in most cases.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spline_radius</span></code> and <code class="docutils literal notranslate"><span class="pre">spline_npoints</span></code> are optional. By default, they are calculated based on <code class="docutils literal notranslate"><span class="pre">cutoff_radius</span></code> and a grid displacement 0.02 bohr.
If users prefer inputing them, it is required that <code class="docutils literal notranslate"><span class="pre">cutoff_radius</span></code> &lt;=  <code class="docutils literal notranslate"><span class="pre">spline_radius</span></code> <span class="math notranslate nohighlight">\(-\)</span> 2 <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">spline_radius</span></code>/(<code class="docutils literal notranslate"><span class="pre">spline_npoints</span></code> <span class="math notranslate nohighlight">\(-\)</span> 1).</p></li>
</ul>
<p>In addition, the hybrid orbital representation allows extra optimization to speed up the nonlocal pseudopotential evaluation using the batched algorithm listed in <a class="reference internal" href="hamiltonianobservable.html#nlpp"><span class="std std-ref">Pseudopotentials</span></a>.</p>
</div>
<div class="section" id="plane-wave-basis-sets">
<span id="pwbasis"></span><h3>Plane-wave basis sets<a class="headerlink" href="#plane-wave-basis-sets" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="homogeneous-electron-gas">
<span id="hegbasis"></span><h3>Homogeneous electron gas<a class="headerlink" href="#homogeneous-electron-gas" title="Permalink to this headline">¶</a></h3>
<p>The interacting Fermi liquid has its own special <code class="docutils literal notranslate"><span class="pre">determinantset</span></code> for filling up a
Fermi surface.  The shell number can be specified separately for both spin-up and spin-down.
This determines how many electrons to include of each time; only closed shells are currently
implemented.  The shells are filled according to the rules of a square box; if other lattice
vectors are used, the electrons might not fill up a complete shell.</p>
<p>This following example can also be used for Helium simulations by specifying the
proper pair interaction in the Hamiltonian section.</p>
<div class="literal-block-wrapper docutils container" id="listing-8">
<div class="code-block-caption"><span class="caption-number">Listing 8 </span><span class="caption-text">2D Fermi liquid example: particle specification</span><a class="headerlink" href="#listing-8" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">qmcsystem</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">simulationcell</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;global&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rs&quot;</span> <span class="n">pol</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;74&quot;</span><span class="o">&gt;</span><span class="mf">6.5</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bconds&quot;</span><span class="o">&gt;</span><span class="n">p</span> <span class="n">p</span> <span class="n">p</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LR_dim_cutoff&quot;</span><span class="o">&gt;</span><span class="mi">15</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">simulationcell</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">particleset</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e&quot;</span> <span class="n">random</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">group</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;37&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;charge&quot;</span><span class="o">&gt;-</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mass&quot;</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">group</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;d&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;37&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;charge&quot;</span><span class="o">&gt;-</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mass&quot;</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">particleset</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">qmcsystem</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="listing-9">
<div class="code-block-caption"><span class="caption-number">Listing 9 </span><span class="caption-text">2D Fermi liquid example (Slater Jastrow wavefunction)</span><a class="headerlink" href="#listing-9" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">qmcsystem</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">wavefunction</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;psi0&quot;</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">determinantset</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;electron-gas&quot;</span> <span class="n">shell</span><span class="o">=</span><span class="s2">&quot;7&quot;</span> <span class="n">shell2</span><span class="o">=</span><span class="s2">&quot;7&quot;</span> <span class="n">randomize</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">determinantset</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;J2&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Two-Body&quot;</span> <span class="n">function</span><span class="o">=</span><span class="s2">&quot;Bspline&quot;</span> <span class="nb">print</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">speciesA</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">speciesB</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;8&quot;</span> <span class="n">cusp</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;uu&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">speciesA</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">speciesB</span><span class="o">=</span><span class="s2">&quot;d&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;8&quot;</span> <span class="n">cusp</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;ud&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="jastrow-factors">
<span id="jastrow"></span><h2>Jastrow Factors<a class="headerlink" href="#jastrow-factors" title="Permalink to this headline">¶</a></h2>
<p>Jastrow factors are among the simplest and most effective ways of including
dynamical correlation in the trial many body wavefunction.  The resulting many body
wavefunction is expressed as the product of an antisymmetric (in the case
of Fermions) or symmetric (for Bosons) part and a correlating Jastrow factor
like so:</p>
<div class="math notranslate nohighlight" id="equation-eq8">
<span class="eqno">(8)<a class="headerlink" href="#equation-eq8" title="Permalink to this equation">¶</a></span>\[\Psi(\vec{R}) = \mathcal{A}(\vec{R}) \exp\left[J(\vec{R})\right]\]</div>
<p>In this section we will detail the types and forms of Jastrow factor used
in QMCPACK.  Note that each type of Jastrow factor needs to be specified using
its own individual <code class="docutils literal notranslate"><span class="pre">jastrow</span></code> XML element.  For this reason, we have repeated the
specification of the <code class="docutils literal notranslate"><span class="pre">jastrow</span></code> tag in each section, with specialization for the
options available for that given type of Jastrow.</p>
<div class="section" id="one-body-jastrow-functions">
<span id="onebodyjastrow"></span><h3>One-body Jastrow functions<a class="headerlink" href="#one-body-jastrow-functions" title="Permalink to this headline">¶</a></h3>
<p>The one-body Jastrow factor is a form that allows for the direct inclusion
of correlations between particles that are included in the wavefunction with
particles that are not explicitly part of it.  The most common example of
this are correlations between electrons and ions.</p>
<p>The Jastrow function is specified within a <code class="docutils literal notranslate"><span class="pre">wavefunction</span></code> element
and must contain one or more <code class="docutils literal notranslate"><span class="pre">correlation</span></code> elements specifying
additional parameters as well as the actual coefficients.
<a class="reference internal" href="#bjsplineexamples"><span class="std std-ref">Example use cases</span></a> gives examples of the typical nesting of
<code class="docutils literal notranslate"><span class="pre">jastrow</span></code>, <code class="docutils literal notranslate"><span class="pre">correlation</span></code>, and <code class="docutils literal notranslate"><span class="pre">coefficient</span></code> elements.</p>
<div class="section" id="input-specification">
<h4>Input Specification<a class="headerlink" href="#input-specification" title="Permalink to this headline">¶</a></h4>
<p>Jastrow element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 21%" />
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 24%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>name</strong></p></td>
<td><p><strong>datatype</strong></p></td>
<td><p><strong>values</strong></p></td>
<td><p><strong>defaults</strong></p></td>
<td><p><strong>description</strong></p></td>
</tr>
<tr class="row-even"><td><p>name</p></td>
<td><p>text</p></td>
<td></td>
<td><p>(required)</p></td>
<td><p>Unique name
for this
Jastrow
function</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>text</p></td>
<td><p>One-body</p></td>
<td><p>(required)</p></td>
<td><p>Define a
one-body
function</p></td>
</tr>
<tr class="row-even"><td><p>function</p></td>
<td><p>text</p></td>
<td><p>Bspline</p></td>
<td><p>(required)</p></td>
<td><p>BSpline
Jastrow</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>text</p></td>
<td><p>pade2</p></td>
<td></td>
<td><p>Pade form</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>text</p></td>
<td><p>…</p></td>
<td></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>source</p></td>
<td><p>text</p></td>
<td><p>name</p></td>
<td><p>(required)</p></td>
<td><p>Name of
attribute of
classical
particle set</p></td>
</tr>
<tr class="row-even"><td><p>print</p></td>
<td><p>text</p></td>
<td><p>yes / no</p></td>
<td><p>yes</p></td>
<td><p>Jastrow
factor
printed in
external
file?</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 22%" />
<col style="width: 19%" />
<col style="width: 22%" />
<col style="width: 22%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Correlation</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>To be more concrete, the one-body Jastrow factors used to describe correlations
between electrons and ions take the form below:</p>
<div class="math notranslate nohighlight" id="equation-eq9">
<span class="eqno">(9)<a class="headerlink" href="#equation-eq9" title="Permalink to this equation">¶</a></span>\[J1=\sum_I^{ion0}\sum_i^e u_{ab}(|r_i-R_I|)\]</div>
<p>where I runs over all of the ions in the calculation, i runs over the
electrons and <span class="math notranslate nohighlight">\(u_{ab}\)</span> describes the functional form of the
correlation between them. Many different forms of <span class="math notranslate nohighlight">\(u_{ab}\)</span> are
implemented in QMCPACK. We will detail two of the most common ones
below.</p>
<div class="section" id="spline-form">
<span id="onebodyjastrowspline"></span><h5>Spline form<a class="headerlink" href="#spline-form" title="Permalink to this headline">¶</a></h5>
<p>The one-body spline Jastrow function is the most commonly used one-body
Jastrow for solids. This form was first described and used in
<a class="bibtex reference internal" href="#eslerkimceperleyshulenburger2012" id="id6">[EKCS12]</a>. Here
<span class="math notranslate nohighlight">\(u_{ab}\)</span> is an interpolating 1D B-spline (tricublc spline on a
linear grid) between zero distance and <span class="math notranslate nohighlight">\(r_{cut}\)</span>. In 3D periodic
systems the default cutoff distance is the Wigner Seitz cell radius. For
other periodicities, including isolated molecules, the <span class="math notranslate nohighlight">\(r_{cut}\)</span>
must be specified. The cusp can be set. <span class="math notranslate nohighlight">\(r_i\)</span> and <span class="math notranslate nohighlight">\(R_I\)</span> are
most commonly the electron and ion positions, but any particlesets that
can provide the needed centers can be used.</p>
<p>Correlation element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 24%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Name</strong></p></td>
<td><p><strong>Datatype</strong></p></td>
<td><p><strong>Values</strong></p></td>
<td><p><strong>Defaults</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>ElementType</p></td>
<td><p>Text</p></td>
<td><p>Name</p></td>
<td><p>See below</p></td>
<td><p>Classical
particle
target</p></td>
</tr>
<tr class="row-odd"><td><p>SpeciesA</p></td>
<td><p>Text</p></td>
<td><p>Name</p></td>
<td><p>See below</p></td>
<td><p>Classical
particle
target</p></td>
</tr>
<tr class="row-even"><td><p>SpeciesB</p></td>
<td><p>Text</p></td>
<td><p>Name</p></td>
<td><p>See below</p></td>
<td><p>Quantum
species
target</p></td>
</tr>
<tr class="row-odd"><td><p>Size</p></td>
<td><p>Integer</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>(Required)</p></td>
<td><p>Number of
coefficients</p></td>
</tr>
<tr class="row-even"><td><p>Rcut</p></td>
<td><p>Real</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>See below</p></td>
<td><p>Distance at
which the
correlation
goes to 0</p></td>
</tr>
<tr class="row-odd"><td><p>Cusp</p></td>
<td><p>Real</p></td>
<td><p><span class="math notranslate nohighlight">\(\ge 0\)</span></p></td>
<td><p>0</p></td>
<td><p>Value for
use in Kato
cusp
condition</p></td>
</tr>
<tr class="row-even"><td><p>Spin</p></td>
<td><p>Text</p></td>
<td><p>Yes or no</p></td>
<td><p>No</p></td>
<td><p>Spin
dependent
Jastrow
factor</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 22%" />
<col style="width: 19%" />
<col style="width: 22%" />
<col style="width: 22%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Coefficients</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">elementType,</span> <span class="pre">speciesA,</span> <span class="pre">speciesB,</span> <span class="pre">spin</span></code></dt><dd><p>For a spin-independent Jastrow factor (spin = “no”), elementType
should be the name of the group of ions in the classical particleset to
which the quantum particles should be correlated. For a spin-dependent
Jastrow factor (spin = “yes”), set speciesA to the group name in the
classical particleset and speciesB to the group name in the quantum
particleset.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">rcut</span></code></dt><dd><p>The cutoff distance for the function in atomic units (bohr). For 3D
fully periodic systems, this parameter is optional, and a default of the
Wigner Seitz cell radius is used. Otherwise this parameter is required.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cusp</span></code></dt><dd><p>The one-body Jastrow factor can be used to make the wavefunction
satisfy the electron-ion cusp condition :cite:<code class="docutils literal notranslate"><span class="pre">kato</span></code>. In this
case, the derivative of the Jastrow factor as the electron approaches
the nucleus will be given by</p>
</dd>
</dl>
</li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq10">
<span class="eqno">(10)<a class="headerlink" href="#equation-eq10" title="Permalink to this equation">¶</a></span>\[\left(\frac{\partial J}{\partial r_{iI}}\right)_{r_{iI} = 0} = -Z .\]</div>
<p>Note that if the antisymmetric part of the wavefunction satisfies the electron-ion cusp
condition (for instance by using single-particle orbitals that respect the cusp condition)
or if a nondivergent pseudopotential is used, the Jastrow should be cuspless at the
nucleus and this value should be kept at its default of 0.</p>
<p>Coefficients element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 21%" />
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 24%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Name</strong></p></td>
<td><p><strong>Datatype</strong></p></td>
<td><p><strong>Values</strong></p></td>
<td><p><strong>Defaults</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>Id</p></td>
<td><p>Text</p></td>
<td></td>
<td><p>(Required)</p></td>
<td><p>Unique
identifier</p></td>
</tr>
<tr class="row-odd"><td><p>Type</p></td>
<td><p>Text</p></td>
<td><p>Array</p></td>
<td><p>(Required)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Optimize</p></td>
<td><p>Text</p></td>
<td><p>Yes or no</p></td>
<td><p>Yes</p></td>
<td><p>if no,
values are
fixed in
optimizations</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>(No name)</p></td>
<td><p>Real array</p></td>
<td></td>
<td><p>Zeros</p></td>
<td><p>Jastrow
coefficients</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="example-use-cases">
<span id="bjsplineexamples"></span><h5>Example use cases<a class="headerlink" href="#example-use-cases" title="Permalink to this headline">¶</a></h5>
<p>Specify a spin-independent function with four parameters. Because rcut  is not
specified, the default cutoff of the Wigner Seitz cell radius is used; this
Jastrow must be used with a 3D periodic system such as a bulk solid. The name of
the particleset holding the ionic positions is “i.”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;J1&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;One-Body&quot;</span> <span class="n">function</span><span class="o">=</span><span class="s2">&quot;Bspline&quot;</span> <span class="nb">print</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">elementType</span><span class="o">=</span><span class="s2">&quot;C&quot;</span> <span class="n">cusp</span><span class="o">=</span><span class="s2">&quot;0.0&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;C&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span><span class="o">&gt;</span> <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Specify a spin-dependent function with seven up-spin and seven down-spin parameters.
The cutoff distance is set to 6 atomic units.  Note here that the particleset holding
the ions is labeled as ion0 rather than “i,” as in the other example.  Also in this case,
the ion is lithium with a coulomb potential, so the cusp condition is satisfied by
setting cusp=”d.”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;J1&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;One-Body&quot;</span> <span class="n">function</span><span class="o">=</span><span class="s2">&quot;Bspline&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span> <span class="n">spin</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">speciesA</span><span class="o">=</span><span class="s2">&quot;Li&quot;</span> <span class="n">speciesB</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;7&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;6&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;eLiu&quot;</span> <span class="n">cusp</span><span class="o">=</span><span class="s2">&quot;3.0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span><span class="o">&gt;</span>
    <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span>
    <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">speciesA</span><span class="o">=</span><span class="s2">&quot;C&quot;</span> <span class="n">speciesB</span><span class="o">=</span><span class="s2">&quot;d&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;7&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;6&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;eLid&quot;</span> <span class="n">cusp</span><span class="o">=</span><span class="s2">&quot;3.0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span><span class="o">&gt;</span>
    <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span>
    <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="pade-form">
<span id="onebodyjastrowpade"></span><h5>Pade form<a class="headerlink" href="#pade-form" title="Permalink to this headline">¶</a></h5>
<p>Although the spline Jastrow factor is the most flexible and most commonly used form implemented in QMCPACK,
there are times where its flexibility can make it difficult to optimize.  As an example, a spline Jastrow
with a very large cutoff can be difficult to optimize for isolated systems such as molecules because of the small
number of samples present in the tail of the function.  In such cases, a simpler functional
form might be advantageous.  The second-order Pade Jastrow factor, given in <a class="reference internal" href="#equation-eq11">(11)</a>, is a good choice
in such cases.</p>
<div class="math notranslate nohighlight" id="equation-eq11">
<span class="eqno">(11)<a class="headerlink" href="#equation-eq11" title="Permalink to this equation">¶</a></span>\[u_{ab}(r) = \frac{a*r+c*r^2}{1+b*r}\]</div>
<p>Unlike the spline Jastrow factor, which includes a cutoff, this form has an infinite range and will be applied to every particle
pair (subject to the minimum image convention).  It also is a cuspless Jastrow factor,
so it should be used either in combination with a single particle basis set that contains the proper cusp or
with a smooth pseudopotential.</p>
<p>Correlation element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 18%" />
<col style="width: 15%" />
<col style="width: 18%" />
<col style="width: 34%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Name</strong></p></td>
<td><p><strong>Datatype</strong></p></td>
<td><p><strong>Values</strong></p></td>
<td><p><strong>Defaults</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>ElementType</p></td>
<td><p>Text</p></td>
<td><p>Name</p></td>
<td><p>See below</p></td>
<td><p>Classical particle target</p></td>
</tr>
<tr class="row-odd"><td><p>Elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Coefficients</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Parameter element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Name</strong></p></td>
<td><p><strong>Datatype</strong></p></td>
<td><p><strong>Values</strong></p></td>
<td><p><strong>Defaults</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>Id</p></td>
<td><p>String</p></td>
<td><p>Name</p></td>
<td><p>(Required)</p></td>
<td><p>Name for
variable</p></td>
</tr>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>String</p></td>
<td><p>A or B or C</p></td>
<td><p>(Required)</p></td>
<td><p>See
<a class="reference internal" href="#equation-eq11">(11)</a></p></td>
</tr>
<tr class="row-even"><td><p>Optimize</p></td>
<td><p>Text</p></td>
<td><p>Yes or no</p></td>
<td><p>Yes</p></td>
<td><p>If no,
values are
fixed in
optimizations</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>(No name)</p></td>
<td><p>Real</p></td>
<td><p>Parameter
value</p></td>
<td><p>(Required)</p></td>
<td><p>Jastrow
coefficients</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="example-use-case">
<span id="bjpadeexamples"></span><h5>Example use case<a class="headerlink" href="#example-use-case" title="Permalink to this headline">¶</a></h5>
<p>Specify a spin-independent function with independent Jastrow factors for two different species (Li and H).
The name of the particleset holding the ionic positions is “i.”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;J1&quot;</span> <span class="n">function</span><span class="o">=</span><span class="s2">&quot;pade2&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;One-Body&quot;</span> <span class="nb">print</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">elementType</span><span class="o">=</span><span class="s2">&quot;Li&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;LiA&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="o">&gt;</span>  <span class="mf">0.34</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;LiB&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="o">&gt;</span> <span class="mf">12.78</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;LiC&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="o">&gt;</span>  <span class="mf">1.62</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">elementType</span><span class="o">=</span><span class="s2">&quot;H&quot;&quot;&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;HA&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="o">&gt;</span>  <span class="mf">0.14</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;HB&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="o">&gt;</span> <span class="mf">6.88</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;HC&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="o">&gt;</span> <span class="mf">0.237</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="short-range-cusp-form">
<h5>Short Range Cusp Form<a class="headerlink" href="#short-range-cusp-form" title="Permalink to this headline">¶</a></h5>
<p>The idea behind this functor is to encode nuclear cusps and other details at very
short range around a nucleus in the region that the Gaussian orbitals of quantum
chemistry are not capable of describing correctly.
The functor is kept short ranged, because outside this small region, quantum chemistry
orbital expansions are already capable of taking on the correct shapes.
Unlike a pre-computed cusp correction, this optimizable functor can respond to
changes in the wave function during VMC optimization.
The functor’s form is</p>
<div class="math notranslate nohighlight" id="equation-eq12">
<span class="eqno">(12)<a class="headerlink" href="#equation-eq12" title="Permalink to this equation">¶</a></span>\[u(r) = -\exp{\left(-r/R_0\right)} \left( A R_0 + \sum_{k=0}^{N-1} B_k \frac{ (r/R_0)^{k+2} }{ 1 + (r/R_0)^{k+2} } \right)\]</div>
<p>in which <span class="math notranslate nohighlight">\(R_0\)</span> acts as a soft cutoff radius (<span class="math notranslate nohighlight">\(u(r)\)</span> decays to zero quickly beyond roughly this distance)
and <span class="math notranslate nohighlight">\(A\)</span> determines the cusp condition.</p>
<div class="math notranslate nohighlight" id="equation-eq13">
<span class="eqno">(13)<a class="headerlink" href="#equation-eq13" title="Permalink to this equation">¶</a></span>\[\lim_{r \to 0} \frac{\partial u}{\partial r} = A\]</div>
<p>The simple exponential decay is modified by the <span class="math notranslate nohighlight">\(N\)</span> coefficients
<span class="math notranslate nohighlight">\(B_k\)</span> that define an expansion in sigmoidal functions, thus adding
detailed structure in a short-ranged region around a nucleus while
maintaining the correct cusp condition at the nucleus. Note that
sigmoidal functions are used instead of, say, a bare polynomial
expansion, as they trend to unity past the soft cutoff radius and so
interfere less with the exponential decay that keeps the functor short
ranged. Although <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(R_0\)</span>, and the <span class="math notranslate nohighlight">\(B_k\)</span>
coefficients can all be optimized as variational parameters, <span class="math notranslate nohighlight">\(A\)</span>
will typically be fixed as the desired cusp condition is known.</p>
<p>To specify this one-body Jastrow factor, use an input section like the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;J1Cusps&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;One-Body&quot;</span> <span class="n">function</span><span class="o">=</span><span class="s2">&quot;shortrangecusp&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span> <span class="nb">print</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;6&quot;</span> <span class="n">cusp</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">elementType</span><span class="o">=</span><span class="s2">&quot;Li&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;LiCuspR0&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;R0&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span> <span class="mf">0.06</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;LiCuspB&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
      <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;6&quot;</span> <span class="n">cusp</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="n">elementType</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">var</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;HCuspR0&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;R0&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span> <span class="mf">0.2</span> <span class="o">&lt;/</span><span class="n">var</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;HCuspB&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
      <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here “rcut” is specified as the range beyond which the functor is
assumed to be zero. The value of <span class="math notranslate nohighlight">\(A\)</span> can either be specified via
the “cusp” option as shown above, in which case its optimization is
disabled, or through its own “var” line as for <span class="math notranslate nohighlight">\(R_0\)</span>, in which
case it can be specified as either optimizable (“yes”) or not (“no”).
The coefficients <span class="math notranslate nohighlight">\(B_k\)</span> are specified via the “coefficients”
section, with the length <span class="math notranslate nohighlight">\(N\)</span> of the expansion determined
automatically based on the length of the array.</p>
<p>Note that this one-body Jastrow form can (and probably should) be used in conjunction
with a longer ranged one-body Jastrow, such as a spline form.
Be sure to set the longer-ranged Jastrow to be cusp-free!</p>
</div>
</div>
</div>
<div class="section" id="two-body-jastrow-functions">
<h3>Two-body Jastrow functions<a class="headerlink" href="#two-body-jastrow-functions" title="Permalink to this headline">¶</a></h3>
<p>The two-body Jastrow factor is a form that allows for the explicit inclusion
of dynamic correlation between two particles included in the wavefunction.  It
is almost always given in a spin dependent form so as to satisfy the Kato cusp
condition between electrons of different spins <a class="bibtex reference internal" href="#kato" id="id7">[Kat51]</a>.</p>
<p>The two body Jastrow function is specified within a <code class="docutils literal notranslate"><span class="pre">wavefunction</span></code> element
and must contain one or more correlation elements specifying additional parameters
as well as the actual coefficients.  <a class="reference internal" href="#id11"><span class="std std-ref">Example use cases</span></a> gives
examples of the typical nesting of <code class="docutils literal notranslate"><span class="pre">jastrow</span></code>, <code class="docutils literal notranslate"><span class="pre">correlation</span></code> and
<code class="docutils literal notranslate"><span class="pre">coefficient</span></code> elements.</p>
<div class="section" id="id8">
<h4>Input Specification<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Jastrow element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 21%" />
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>name</strong></p></td>
<td><p><strong>datatype</strong></p></td>
<td><p><strong>values</strong></p></td>
<td><p><strong>defaults</strong></p></td>
<td><p><strong>description</strong></p></td>
</tr>
<tr class="row-even"><td><p>name</p></td>
<td><p>text</p></td>
<td></td>
<td><p>(required)</p></td>
<td><p>Unique name
for this
Jastrow
function</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>text</p></td>
<td><p>Two-body</p></td>
<td><p>(required)</p></td>
<td><p>Define a
one-body
function</p></td>
</tr>
<tr class="row-even"><td><p>function</p></td>
<td><p>text</p></td>
<td><p>Bspline</p></td>
<td><p>(required)</p></td>
<td><p>BSpline
Jastrow</p></td>
</tr>
<tr class="row-odd"><td><p>print</p></td>
<td><p>text</p></td>
<td><p>yes / no</p></td>
<td><p>yes</p></td>
<td><p>Jastrow
factor
printed in
external
file?</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Correlation</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The two-body Jastrow factors used to describe correlations between electrons take the form</p>
<div class="math notranslate nohighlight" id="equation-eq14">
<span class="eqno">(14)<a class="headerlink" href="#equation-eq14" title="Permalink to this equation">¶</a></span>\[J2=\sum_i^{e}\sum_{j&gt;i}^{e} u_{ab}(|r_i-r_j|)\]</div>
<p>The most commonly used form of two body Jastrow factor supported by the code is a splined
Jastrow factor, with many similarities to the one body spline Jastrow.</p>
<div class="section" id="twobodyjastrowspline">
<span id="id9"></span><h5>Spline form<a class="headerlink" href="#twobodyjastrowspline" title="Permalink to this headline">¶</a></h5>
<p>The two-body spline Jastrow function is the most commonly used two-body
Jastrow for solids. This form was first described and used in
<a class="bibtex reference internal" href="#eslerkimceperleyshulenburger2012" id="id10">[EKCS12]</a>. Here
<span class="math notranslate nohighlight">\(u_{ab}\)</span> is an interpolating 1D B-spline (tricublc spline on a
linear grid) between zero distance and <span class="math notranslate nohighlight">\(r_{cut}\)</span>. In 3D periodic
systems, the default cutoff distance is the Wigner Seitz cell radius.
For other periodicities, including isolated molecules, the
<span class="math notranslate nohighlight">\(r_{cut}\)</span> must be specified. <span class="math notranslate nohighlight">\(r_i\)</span> and <span class="math notranslate nohighlight">\(r_j\)</span> are
typically electron positions. The cusp condition as <span class="math notranslate nohighlight">\(r_i\)</span>
approaches <span class="math notranslate nohighlight">\(r_j\)</span> is set by the relative spin of the electrons.</p>
<p>Correlation element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 26%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Name</strong></p></td>
<td><p><strong>Datatype</strong></p></td>
<td><p><strong>Values</strong></p></td>
<td><p><strong>Defaults</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>SpeciesA</p></td>
<td><p>Text</p></td>
<td><p>U or d</p></td>
<td><p>(Required)</p></td>
<td><p>Quantum
species
target</p></td>
</tr>
<tr class="row-odd"><td><p>SpeciesB</p></td>
<td><p>Text</p></td>
<td><p>U or d</p></td>
<td><p>(Required)</p></td>
<td><p>Quantum
species
target</p></td>
</tr>
<tr class="row-even"><td><p>Size</p></td>
<td><p>Integer</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>(Required)</p></td>
<td><p>Number of
coefficients</p></td>
</tr>
<tr class="row-odd"><td><p>Rcut</p></td>
<td><p>Real</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>See below</p></td>
<td><p>Distance at
which the
correlation
goes to 0</p></td>
</tr>
<tr class="row-even"><td><p>Spin</p></td>
<td><p>Text</p></td>
<td><p>Yes or no</p></td>
<td><p>No</p></td>
<td><p>Spin-dependent
Jastrow factor</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Coefficients</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">speciesA,</span> <span class="pre">speciesB</span></code> The scale function u(r) is defined for species pairs uu and ud.</p></li>
</ul>
<p>There is no need to define ud or dd since uu=dd and ud=du.  The cusp condition is computed internally
based on the charge of the quantum particles.</p>
<p>Coefficients element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 21%" />
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Name</strong></p></td>
<td><p><strong>Datatype</strong></p></td>
<td><p><strong>Values</strong></p></td>
<td><p><strong>Defaults</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>Id</p></td>
<td><p>Text</p></td>
<td></td>
<td><p>(Required)</p></td>
<td><p>Unique
identifier</p></td>
</tr>
<tr class="row-odd"><td><p>Type</p></td>
<td><p>Text</p></td>
<td><p>Array</p></td>
<td><p>(Required)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Optimize</p></td>
<td><p>Text</p></td>
<td><p>Yes or no</p></td>
<td><p>Yes</p></td>
<td><p>If no,
values are
fixed in
optimizations</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>(No name)</p></td>
<td><p>Real array</p></td>
<td></td>
<td><p>Zeros</p></td>
<td><p>Jastrow
coefficients</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="id11">
<span id="id12"></span><h5>Example use cases<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<p>Specify a spin-dependent function with four parameters for each channel.  In this case, the cusp is set at
a radius of 4.0 bohr (rather than to the default of the Wigner Seitz cell radius).  Also, in this example,
the coefficients are set to not be optimized during an optimization step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;J2&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Two-Body&quot;</span> <span class="n">function</span><span class="o">=</span><span class="s2">&quot;Bspline&quot;</span> <span class="nb">print</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">speciesA</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">speciesB</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;8&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;4.0&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;uu&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="o">&gt;</span> <span class="mf">0.2309049836</span> <span class="mf">0.1312646071</span> <span class="mf">0.05464141356</span> <span class="mf">0.01306231516</span><span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">speciesA</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">speciesB</span><span class="o">=</span><span class="s2">&quot;d&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;8&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;4.0&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;ud&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="o">&gt;</span> <span class="mf">0.4351561096</span> <span class="mf">0.2377951747</span> <span class="mf">0.1129144262</span> <span class="mf">0.0356789236</span><span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="user-defined-functional-form">
<span id="jastrowuserform"></span><h3>User defined functional form<a class="headerlink" href="#user-defined-functional-form" title="Permalink to this headline">¶</a></h3>
<p>To aid in implementing different forms for <span class="math notranslate nohighlight">\(u_{ab}(r)\)</span>, there is a
script that uses a symbolic expression to generate the appropriate code
(with spatial and parameter derivatives). The script is located in
<code class="docutils literal notranslate"><span class="pre">src/QMCWaveFunctions/Jastrow/codegen/user_jastrow.py</span></code>. The script
requires Sympy (www.sympy.org) for symbolic mathematics and code
generation.</p>
<p>To use the script, modify it to specify the functional form and a list
of variational parameters. Optionally, there may be fixed parameters -
ones that are specified in the input file, but are not part of the
variational optimization. Also one symbol may be specified that accepts
a cusp value in order to satisfy the cusp condition. There are several
example forms in the script. The default form is the simple Padé.</p>
<p>Once the functional form and parameters are specified in the script, run
the script from the <code class="docutils literal notranslate"><span class="pre">codegen</span></code> directory and recompile QMCPACK. The
main output of the script is the file
<code class="docutils literal notranslate"><span class="pre">src/QMCWaveFunctions/Jastrow/UserFunctor.h</span></code>. The script also prints
information to the screen, and one section is a sample XML input block
containing all the parameters.</p>
<p>There is a unit test in
<code class="docutils literal notranslate"><span class="pre">src/QMCWaveFunctions/test/test_user_jastrow.cpp</span></code> to perform some
minimal testing of the Jastrow factor. The unit test will need updating
to properly test new functional forms. Most of the changes relate to the
number and name of variational parameters.</p>
<p>Jastrow element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 21%" />
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 24%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>name</strong></p></td>
<td><p><strong>datatype</strong></p></td>
<td><p><strong>values</strong></p></td>
<td><p><strong>defaults</strong></p></td>
<td><p><strong>description</strong></p></td>
</tr>
<tr class="row-even"><td><p>name</p></td>
<td><p>text</p></td>
<td></td>
<td><p>(required)</p></td>
<td><p>Unique name
for this
Jastrow
function</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>text</p></td>
<td><p>One-body</p></td>
<td><p>(required)</p></td>
<td><p>Define a
one-body
function</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>Two-body</p></td>
<td><p>(required)</p></td>
<td><p>Define a
two-body
function</p></td>
</tr>
<tr class="row-odd"><td><p>function</p></td>
<td><p>text</p></td>
<td><p>user</p></td>
<td><p>(required)</p></td>
<td><p>User-defined
functor</p></td>
</tr>
</tbody>
</table>
<p>See other parameters as appropriate for one or two-body functions</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 22%" />
<col style="width: 19%" />
<col style="width: 22%" />
<col style="width: 22%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>elements</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Correlation</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Contents</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>(None)</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="long-ranged-jastrow-factors">
<h3>Long-ranged Jastrow factors<a class="headerlink" href="#long-ranged-jastrow-factors" title="Permalink to this headline">¶</a></h3>
<p>While short-ranged Jastrow factors capture the majority of the benefit
for minimizing the total energy and the energy variance, long-ranged
Jastrow factors are important to accurately reproduce the short-ranged
(long wavelength) behavior of quantities such as the static structure
factor, and are therefore essential for modern accurate finite size
corrections in periodic systems.</p>
<p>Below two types of long-ranged Jastrow factors are described. The first
(the k-space Jastrow) is simply an expansion of the one and/or two body
correlation functions in plane waves, with the coefficients comprising
the optimizable parameters. The second type have few variational
parameters and use the optimized breakup method of Natoli and
Ceperley <a class="bibtex reference internal" href="#natoli1995" id="id13">[NC95]</a> (the Yukawa and Gaskell RPA
Jastrows).</p>
<div class="section" id="long-ranged-jastrow-k-space-jastrow">
<h4>Long-ranged Jastrow: k-space Jastrow<a class="headerlink" href="#long-ranged-jastrow-k-space-jastrow" title="Permalink to this headline">¶</a></h4>
<p>The k-space Jastrow introduces explicit long-ranged dependence commensurate with the periodic supercell.  This Jastrow is to be used in periodic boundary conditions only.</p>
<p>The input for the k-space Jastrow fuses both one and two-body forms into a single element and so they are discussed together here.  The one- and two-body terms in the k-Space Jastrow have the form:</p>
<div class="math notranslate nohighlight" id="equation-eq15">
<span class="eqno">(15)<a class="headerlink" href="#equation-eq15" title="Permalink to this equation">¶</a></span>\[J_1 = \sum_{G\ne 0}b_G\rho_G^I\rho_{-G}\]</div>
<div class="math notranslate nohighlight" id="equation-eq16">
<span class="eqno">(16)<a class="headerlink" href="#equation-eq16" title="Permalink to this equation">¶</a></span>\[J_2 = \sum_{G\ne 0}a_G\rho_G\rho_{-G}\]</div>
<p>Here <span class="math notranslate nohighlight">\(\rho_G\)</span> is the Fourier transform of the instantaneous electron density:</p>
<div class="math notranslate nohighlight" id="equation-eq17">
<span class="eqno">(17)<a class="headerlink" href="#equation-eq17" title="Permalink to this equation">¶</a></span>\[\rho_G=\sum_{n\in electrons}e^{iG\cdot r_n}\]</div>
<p>and <span class="math notranslate nohighlight">\(\rho_G^I\)</span> has the same form, but for the fixed ions. In both cases the coefficients are restricted to be real, though in general the coefficients for the one-body term need not be.  See <span class="xref std std-ref">feature-kspace-jastrow</span> for more detail.</p>
<p>Input for the k-space Jastrow follows the familar nesting of <code class="docutils literal notranslate"><span class="pre">jastrow-correlation-coefficients</span></code> elements, with attributes unique to the k-space Jastrow at the <code class="docutils literal notranslate"><span class="pre">correlation</span></code> input level.</p>
<p><code class="docutils literal notranslate"><span class="pre">jastrow</span> <span class="pre">type=kSpace</span></code> element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>parent elements:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wavefunction</span></code></p></td>
</tr>
<tr class="row-even"><td><p>child elements:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">correlation</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>attributes:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 14%" />
<col style="width: 22%" />
<col style="width: 13%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><strong>kSpace</strong></p></td>
<td></td>
<td><p>must be kSpace</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><em>anything</em></p></td>
<td><p>0</p></td>
<td><p>Unique name for Jastrow</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">particleset.name</span></code></p></td>
<td></td>
<td><p>Ion particleset name</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">correlation</span></code> element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 58%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>parent elements:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">jastrow</span> <span class="pre">type=kSpace</span></code></p></td>
</tr>
<tr class="row-even"><td><p>child elements:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">coefficients</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>attributes:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 13%" />
<col style="width: 24%" />
<col style="width: 12%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><strong>One-body, Two-Body</strong></p></td>
<td></td>
<td><p>Must be One-body/Two-body</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kc</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>real</p></td>
<td><p>kc <span class="math notranslate nohighlight">\(\ge\)</span> 0</p></td>
<td><p>0.0</p></td>
<td><p>k-space cutoff in a.u.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">symmetry</span></code><span class="math notranslate nohighlight">\(^o\)</span></p></td>
<td><p>text</p></td>
<td><p>crystal,isotropic,none</p></td>
<td><p>crystal</p></td>
<td><p>symmetry of coefficients</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">spinDependent</span></code><span class="math notranslate nohighlight">\(^o\)</span></p></td>
<td><p>boolean</p></td>
<td><p>yes,no</p></td>
<td><p>no</p></td>
<td><p><em>No current function</em></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">coefficients</span></code> element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>parent elements:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">correlation</span></code></p></td>
</tr>
<tr class="row-even"><td><p>child elements:</p></td>
<td><p><em>None</em></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>attributes:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 18%" />
<col style="width: 15%" />
<col style="width: 17%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><em>anything</em></p></td>
<td><p>cG1/cG2</p></td>
<td><p>Label for coeffs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Array</span></code></p></td>
<td><p>0</p></td>
<td><p>Must be Array</p></td>
</tr>
</tbody>
</table>
<p>body text: The body text is a list of real values for the parameters.</p>
</div></blockquote>
<p>Additional information:</p>
<ul class="simple">
<li><p>It is normal to provide no coefficients as an initial guess. The
number of coefficients will be automatically calculated according to
the k-space cutoff + symmetry and set to zero.</p></li>
<li><p>Providing an incorrect number of parameters also results in all
parameters being set to zero.</p></li>
<li><p>There is currently no way to turn optimization on/off for the k-space
Jastrow. The coefficients are always optimized.</p></li>
<li><p>Spin dependence is currently not implemented for this Jastrow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kc</span></code>: Parameters with G vectors magnitudes less than <code class="docutils literal notranslate"><span class="pre">kc</span></code> are
included in the Jastrow. If <code class="docutils literal notranslate"><span class="pre">kc</span></code> is zero, it is the same as
excluding the k-space term.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">symmetry=crystal</span></code>: Impose crystal symmetry on coefficients
according to the structure factor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">symmetry=isotropic</span></code>: Impose spherical symmetry on coefficients
according to G-vector magnitude.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">symmetry=none</span></code>: Impose no symmetry on the coefficients.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="listing-10">
<div class="code-block-caption"><span class="caption-number">Listing 10 </span><span class="caption-text">k-space Jastrow with one- and two-body terms.</span><a class="headerlink" href="#listing-10" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;kSpace&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Jk&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">kc</span><span class="o">=</span><span class="s2">&quot;4.0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;One-Body&quot;</span> <span class="n">symmetry</span><span class="o">=</span><span class="s2">&quot;cystal&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;cG1&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">kc</span><span class="o">=</span><span class="s2">&quot;4.0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Two-Body&quot;</span> <span class="n">symmetry</span><span class="o">=</span><span class="s2">&quot;crystal&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;cG2&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="listing-11">
<div class="code-block-caption"><span class="caption-number">Listing 11 </span><span class="caption-text">k-space Jastrow with one-body term only.</span><a class="headerlink" href="#listing-11" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;kSpace&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Jk&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">kc</span><span class="o">=</span><span class="s2">&quot;4.0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;One-Body&quot;</span> <span class="n">symmetry</span><span class="o">=</span><span class="s2">&quot;crystal&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;cG1&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="listing-12">
<div class="code-block-caption"><span class="caption-number">Listing 12 </span><span class="caption-text">k-space Jastrow with two-body term only.</span><a class="headerlink" href="#listing-12" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;kSpace&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Jk&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">kc</span><span class="o">=</span><span class="s2">&quot;4.0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Two-Body&quot;</span> <span class="n">symmetry</span><span class="o">=</span><span class="s2">&quot;crystal&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;cG2&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="long-ranged-jastrows-gaskell-rpa-and-yukawa-forms">
<span id="twobodyjastrowlr"></span><h5>Long-ranged Jastrows: Gaskell RPA and Yukawa forms<a class="headerlink" href="#long-ranged-jastrows-gaskell-rpa-and-yukawa-forms" title="Permalink to this headline">¶</a></h5>
<p><strong>NOTE: The Yukawa and RPA Jastrows do not work at present
and are currently being revived.  Please contact the developers if
you are interested in using them.</strong></p>
<p>The exact Jastrow correlation functions contain terms which have a
form similar to the Coulomb pair potential.  In periodic systems
the Coulomb potential is replaced by an Ewald summation of the
bare potential over all periodic image cells.  This sum is often
handled by the optimized breakup method <a class="bibtex reference internal" href="#natoli1995" id="id14">[NC95]</a> and this
same approach is applied to the long-ranged Jastrow factors in QMCPACK.</p>
<p>There are two main long-ranged Jastrow factors of this type
implemented in QMCPACK: the Gaskell RPA <a class="bibtex reference internal" href="#gaskell1961" id="id15">[Gas61]</a><a class="bibtex reference internal" href="#gaskell1962" id="id16">[Gas62]</a>
form and the <a class="bibtex reference internal" href="#ceperley1978" id="id17">[Cep78]</a> form.  Both of these forms
were used by Ceperley in early studies of the electron gas <a class="bibtex reference internal" href="#ceperley1978" id="id18">[Cep78]</a>,
but they are also appropriate starting points for general solids.</p>
<p>The Yukawa form is defined in real space.  It’s long-range form is
formally defined as</p>
<div class="math notranslate nohighlight" id="equation-eq18">
<span class="eqno">(18)<a class="headerlink" href="#equation-eq18" title="Permalink to this equation">¶</a></span>\[u_Y^{PBC}(r) = \sum_{L\ne 0}\sum_{i&lt;j}u_Y(\left|{r_i-r_j+L}\right|)\]</div>
<p>with <span class="math notranslate nohighlight">\(u_Y(r)\)</span> given by</p>
<div class="math notranslate nohighlight" id="equation-eq19">
<span class="eqno">(19)<a class="headerlink" href="#equation-eq19" title="Permalink to this equation">¶</a></span>\[u_Y(r) = \frac{a}{r}\left(1-e^{-r/b}\right)\]</div>
<p>In QMCPACK a slightly more restricted form is used:</p>
<div class="math notranslate nohighlight" id="equation-eq20">
<span class="eqno">(20)<a class="headerlink" href="#equation-eq20" title="Permalink to this equation">¶</a></span>\[u_Y(r) = \frac{r_s}{r}\left(1-e^{-r/\sqrt{r_s}}\right)\]</div>
<p>here “<span class="math notranslate nohighlight">\(r_s\)</span>” is understood to be a variational parameter.</p>
<p>The Gaskell RPA form—which contains correct short/long range limits
and minimizes the total energy of the electron gas within the RPA—is
defined directly in k-space:</p>
<div class="math notranslate nohighlight" id="equation-eq21">
<span class="eqno">(21)<a class="headerlink" href="#equation-eq21" title="Permalink to this equation">¶</a></span>\[u_{RPA}(k) = -\frac{1}{2S_0(k)}+\frac{1}{2}\left(\frac{1}{S_0(k)^2}+\frac{4m_ev_k}{\hbar^2k^2}\right)^{1/2}\]</div>
<p>where $v_k$ is the Fourier transform of the Coulomb potential and
<span class="math notranslate nohighlight">\(S_0(k)\)</span> is the static structure factor of the non-interacting
electron gas:</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_0(k) = \left.
    \begin{cases}
      1 &amp;  k&gt;2k_F \\
      \frac{3k}{4k_F}-\frac{1}{2}\left(\frac{k}{2k_F}\right)^3 &amp; k&lt;2k_F
    \end{cases}
    \right.\end{split}\]</div>
<p>When written in atomic units, RPA Jastrow implemented in QMCPACK has the
form</p>
<div class="math notranslate nohighlight" id="equation-eq22">
<span class="eqno">(22)<a class="headerlink" href="#equation-eq22" title="Permalink to this equation">¶</a></span>\[u_{RPA}(k) = \frac{1}{2N_e}\left(-\frac{1}{S_0(k)}+\left(\frac{1}{S_0(k)^2}+\frac{12}{r_s^3k^4}\right)^{1/2}\right)\]</div>
<p>Here “<span class="math notranslate nohighlight">\(r_s\)</span>” is again a variational parameter and <span class="math notranslate nohighlight">\(k_F\equiv(\tfrac{9\pi}{4r_s^3})^{1/3}\)</span>.</p>
<p>For both the Yukawa and Gaskell RPA Jastrows, the default value for <span class="math notranslate nohighlight">\(r_s\)</span> is <span class="math notranslate nohighlight">\(r_s=(\tfrac{3\Omega}{4\pi N_e})^{1/3}\)</span>.</p>
<p><code class="docutils literal notranslate"><span class="pre">jastrow</span> <span class="pre">type=Two-Body</span> <span class="pre">function=rpa/yukawa</span></code> element:</p>
<blockquote>
<div><blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>parent elements:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wavefunction</span></code></p></td>
</tr>
<tr class="row-even"><td><p>child elements:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">correlation</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>attributes:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 15%" />
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><strong>Two-body</strong></p></td>
<td></td>
<td><p>Must be two-body</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">function</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><strong>rpa/yukawa</strong></p></td>
<td></td>
<td><p>Must be rpa or yukawa</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code><span class="math notranslate nohighlight">\(^r\)</span></p></td>
<td><p>text</p></td>
<td><p><em>anything</em></p></td>
<td><p>RPA_Jee</p></td>
<td><p>Unique name for Jastrow</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">longrange</span></code><span class="math notranslate nohighlight">\(^o\)</span></p></td>
<td><p>boolean</p></td>
<td><p>yes/no</p></td>
<td><p>yes</p></td>
<td><p>Use long-range part</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">shortrange</span></code><span class="math notranslate nohighlight">\(^o\)</span></p></td>
<td><p>boolean</p></td>
<td><p>yes/no</p></td>
<td><p>yes</p></td>
<td><p>Use short-range part</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>parameters:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 6%" />
<col style="width: 7%" />
<col style="width: 66%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rs</span></code><span class="math notranslate nohighlight">\(^o\)</span></p></td>
<td><p>rs</p></td>
<td><p><span class="math notranslate nohighlight">\(r_s&gt;0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\tfrac{3\Omega}{4\pi N_e}\)</span></p></td>
<td><p>Avg. elec-elec distance</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kc</span></code><span class="math notranslate nohighlight">\(^o\)</span></p></td>
<td><p>kc</p></td>
<td><p><span class="math notranslate nohighlight">\(k_c&gt;0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2\left(\tfrac{9\pi}{4}\right)^{1/3}\tfrac{4\pi N_e}{3\Omega}\)</span></p></td>
<td><p>k-space cutoff</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="listing-13">
<div class="code-block-caption"><span class="caption-number">Listing 13 </span><span class="caption-text">Two body RPA Jastrow with long- and short-ranged parts.</span><a class="headerlink" href="#listing-13" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="n">Jee</span><span class="s1">&#39;&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="n">Two</span><span class="o">-</span><span class="n">Body</span><span class="s1">&#39;&#39;</span> <span class="n">function</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="n">rpa</span><span class="s1">&#39;&#39;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="three-body-jastrow-functions">
<h3>Three-body Jastrow functions<a class="headerlink" href="#three-body-jastrow-functions" title="Permalink to this headline">¶</a></h3>
<p>Explicit three-body correlations can be included in the wavefunction via
the three-body Jastrow factor. The three-body electron-electron-ion
correlation function (<span class="math notranslate nohighlight">\(u_{\sigma\sigma'I}\)</span>) currently used in is
identical to the one proposed in <a class="bibtex reference internal" href="#drummond2004" id="id19">[DTN04]</a>:</p>
<div class="math notranslate nohighlight" id="equation-eq23">
<span class="eqno">(23)<a class="headerlink" href="#equation-eq23" title="Permalink to this equation">¶</a></span>\[\begin{split} \begin{aligned}
 u_{\sigma\sigma'I}(r_{\sigma I},r_{\sigma'I},r_{\sigma\sigma'}) &amp;= \sum_{\ell=0}^{M_{eI}}\sum_{m=0}^{M_{eI}}\sum_{n=0}^{M_{ee}}\gamma_{\ell mn} r_{\sigma I}^\ell r_{\sigma'I}^m r_{\sigma\sigma'}^n \\
    &amp;\times \left(r_{\sigma I}-\frac{r_c}{2}\right)^3 \Theta\left(r_{\sigma I}-\frac{r_c}{2}\right) \nonumber \\
    &amp;\times \left(r_{\sigma' I}-\frac{r_c}{2}\right)^3 \Theta\left(r_{\sigma' I}-\frac{r_c}{2}\right) \nonumber\end{aligned}\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(M_{eI}\)</span> and <span class="math notranslate nohighlight">\(M_{ee}\)</span> are the maximum polynomial orders
of the electron-ion and electron-electron distances, respectively,
<span class="math notranslate nohighlight">\(\{\gamma_{\ell mn}\}\)</span> are the optimizable parameters (modulo
constraints), <span class="math notranslate nohighlight">\(r_c\)</span> is a cutoff radius, and <span class="math notranslate nohighlight">\(r_{ab}\)</span> are the
distances between electrons or ions <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>. i.e. The
correlation function is only a function of the interparticle distances
and not a more complex function of the particle positions,
<span class="math notranslate nohighlight">\(\mathbf{r}\)</span>. As indicated by the <span class="math notranslate nohighlight">\(\Theta\)</span> functions,
correlations are set to zero beyond a distance of <span class="math notranslate nohighlight">\(r_c/2\)</span> in
either of the electron-ion distances and the largest meaningful
electron-electron distance is <span class="math notranslate nohighlight">\(r_c\)</span>. This is the highest-order
Jastrow correlation function currently implemented.</p>
<p>Today, solid state applications of QMCPACK usually utilize one and
two-body B-spline Jastrow functions, with calculations on heavier
elements often also using the three-body term described above.</p>
<div class="section" id="id20">
<h4>Example use case<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>Here is an example of H2O molecule. After optimizing one and two body Jastrow factors, add the following block in the wavefunction.
The coefficients will be filled zero automatically if not given.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">jastrow</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;J3&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;eeI&quot;</span> <span class="n">function</span><span class="o">=</span><span class="s2">&quot;polynomial&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span> <span class="nb">print</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">ispecies</span><span class="o">=</span><span class="s2">&quot;O&quot;</span> <span class="n">especies</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">isize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">esize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;10&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;uuO&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">ispecies</span><span class="o">=</span><span class="s2">&quot;O&quot;</span> <span class="n">especies1</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">especies2</span><span class="o">=</span><span class="s2">&quot;d&quot;</span> <span class="n">isize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">esize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;10&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;udO&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">ispecies</span><span class="o">=</span><span class="s2">&quot;H&quot;</span> <span class="n">especies</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">isize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">esize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;10&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;uuH&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">correlation</span> <span class="n">ispecies</span><span class="o">=</span><span class="s2">&quot;H&quot;</span> <span class="n">especies1</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">especies2</span><span class="o">=</span><span class="s2">&quot;d&quot;</span> <span class="n">isize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">esize</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">rcut</span><span class="o">=</span><span class="s2">&quot;10&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">coefficients</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;udH&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Array&quot;</span> <span class="n">optimize</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">coefficients</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">correlation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">jastrow</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="multideterminant-wavefunctions">
<span id="multideterminants"></span><h2>Multideterminant wavefunctions<a class="headerlink" href="#multideterminant-wavefunctions" title="Permalink to this headline">¶</a></h2>
<p>Multiple schemes to generate a multideterminant wavefunction are
possible, from CASSF to full CI or selected CI. The QMCPACK converter can
convert MCSCF multideterminant wavefunctions from
GAMESS <a class="bibtex reference internal" href="#schmidt93" id="id21">[SBB+93]</a> and CIPSI <a class="bibtex reference internal" href="#caffarel2013" id="id22">[EG13]</a> wavefunctions from
Quantum Package <a class="bibtex reference internal" href="#qp" id="id23">[Sce17]</a> (QP). Full details of how to run a CIPSI
calculation and convert the wavefunction for QMCPACK are given in
<span class="xref std std-ref">cipsi</span>.</p>
<p>The script <code class="docutils literal notranslate"><span class="pre">utils/determinants_tools.py</span></code> can be used to generate
useful information about the multideterminant wavefunction. This script takes, as a required argument, the path of an h5 file corresponding to the wavefunction. Used without optional arguments, it prints the number of determinants, the number of CSFs, and a histogram of the excitation degree.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">determinants_tools</span><span class="o">.</span><span class="n">py</span> <span class="o">./</span><span class="n">tests</span><span class="o">/</span><span class="n">molecules</span><span class="o">/</span><span class="n">C2_pp</span><span class="o">/</span><span class="n">C2</span><span class="o">.</span><span class="n">h5</span>
<span class="n">Summary</span><span class="p">:</span>
<span class="n">excitation</span> <span class="n">degree</span> <span class="mi">0</span> <span class="n">count</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">excitation</span> <span class="n">degree</span> <span class="mi">1</span> <span class="n">count</span><span class="p">:</span> <span class="mi">6</span>
<span class="n">excitation</span> <span class="n">degree</span> <span class="mi">2</span> <span class="n">count</span><span class="p">:</span> <span class="mi">148</span>
<span class="n">excitation</span> <span class="n">degree</span> <span class="mi">3</span> <span class="n">count</span><span class="p">:</span> <span class="mi">27</span>
<span class="n">excitation</span> <span class="n">degree</span> <span class="mi">4</span> <span class="n">count</span><span class="p">:</span> <span class="mi">20</span>

<span class="n">n_det</span> <span class="mi">202</span>
<span class="n">n_csf</span> <span class="mi">104</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> argument is used, the script will print each determinant,
the associated CSF, and the excitation degree relative to the first determinant.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">determinants_tools</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">v</span> <span class="o">./</span><span class="n">tests</span><span class="o">/</span><span class="n">molecules</span><span class="o">/</span><span class="n">C2_pp</span><span class="o">/</span><span class="n">C2</span><span class="o">.</span><span class="n">h5</span> <span class="o">|</span> <span class="n">head</span>
<span class="mi">1</span>
<span class="n">alpha</span>  <span class="mi">1111000000000000000000000000000000000000000000000000000000</span>
<span class="n">beta</span>   <span class="mi">1111000000000000000000000000000000000000000000000000000000</span>
<span class="n">scf</span>    <span class="mi">2222000000000000000000000000000000000000000000000000000000</span>
<span class="n">excitation</span> <span class="n">degree</span>  <span class="mi">0</span>

<span class="mi">2</span>
<span class="n">alpha</span>  <span class="mi">1011100000000000000000000000000000000000000000000000000000</span>
<span class="n">beta</span>   <span class="mi">1011100000000000000000000000000000000000000000000000000000</span>
<span class="n">scf</span>    <span class="mi">2022200000000000000000000000000000000000000000000000000000</span>
<span class="n">excitation</span> <span class="n">degree</span>  <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="backflow-wavefunctions">
<span id="backflow"></span><h2>Backflow Wavefunctions<a class="headerlink" href="#backflow-wavefunctions" title="Permalink to this headline">¶</a></h2>
<p>One can perturb the nodal surface of a single-Slater/multi-Slater
wavefunction through use of a backflow transformation. Specifically, if
we have an antisymmetric function
<span class="math notranslate nohighlight">\(D(\mathbf{x}_{0\uparrow},\cdots,\mathbf{x}_{N\uparrow}, \mathbf{x}_{0\downarrow},\cdots,\mathbf{x}_{N\downarrow})\)</span>,
and if <span class="math notranslate nohighlight">\(i_\alpha\)</span> is the <span class="math notranslate nohighlight">\(i\)</span>-th particle of species type
<span class="math notranslate nohighlight">\(\alpha\)</span>, then the backflow transformation works by making the
coordinate transformation
<span class="math notranslate nohighlight">\(\mathbf{x}_{i_\alpha} \to \mathbf{x}'_{i_\alpha}\)</span> and evaluating
<span class="math notranslate nohighlight">\(D\)</span> at these new “quasiparticle” coordinates. QMCPACK currently
supports quasiparticle transformations given by</p>
<div class="math notranslate nohighlight" id="equation-eq24">
<span class="eqno">(24)<a class="headerlink" href="#equation-eq24" title="Permalink to this equation">¶</a></span>\[\mathbf{x}'_{i_\alpha}=\mathbf{x}_{i_\alpha}+\sum_{\alpha \leq \beta} \sum_{i_\alpha \neq j_\beta} \eta^{\alpha\beta}(|\mathbf{x}_{i_\alpha}-\mathbf{x}_{j_\beta}|)(\mathbf{x}_{i_\alpha}-\mathbf{x}_{j_\beta})\:.\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\eta^{\alpha\beta}(|\mathbf{x}_{i_\alpha}-\mathbf{x}_{j_\beta}|)\)</span>
is a radially symmetric backflow transformation between species
<span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>. In QMCPACK, particle <span class="math notranslate nohighlight">\(i_\alpha\)</span>
is known as the “target” particle and <span class="math notranslate nohighlight">\(j_\beta\)</span> is known as the
“source.” The main types of transformations are so-called one-body
terms, which are between an electron and an ion
<span class="math notranslate nohighlight">\(\eta^{eI}(|\mathbf{x}_{i_e}-\mathbf{x}_{j_I}|)\)</span> and two-body
terms. Two-body terms are distinguished as those between like and
opposite spin electrons:
<span class="math notranslate nohighlight">\(\eta^{e(\uparrow)e(\uparrow)}(|\mathbf{x}_{i_e(\uparrow)}-\mathbf{x}_{j_e(\uparrow)}|)\)</span>
and
<span class="math notranslate nohighlight">\(\eta^{e(\uparrow)e(\downarrow)}(|\mathbf{x}_{i_e(\uparrow)}-\mathbf{x}_{j_e(\downarrow)}|)\)</span>.
Henceforth, we will assume that
<span class="math notranslate nohighlight">\(\eta^{e(\uparrow)e(\uparrow)}=\eta^{e(\downarrow)e(\downarrow)}\)</span>.</p>
<p>In the following, we explain how to describe general terms such as
<a class="reference internal" href="#equation-eq24">(24)</a> in a QMCPACK XML file. For specificity, we will
consider a particle set consisting of H and He (in that order). This
ordering will be important when we build the XML file, so you can find
this out either through your specific declaration of &lt;particleset&gt;, by
looking at the hdf5 file in the case of plane waves, or by looking at
the QMCPACK output file in the section labeled “Summary of QMC systems.”</p>
<div class="section" id="input-specifications">
<h3>Input specifications<a class="headerlink" href="#input-specifications" title="Permalink to this headline">¶</a></h3>
<p>All backflow declarations occur within a single <code class="docutils literal notranslate"><span class="pre">&lt;backflow&gt;</span> <span class="pre">...</span> <span class="pre">&lt;/backflow&gt;</span></code> block.  Backflow transformations occur in <code class="docutils literal notranslate"><span class="pre">&lt;transformation&gt;</span></code> blocks and have the following input parameters:</p>
<p>Transformation element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 13%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Text</p></td>
<td></td>
<td><p>(Required)</p></td>
<td><p>Unique name for this Jastrow function.</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>Text</p></td>
<td><p>“e-I”</p></td>
<td><p>(Required)</p></td>
<td><p>Define a one-body backflow transformation.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Text</p></td>
<td><p>“e-e”</p></td>
<td></td>
<td><p>Define a two-body backflow transformation.</p></td>
</tr>
<tr class="row-odd"><td><p>function</p></td>
<td><p>Text</p></td>
<td><p>B-spline</p></td>
<td><p>(Required)</p></td>
<td><p>B-spline type transformation (no other types supported).</p></td>
</tr>
<tr class="row-even"><td><p>source</p></td>
<td><p>Text</p></td>
<td></td>
<td></td>
<td><p>“e” if two body, ion particle set if one body.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Just like one- and two-body jastrows, parameterization of the backflow transformations are specified within the <code class="docutils literal notranslate"><span class="pre">&lt;transformation&gt;</span></code> blocks by  <code class="docutils literal notranslate"><span class="pre">&lt;correlation&gt;</span></code> blocks.  Please refer to <a class="reference internal" href="#onebodyjastrowspline"><span class="std std-ref">Spline form</span></a> for more information.</p>
</div>
<div class="section" id="id24">
<h3>Example Use Case<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>Having specified the general form, we present a general example of one-body and two-body backflow transformations in a hydrogen-helium mixture.  The hydrogen and helium ions have independent backflow transformations, as do the like and unlike-spin two-body terms.  One caveat is in order:  ionic backflow transformations must be listed in the order they appear in the particle set.  If in our example, helium is listed first and hydrogen is listed second, the following example would be correct.  However, switching backflow declaration to hydrogen first then helium, will result in an error.  Outside of this, declaration of one-body blocks and two-body blocks are not sensitive to ordering.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;backflow&gt;
&lt;!--The One-Body term with independent e-He and e-H terms. IN THAT ORDER --&gt;
&lt;transformation name=&quot;eIonB&quot; type=&quot;e-I&quot; function=&quot;Bspline&quot; source=&quot;ion0&quot;&gt;
    &lt;correlation cusp=&quot;0.0&quot; size=&quot;8&quot; type=&quot;shortrange&quot; init=&quot;no&quot; elementType=&quot;He&quot; rcut=&quot;3.0&quot;&gt;
        &lt;coefficients id=&quot;eHeC&quot; type=&quot;Array&quot; optimize=&quot;yes&quot;&gt;
            0 0 0 0 0 0 0 0
        &lt;/coefficients&gt;
    &lt;/correlation&gt;
    &lt;correlation cusp=&quot;0.0&quot; size=&quot;8&quot; type=&quot;shortrange&quot; init=&quot;no&quot; elementType=&quot;H&quot; rcut=&quot;3.0&quot;&gt;
        &lt;coefficients id=&quot;eHC&quot; type=&quot;Array&quot; optimize=&quot;yes&quot;&gt;
            0 0 0 0 0 0 0 0
        &lt;/coefficients&gt;
    &lt;/correlation&gt;
&lt;/transformation&gt;

&lt;!--The Two-Body Term with Like and Unlike Spins --&gt;
&lt;transformation name=&quot;eeB&quot; type=&quot;e-e&quot; function=&quot;Bspline&quot; &gt;
    &lt;correlation cusp=&quot;0.0&quot; size=&quot;7&quot; type=&quot;shortrange&quot; init=&quot;no&quot; speciesA=&quot;u&quot; speciesB=&quot;u&quot; rcut=&quot;1.2&quot;&gt;
        &lt;coefficients id=&quot;uuB1&quot; type=&quot;Array&quot; optimize=&quot;yes&quot;&gt;
            0 0 0 0 0 0 0
        &lt;/coefficients&gt;
    &lt;/correlation&gt;
    &lt;correlation cusp=&quot;0.0&quot; size=&quot;7&quot; type=&quot;shortrange&quot; init=&quot;no&quot; speciesA=&quot;d&quot; speciesB=&quot;u&quot; rcut=&quot;1.2&quot;&gt;
        &lt;coefficients id=&quot;udB1&quot; type=&quot;Array&quot; optimize=&quot;yes&quot;&gt;
            0 0 0 0 0 0 0
        &lt;/coefficients&gt;
    &lt;/correlation&gt;
&lt;/transformation&gt;
&lt;/backflow&gt;
</pre></div>
</div>
<p>Currently, backflow works only with single-Slater determinant wavefunctions.  When a backflow transformation has been declared, it should be placed within the <code class="docutils literal notranslate"><span class="pre">&lt;determinantset&gt;</span></code> block, but outside of the <code class="docutils literal notranslate"><span class="pre">&lt;slaterdeterminant&gt;</span></code> blocks, like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;determinantset ... &gt;
    &lt;!--basis set declarations go here, if there are any --&gt;

    &lt;backflow&gt;
        &lt;transformation ...&gt;
          &lt;!--Here is where one and two-body terms are defined --&gt;
         &lt;/transformation&gt;
     &lt;/backflow&gt;

     &lt;slaterdeterminant&gt;
         &lt;!--Usual determinant definitions --&gt;
     &lt;/slaterdeterminant&gt;
 &lt;/determinantset&gt;
</pre></div>
</div>
</div>
<div class="section" id="optimization-tips">
<h3>Optimization Tips<a class="headerlink" href="#optimization-tips" title="Permalink to this headline">¶</a></h3>
<p>Backflow is notoriously difficult to optimize—it is extremely nonlinear in the variational parameters and moves the nodal surface around.  As such, it is likely that a full Jastrow+Backflow optimization with all parameters initialized to zero might not converge in a reasonable time.  If you are experiencing this problem, the following pointers are suggested (in no particular order).</p>
<div class="section" id="get-a-good-starting-guess-for-psi-t">
<h4>Get a good starting guess for <span class="math notranslate nohighlight">\(\Psi_T\)</span>:<a class="headerlink" href="#get-a-good-starting-guess-for-psi-t" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>Try optimizing the Jastrow first without backflow.</p></li>
<li><p>Freeze the Jastrow parameters, introduce only the e-e terms in the
backflow transformation, and optimize these parameters.</p></li>
<li><p>Freeze the e-e backflow parameters, and then optimize the e-I terms.</p>
<ul class="simple">
<li><p>If difficulty is encountered here, try optimizing each species
independently.</p></li>
</ul>
</li>
<li><p>Unfreeze all Jastrow, e-e backflow, and e-I backflow parameters, and
reoptimize.</p></li>
</ol>
</div>
<div class="section" id="optimizing-backflow-terms">
<h4>Optimizing Backflow Terms<a class="headerlink" href="#optimizing-backflow-terms" title="Permalink to this headline">¶</a></h4>
<p>It is possible that the previous prescription might grind to a halt in steps 2 or 3 with the inability to optimize the e-e or e-I backflow transformation independently, especially if it is initialized to zero.  One way to get around this is to build a good starting guess for the e-e or e-I backflow terms iteratively as follows:</p>
<ol class="arabic simple">
<li><p>Start off with a small number of knots initialized to zero. Set
<span class="math notranslate nohighlight">\(r_{cut}\)</span> to be small (much smaller than an interatomic distance).</p></li>
<li><p>Optimize the backflow function.</p></li>
<li><p>If this works, slowly increase <span class="math notranslate nohighlight">\(r_{cut}\)</span> and/or the number of
knots.</p></li>
<li><p>Repeat steps 2 and 3 until there is no noticeable change in energy or
variance of <span class="math notranslate nohighlight">\(\Psi_T\)</span>.</p></li>
</ol>
</div>
<div class="section" id="tweaking-the-optimization-run">
<h4>Tweaking the Optimization Run<a class="headerlink" href="#tweaking-the-optimization-run" title="Permalink to this headline">¶</a></h4>
<p>The following modifications are worth a try in the optimization block:</p>
<ul class="simple">
<li><p>Try setting “useDrift” to “no.” This eliminates the use of
wavefunction gradients and force biasing in the VMC algorithm. This
could be an issue for poorly optimized wavefunctions with
pathological gradients.</p></li>
<li><p>Try increasing “exp0” in the optimization block. Larger values of
exp0 cause the search directions to more closely follow those
predicted by steepest-descent than those by the linear method.</p></li>
</ul>
<p>Note that the new adaptive shift optimizer has not yet been tried with
backflow wavefunctions. It should perform better than the older
optimizers, but a considered optimization process is still recommended.</p>
</div>
</div>
</div>
<div class="section" id="finite-difference-linear-response-wave-functions">
<span id="fdlr"></span><h2>Finite-difference linear response wave functions<a class="headerlink" href="#finite-difference-linear-response-wave-functions" title="Permalink to this headline">¶</a></h2>
<p>The finite-difference linear response wavefunction (FDLR) is an
experimental wavefunction type described in detail in
<a class="bibtex reference internal" href="#blunt-charge-transfer-2017" id="id25">[BN17]</a>. In this method, the wavefunction is formed as the linear response of some existing trial wavefunction in QMCPACK. This derivatives of this linear response are
approximated by a simple finite difference.</p>
<p>Forming a wavefunction within the linear response space of an existing ansatz can be very powerful. For example, a configuration interaction singles (CIS) wavefunction can be formed as a linear combination of the first derivatives of a Slater determinant (with respect to its orbital rotation parameters). Thus, in this sense, CIS is the linear response of Hartree–Fock theory.</p>
<p>Forming a CIS wavefunction as the linear response of an optimizable Slater determinant is where all testing of this wavefunction has been performed. In theory, the implementation is flexible and can be used with other trial wavefunctions in QMCPACK, but this has not been tested; the FDLR trial wavefunction is experimental.</p>
<p>Mathematically, the FDLR wavefunction has the form</p>
<div class="math notranslate nohighlight" id="equation-eq25">
<span class="eqno">(25)<a class="headerlink" href="#equation-eq25" title="Permalink to this equation">¶</a></span>\[\Psi_{\textrm{FDLR}} (\mathbf{\mu}, \mathbf{X}) = \Psi (\mathbf{X} + \mathbf{\mu}) - \Psi (\mathbf{X} - \mathbf{\mu})\: ,\]</div>
<p>where <span class="math notranslate nohighlight">\(\Psi(\mathbf{P})\)</span> is some trial wavefunction in QMCPACK,
and <span class="math notranslate nohighlight">\(\mathbf{P}\)</span> is its optimizable parameters. <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>
is the “base” parameters about which the finite difference is performed
(for example, an overall orbital rotation). <span class="math notranslate nohighlight">\(\mathbf{\mu}\)</span> is the
“finite-difference” parameters, which define the direction of the
derivative, and whose magnitude determines the magnitude of the finite
difference. In the limit that the magnitude of <span class="math notranslate nohighlight">\(\mathbf{mu}\)</span> goes
to <span class="math notranslate nohighlight">\(0\)</span>, the <span class="math notranslate nohighlight">\(\Psi_{\textrm{FDLR}}\)</span> object just defined
becomes equivalent to</p>
<div class="math notranslate nohighlight" id="equation-eq26">
<span class="eqno">(26)<a class="headerlink" href="#equation-eq26" title="Permalink to this equation">¶</a></span>\[\Psi_{\textrm{FDLR}} (\mathbf{\mu}, \mathbf{X}) = \sum_{pq} \mu_{pq} \: \frac{\partial \Psi_{\textrm{det}} (\mathbf{X}) }{\partial X_{pq}}\: ,\]</div>
<p>which is the desired linear response wavefunction we are approximating.
In the case that <span class="math notranslate nohighlight">\(\Psi(\mathbf{P})\)</span> is a determinant with orbital
rotation parameters <span class="math notranslate nohighlight">\(\mathbf{P}\)</span>, the previous equation is a CIS
wavefunction with CIS expansion coefficients <span class="math notranslate nohighlight">\(\mathbf{\mu}\)</span> and
orbital rotation <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>.</p>
<div class="section" id="id26">
<h3>Input specifications<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>An FDLR wavefunction is specified within a <code class="docutils literal notranslate"><span class="pre">&lt;fdlr&gt;</span> <span class="pre">...</span> <span class="pre">&lt;/fdlr&gt;</span></code> block.</p>
<p>To fully specify an FDLR wavefunction as done previously, we require the
initial parameters for both <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{\mu}\)</span>
to be input. This therefore requires two trial wavefunctions to be
provided on input. Each of these is best specified in its own XML file.
The names of these two files are provided in an <code class="docutils literal notranslate"><span class="pre">&lt;include&gt;</span></code> tag via
<code class="docutils literal notranslate"><span class="pre">&lt;include</span> <span class="pre">wfn_x_href=“</span> <span class="pre">...</span> <span class="pre">”</span> <span class="pre">wfn_d_href=“</span> <span class="pre">...</span> <span class="pre">”&gt;</span></code>. <code class="docutils literal notranslate"><span class="pre">wfn_x_href</span></code>
specifies the file that will hold the <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> parameters.
<code class="docutils literal notranslate"><span class="pre">wfn_d_href</span></code> specifies the file that will hold the
<span class="math notranslate nohighlight">\(\mathbf{\mu}\)</span> parameters.</p>
<p>Other options inside the <code class="docutils literal notranslate"><span class="pre">&lt;include&gt;</span></code> tag are <code class="docutils literal notranslate"><span class="pre">opt_x</span></code> and <code class="docutils literal notranslate"><span class="pre">opt_d</span></code>,
which specify whether or not <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{\mu}\)</span>
parameters are optimizable, respectively.</p>
</div>
<div class="section" id="id27">
<h3>Example Use Case<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">fdlrwfn</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;FDLR&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">include</span> <span class="n">wfn_x_href</span><span class="o">=</span><span class="s2">&quot;h2.wfn_x.xml&quot;</span> <span class="n">wfn_d_href</span><span class="o">=</span><span class="s2">&quot;h2.wfn_d.xml&quot;</span> <span class="n">opt_x</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="n">opt_d</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">fdlrwfn</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>with the <code class="docutils literal notranslate"><span class="pre">h2.wfn_x.xml</span></code> file containing one of the wavefunctions and
corresponding set of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> parameters, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;wfn_x&gt;
    &lt;determinantset name=&quot;LCAOBSet&quot; type=&quot;MolecularOrbital&quot; transform=&quot;yes&quot; source=&quot;ion0&quot;&gt;
      &lt;basisset name=&quot;LCAOBSet&quot;&gt;
        &lt;atomicBasisSet name=&quot;Gaussian-G2&quot; angular=&quot;cartesian&quot; type=&quot;Gaussian&quot; elementType=&quot;H&quot; normalized=&quot;no&quot;&gt;
          &lt;grid type=&quot;log&quot; ri=&quot;1.e-6&quot; rf=&quot;1.e2&quot; npts=&quot;1001&quot;/&gt;
          &lt;basisGroup rid=&quot;H00&quot; n=&quot;0&quot; l=&quot;0&quot; type=&quot;Gaussian&quot;&gt;
            &lt;radfunc exponent=&quot;1.923840000000e+01&quot; contraction=&quot;3.282799101900e-02&quot;/&gt;
            &lt;radfunc exponent=&quot;2.898720000000e+00&quot; contraction=&quot;2.312039367510e-01&quot;/&gt;
            &lt;radfunc exponent=&quot;6.534720000000e-01&quot; contraction=&quot;8.172257764360e-01&quot;/&gt;
          &lt;/basisGroup&gt;
          &lt;basisGroup rid=&quot;H10&quot; n=&quot;1&quot; l=&quot;0&quot; type=&quot;Gaussian&quot;&gt;
            &lt;radfunc exponent=&quot;1.630642000000e-01&quot; contraction=&quot;1.000000000000e+00&quot;/&gt;
          &lt;/basisGroup&gt;
        &lt;/atomicBasisSet&gt;
      &lt;/basisset&gt;

    &lt;slaterdeterminant optimize=&quot;yes&quot;&gt;
      &lt;determinant id=&quot;det_up&quot; sposet=&quot;spo-up&quot;&gt;
        &lt;opt_vars size=&quot;3&quot;&gt;
          0.0 0.0 0.0
        &lt;/opt_vars&gt;
      &lt;/determinant&gt;

      &lt;determinant id=&quot;det_down&quot; sposet=&quot;spo-dn&quot;&gt;
        &lt;opt_vars size=&quot;3&quot;&gt;
          0.0 0.0 0.0
        &lt;/opt_vars&gt;
      &lt;/determinant&gt;
    &lt;/slaterdeterminant&gt;

      &lt;sposet basisset=&quot;LCAOBSet&quot; name=&quot;spo-up&quot; size=&quot;4&quot; optimize=&quot;yes&quot;&gt;
        &lt;occupation mode=&quot;ground&quot;/&gt;
        &lt;coefficient size=&quot;4&quot; id=&quot;updetC&quot;&gt;
  2.83630000000000e-01  3.35683000000000e-01  2.83630000000000e-01  3.35683000000000e-01
  1.66206000000000e-01  1.22367400000000e+00 -1.66206000000000e-01 -1.22367400000000e+00
  8.68279000000000e-01 -6.95081000000000e-01  8.68279000000000e-01 -6.95081000000000e-01
 -9.77898000000000e-01  1.19682400000000e+00  9.77898000000000e-01 -1.19682400000000e+00
&lt;/coefficient&gt;
      &lt;/sposet&gt;
      &lt;sposet basisset=&quot;LCAOBSet&quot; name=&quot;spo-dn&quot; size=&quot;4&quot; optimize=&quot;yes&quot;&gt;
        &lt;occupation mode=&quot;ground&quot;/&gt;
        &lt;coefficient size=&quot;4&quot; id=&quot;downdetC&quot;&gt;
  2.83630000000000e-01  3.35683000000000e-01  2.83630000000000e-01  3.35683000000000e-01
  1.66206000000000e-01  1.22367400000000e+00 -1.66206000000000e-01 -1.22367400000000e+00
  8.68279000000000e-01 -6.95081000000000e-01  8.68279000000000e-01 -6.95081000000000e-01
 -9.77898000000000e-01  1.19682400000000e+00  9.77898000000000e-01 -1.19682400000000e+00
&lt;/coefficient&gt;
      &lt;/sposet&gt;

    &lt;/determinantset&gt;
&lt;/wfn_x&gt;
</pre></div>
</div>
<p>and similarly for the <code class="docutils literal notranslate"><span class="pre">h2.wfn_d.xml</span></code> file, which will hold the initial
<span class="math notranslate nohighlight">\(\mathbf{\mu}\)</span> parameters.</p>
<p>This use case is a wavefunction file for an optimizable determinant
wavefunction for H<span class="math notranslate nohighlight">\(_2\)</span>, in a double zeta valence basis set.
Thus, the FDLR wavefunction here would perform CIS on H<span class="math notranslate nohighlight">\(_2\)</span> in a
double zeta basis set.</p>
</div>
</div>
<div class="section" id="gaussian-product-wavefunction">
<span id="ionwf"></span><h2>Gaussian Product Wavefunction<a class="headerlink" href="#gaussian-product-wavefunction" title="Permalink to this headline">¶</a></h2>
<p>The Gaussian Product wavefunction implements <a class="reference internal" href="#equation-eq27">(27)</a></p>
<div class="math notranslate nohighlight" id="equation-eq27">
<span class="eqno">(27)<a class="headerlink" href="#equation-eq27" title="Permalink to this equation">¶</a></span>\[\Psi(\vec{R}) = \prod_{i=1}^N \exp\left[ -\frac{(\vec{R}_i-\vec{R}_i^o)^2}{2\sigma_i^2} \right]\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{R}_i\)</span> is the position of the <span class="math notranslate nohighlight">\(i^{\text{th}}\)</span>
quantum particle and <span class="math notranslate nohighlight">\(\vec{R}_i^o\)</span> is its center. <span class="math notranslate nohighlight">\(\sigma_i\)</span>
is the width of the Gaussian orbital around center <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>This variational wavefunction enhances single-particle density at chosen
spatial locations with adjustable strengths. It is useful whenever such
localization is physically relevant yet not captured by other parts of
the trial wavefunction. For example, in an electron-ion simulation of a
solid, the ions are localized around their crystal lattice sites. This
single-particle localization is not captured by the ion-ion Jastrow.
Therefore, the addition of this localization term will improve the
wavefunction. The simplest use case of this wavefunction is perhaps the
quantum harmonic oscillator (please see the “tests/models/sho” folder
for examples).</p>
<p class="centered">
<strong>Input specification</strong></p><p>Gaussian Product Wavefunction (ionwf):</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 15%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Name</p></td>
<td><p>Text</p></td>
<td><p>ionwf</p></td>
<td><p>(Required)</p></td>
<td><p>Unique name for this wavefunction</p></td>
</tr>
<tr class="row-odd"><td><p>Width</p></td>
<td><p>Floats</p></td>
<td><p>1.0 -1</p></td>
<td><p>(Required)</p></td>
<td><p>Widths of Gaussian orbitals</p></td>
</tr>
<tr class="row-even"><td><p>Source</p></td>
<td><p>Text</p></td>
<td><p>ion0</p></td>
<td><p>(Required)</p></td>
<td><p>Name of classical particle set</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code> There must be one width provided for each quantum particle.
If a negative width is given, then its corresponding Gaussian orbital
is removed. Negative width is useful if one wants to use Gaussian
wavefunction for a subset of the quantum particles.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> The Gaussian centers must be specified in the form of a
classical particle set. This classical particle set is likely the ion
positions “ion0,” hence the name “ionwf.” However, arbitrary centers
can be defined using a different particle set. Please refer to the
examples in “tests/models/sho.”</p></li>
</ul>
<div class="section" id="id28">
<h3>Example Use Case<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">qmcsystem</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">simulationcell</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bconds&quot;</span><span class="o">&gt;</span>
          <span class="n">n</span> <span class="n">n</span> <span class="n">n</span>
    <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">simulationcell</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">particleset</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">group</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mass&quot;</span><span class="o">&gt;</span><span class="mf">5.0</span><span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">attrib</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;posArray&quot;</span> <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
        <span class="mf">0.0001</span> <span class="o">-</span><span class="mf">0.0001</span> <span class="mf">0.0002</span>
      <span class="o">&lt;/</span><span class="n">attrib</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">particleset</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">particleset</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">group</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">attrib</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;posArray&quot;</span> <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
        <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
      <span class="o">&lt;/</span><span class="n">attrib</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">particleset</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">wavefunction</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;e&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;psi0&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ionwf</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;iwf&quot;</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;0.8165&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">wavefunction</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">hamiltonian</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;h0&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;generic&quot;</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">extpot</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HarmonicExt&quot;</span> <span class="n">mass</span><span class="o">=</span><span class="s2">&quot;5.0&quot;</span> <span class="n">energy</span><span class="o">=</span><span class="s2">&quot;0.3&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">estimator</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;latticedeviation&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;latdev&quot;</span>
      <span class="n">target</span><span class="o">=</span><span class="s2">&quot;e&quot;</span>    <span class="n">tgroup</span><span class="o">=</span><span class="s2">&quot;u&quot;</span>
      <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ion0&quot;</span> <span class="n">sgroup</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">hamiltonian</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">qmcsystem</span><span class="o">&gt;</span>
</pre></div>
</div>
<p id="bibtex-bibliography-intro_wavefunction-0"><dl class="citation">
<dt class="bibtex label" id="blips4qmc"><span class="brackets"><a class="fn-backref" href="#id4">AlfeG04</a></span></dt>
<dd><p>D. Alfè and M. J. Gillan. An efficient localized basis set for quantum Monte Carlo calculations on condensed matter. <em>Physical Review B</em>, 70(16):161101, 2004.</p>
</dd>
<dt class="bibtex label" id="blunt-charge-transfer-2017"><span class="brackets"><a class="fn-backref" href="#id25">BN17</a></span></dt>
<dd><p>N. S. Blunt and Eric Neuscamman. Charge-transfer excited states: Seeking a balanced and efficient wave function ansatz in variational Monte Carlo. <em>The Journal of Chemical Physics</em>, 147(19):194101, November 2017. <a class="reference external" href="https://doi.org/10.1063/1.4998197">doi:10.1063/1.4998197</a>.</p>
</dd>
<dt class="bibtex label" id="ceperley1978"><span class="brackets">Cep78</span><span class="fn-backref">(<a href="#id17">1</a>,<a href="#id18">2</a>)</span></dt>
<dd><p>D. Ceperley. Ground state of the fermion one-component plasma: a monte carlo study in two and three dimensions. <em>Phys. Rev. B</em>, 18:3126–3138, October 1978. URL: <a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevB.18.3126">https://link.aps.org/doi/10.1103/PhysRevB.18.3126</a>, <a class="reference external" href="https://doi.org/10.1103/PhysRevB.18.3126">doi:10.1103/PhysRevB.18.3126</a>.</p>
</dd>
<dt class="bibtex label" id="drummond2004"><span class="brackets"><a class="fn-backref" href="#id19">DTN04</a></span></dt>
<dd><p>N. D. Drummond, M. D. Towler, and R. J. Needs. Jastrow correlation factor for atoms, molecules, and solids. <em>Physical Review B - Condensed Matter and Materials Physics</em>, 70(23):1–11, 2004. <a class="reference external" href="https://doi.org/10.1103/PhysRevB.70.235119">doi:10.1103/PhysRevB.70.235119</a>.</p>
</dd>
<dt class="bibtex label" id="caffarel2013"><span class="brackets"><a class="fn-backref" href="#id22">EG13</a></span></dt>
<dd><p>M. Caffarel E. Giner, A. Scemama. Using perturbatively selected configuration interaction in quantum monte carlo calculations. <em>Canadian Journal of Chemistry</em>, 91:9, 2013.</p>
</dd>
<dt class="bibtex label" id="eslerkimceperleyshulenburger2012"><span class="brackets">EKCS12</span><span class="fn-backref">(<a href="#id6">1</a>,<a href="#id10">2</a>)</span></dt>
<dd><p>Kenneth P. Esler, Jeongnim Kim, David M. Ceperley, and Luke Shulenburger. Accelerating quantum monte carlo simulations of real materials on gpu clusters. <em>Computing in Science and Engineering</em>, 14(1):40–51, 2012. <a class="reference external" href="https://doi.org/http://doi.ieeecomputersociety.org/10.1109/MCSE.2010.122">doi:http://doi.ieeecomputersociety.org/10.1109/MCSE.2010.122</a>.</p>
</dd>
<dt class="bibtex label" id="fahy1990"><span class="brackets"><a class="fn-backref" href="#id1">FWL90</a></span></dt>
<dd><p>S. Fahy, X. W. Wang, and Steven G. Louie. Variational quantum Monte Carlo nonlocal pseudopotential approach to solids: Formulation and application to diamond, graphite, and silicon. <em>Physical Review B</em>, 42(6):3503–3522, 1990. <a class="reference external" href="https://doi.org/10.1103/PhysRevB.42.3503">doi:10.1103/PhysRevB.42.3503</a>.</p>
</dd>
<dt class="bibtex label" id="gaskell1961"><span class="brackets"><a class="fn-backref" href="#id15">Gas61</a></span></dt>
<dd><p>T Gaskell. The collective treatment of a fermi gas: ii. <em>Proceedings of the Physical Society</em>, 77(6):1182, 1961. URL: <a class="reference external" href="http://stacks.iop.org/0370-1328/77/i=6/a=312">http://stacks.iop.org/0370-1328/77/i=6/a=312</a>.</p>
</dd>
<dt class="bibtex label" id="gaskell1962"><span class="brackets"><a class="fn-backref" href="#id16">Gas62</a></span></dt>
<dd><p>T Gaskell. The collective treatment of many-body systems: iii. <em>Proceedings of the Physical Society</em>, 80(5):1091, 1962. URL: <a class="reference external" href="http://stacks.iop.org/0370-1328/80/i=5/a=307">http://stacks.iop.org/0370-1328/80/i=5/a=307</a>.</p>
</dd>
<dt class="bibtex label" id="kato"><span class="brackets"><a class="fn-backref" href="#id7">Kat51</a></span></dt>
<dd><p>T Kato. Fundamental properties of hamiltonian operators of the schrodinger type. <em>Transactions of the American Mathematical Society</em>, 70:195–211, 1951.</p>
</dd>
<dt class="bibtex label" id="luo2018hyb"><span class="brackets"><a class="fn-backref" href="#id5">LEKS18</a></span></dt>
<dd><p>Ye Luo, Kenneth P. Esler, Paul R. C. Kent, and Luke Shulenburger. An efficient hybrid orbital representation for quantum monte carlo calculations. <em>The Journal of Chemical Physics</em>, 149(8):084107, 2018.</p>
</dd>
<dt class="bibtex label" id="luo2018delayedupdate"><span class="brackets"><a class="fn-backref" href="#id2">LK18</a></span></dt>
<dd><p>Ye Luo and Jeongnim Kim. An highly efficient delayed update algorithm for evaluating slater determinants in quantum monte carlo. <em>in preparation</em>, ():, 2018.</p>
</dd>
<dt class="bibtex label" id="mcdaniel2017"><span class="brackets"><a class="fn-backref" href="#id3">MDAzevedoL+17</a></span></dt>
<dd><p>T. McDaniel, E. F. D’Azevedo, Y. W. Li, K. Wong, and P. R. C. Kent. Delayed slater determinant update algorithms for high efficiency quantum monte carlo. <em>The Journal of Chemical Physics</em>, 147(17):174107, November 2017. <a class="reference external" href="https://doi.org/10.1063/1.4998616">doi:10.1063/1.4998616</a>.</p>
</dd>
<dt class="bibtex label" id="natoli1995"><span class="brackets">NC95</span><span class="fn-backref">(<a href="#id13">1</a>,<a href="#id14">2</a>)</span></dt>
<dd><p>Vincent Natoli and David M. Ceperley. An optimized method for treating long-range potentials. <em>Journal of Computational Physics</em>, 117(1):171 – 178, 1995. URL: <a class="reference external" href="http://www.sciencedirect.com/science/article/pii/S0021999185710546">http://www.sciencedirect.com/science/article/pii/S0021999185710546</a>, <a class="reference external" href="https://doi.org/http://dx.doi.org/10.1006/jcph.1995.1054">doi:http://dx.doi.org/10.1006/jcph.1995.1054</a>.</p>
</dd>
<dt class="bibtex label" id="qp"><span class="brackets"><a class="fn-backref" href="#id23">Sce17</a></span></dt>
<dd><p>A. Scemamma. Quantum package. <span><a class="reference external" href="#"></a></span>https://github.com/LCPQ/quantum_package, 2013–2017.</p>
</dd>
<dt class="bibtex label" id="schmidt93"><span class="brackets"><a class="fn-backref" href="#id21">SBB+93</a></span></dt>
<dd><p>Michael W. Schmidt, Kim K. Baldridge, Jerry A. Boatz, Steven T. Elbert, Mark S. Gordon, Jan H. Jensen, Shiro Koseki, Nikita Matsunaga, Kiet A. Nguyen, Shujun Su, Theresa L. Windus, Michel Dupuis, and John A. Montgomery. General atomic and molecular electronic structure system. <em>Journal of Computational Chemistry</em>, 14(11):1347–1363, 1993. URL: <a class="reference external" href="http://dx.doi.org/10.1002/jcc.540141112">http://dx.doi.org/10.1002/jcc.540141112</a>, <a class="reference external" href="https://doi.org/10.1002/jcc.540141112">doi:10.1002/jcc.540141112</a>.</p>
</dd>
</dl>
</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hamiltonianobservable.html" class="btn btn-neutral float-right" title="Hamiltonian and Observables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="simulationcell.html" class="btn btn-neutral float-left" title="Specifying the system to be simulated" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, QMCPACK Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
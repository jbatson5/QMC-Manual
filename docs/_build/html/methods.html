

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quantum Monte Carlo Methods &mdash; QMC Manual 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Hamiltonian and Observables" href="hamiltonianobservable.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> QMC Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features of QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Obtaining, installing, and validating QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units used in QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_overview.html">Input file overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulationcell.html">Specifying the system to be simulated</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_wavefunction.html">Trial wavefunction specificaion</a></li>
<li class="toctree-l1"><a class="reference internal" href="hamiltonianobservable.html">Hamiltonian and Observables</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quantum Monte Carlo Methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#variational-monte-carlo">Variational Monte Carlo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wavefunction-optimization">Wavefunction optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vmc-run-for-the-optimization">VMC run for the optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#correlated-sampling-and-cost-function">Correlated sampling and cost function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimizers">Optimizers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oneshiftonly-optimizer">OneShiftOnly Optimizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adaptive-organizer">Adaptive Organizer</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QMC Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Quantum Monte Carlo Methods</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/methods.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quantum-monte-carlo-methods">
<span id="qmcmethods"></span><h1>Quantum Monte Carlo Methods<a class="headerlink" href="#quantum-monte-carlo-methods" title="Permalink to this headline">Â¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">qmc</span></code> factory element:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Parent elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">simulation,</span> <span class="pre">loop</span></code></p></td>
</tr>
<tr class="row-even"><td><p>type selector</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">method</span></code> attribute</p></td>
</tr>
</tbody>
</table>
<p>type options:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>vmc</p></td>
<td><p>Variational Monte Carlo</p></td>
</tr>
<tr class="row-even"><td><p>linear</p></td>
<td><p>Wavefunction optimization with linear method</p></td>
</tr>
<tr class="row-odd"><td><p>dmc</p></td>
<td><p>Diffusion Monte Carlo</p></td>
</tr>
<tr class="row-even"><td><p>rmc</p></td>
<td><p>Reptation Monte Carlo</p></td>
</tr>
</tbody>
</table>
<p>shared attributes:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 14%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">method</span></code></p></td>
<td><p>text</p></td>
<td><p>listed above</p></td>
<td><p>invalid</p></td>
<td><p>QMC driver</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">move</span></code></p></td>
<td><p>text</p></td>
<td><p>pbyp, alle</p></td>
<td><p>pbyp</p></td>
<td><p>Method used to move electrons</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">gpu</span></code></p></td>
<td><p>text</p></td>
<td><p>yes/no</p></td>
<td><p>dep.</p></td>
<td><p>Use the GPU</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">trace</span></code></p></td>
<td><p>text</p></td>
<td></td>
<td><p>no</p></td>
<td><p>???</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code></p></td>
<td><p>integer</p></td>
<td><p>-1, 0, n</p></td>
<td><p>-1</p></td>
<td><p>Checkpoint frequency</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">record</span></code></p></td>
<td><p>integer</p></td>
<td><p>n</p></td>
<td><p>0</p></td>
<td><p>Save configuration ever n steps</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target</span></code></p></td>
<td><p>text</p></td>
<td></td>
<td></td>
<td><p>???</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">completed</span></code></p></td>
<td><p>text</p></td>
<td></td>
<td></td>
<td><p>???</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">append</span></code></p></td>
<td><p>text</p></td>
<td><p>yes/no</p></td>
<td><p>no</p></td>
<td><p>???</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">move</span></code>: There are two ways to move electrons. The more used method
is the particle-by-particle move. In this method, only one electron
is moved for acceptance or rejection. The other method is the
all-electron move; namely, all the electrons are moved once for
testing acceptance or rejection.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpu</span></code>: When the executable is compiled with CUDA, the target
computing device can be chosen by this switch. With a regular
CPU-only compilation, this option is not effective.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>: This enables and disables checkpointing and
specifying the frequency of output. Possible values are:</p>
<ul>
<li><p><strong>[-1]</strong> No checkpoint (default setting).</p></li>
<li><p><strong>[0]</strong> Dump after the completion of a QMC section.</p></li>
<li><p><strong>[n]</strong> Dump after every <span class="math notranslate nohighlight">\(n\)</span> blocks.  Also dump at the end of the run.</p></li>
</ul>
</li>
</ul>
<p>The particle configurations are written to a <code class="docutils literal notranslate"><span class="pre">.config.h5</span></code> file.</p>
<div class="literal-block-wrapper docutils container" id="listing-42">
<div class="code-block-caption"><span class="caption-number">Listing 42 </span><span class="caption-text">The following is an example of running a simulation that can be restarted.</span><a class="headerlink" href="#listing-42" title="Permalink to this code">Â¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">qmc</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;dmc&quot;</span> <span class="n">move</span><span class="o">=</span><span class="s2">&quot;pbyp&quot;</span>  <span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;timestep&quot;</span><span class="o">&gt;</span>         <span class="mf">0.004</span>  <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;blocks&quot;</span><span class="o">&gt;</span>           <span class="mi">100</span>   <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="o">&gt;</span>            <span class="mi">400</span>    <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">qmc</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>The checkpoint flag instructs QMCPACK to output walker configurations.  This also
works in VMC.  This outputs an h5 file with the name <code class="docutils literal notranslate"><span class="pre">projectid.run-number.config.h5</span></code>.
Check that this file exists before attempting a restart.</p>
<p>To continue a run, specify the <code class="docutils literal notranslate"><span class="pre">mcwalkerset</span></code> element before your VMC/DMC block:</p>
<div class="literal-block-wrapper docutils container" id="listing-43">
<div class="code-block-caption"><span class="caption-number">Listing 43 </span><span class="caption-text">Restart (read walkers from previous run).</span><a class="headerlink" href="#listing-43" title="Permalink to this code">Â¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">mcwalkerset</span> <span class="n">fileroot</span><span class="o">=</span><span class="s2">&quot;BH.s002&quot;</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0 6&quot;</span> <span class="n">collected</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">/&gt;</span>
 <span class="o">&lt;</span><span class="n">qmc</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;dmc&quot;</span> <span class="n">move</span><span class="o">=</span><span class="s2">&quot;pbyp&quot;</span>  <span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;timestep&quot;</span><span class="o">&gt;</span>         <span class="mf">0.004</span>  <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;blocks&quot;</span><span class="o">&gt;</span>           <span class="mi">100</span>   <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="o">&gt;</span>            <span class="mi">400</span>    <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">qmc</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BH</span></code> is the project id, and <code class="docutils literal notranslate"><span class="pre">s002</span></code> is the calculation number to read in the walkers from the previous run.</p>
<p>In the project id section, make sure that the series number is different from any existing ones to avoid overwriting them.</p>
<div class="section" id="variational-monte-carlo">
<span id="vmc"></span><h2>Variational Monte Carlo<a class="headerlink" href="#variational-monte-carlo" title="Permalink to this headline">Â¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">vmc</span></code> method:</p>
<blockquote>
<div><p>parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 11%" />
<col style="width: 19%" />
<col style="width: 10%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">walkers</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>dep.</p></td>
<td><p>Number of walkers per MPI task</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">blocks</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(\geq 0\)</span></p></td>
<td><p>1</p></td>
<td><p>Number of blocks</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">steps</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(\geq 0\)</span></p></td>
<td><p>1</p></td>
<td><p>Number of steps per block</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">warmupsteps</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(\geq 0\)</span></p></td>
<td><p>0</p></td>
<td><p>Number of steps for warming up</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">substeps</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(\geq 0\)</span></p></td>
<td><p>1</p></td>
<td><p>Number of substeps per step</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">usedrift</span></code></p></td>
<td><p>text</p></td>
<td><p>yes,no</p></td>
<td><p>yes</p></td>
<td><p>Use the algorithm with drift</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">timestep</span></code></p></td>
<td><p>real</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>0.1</p></td>
<td><p>Time step for each electron move</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">samples</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(\geq 0\)</span></p></td>
<td><p>0</p></td>
<td><p>Number of walker samples for DMC/optimization</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">stepsbetweensamples</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>1</p></td>
<td><p>Period of sample accumulation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">samplesperthread</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(\geq 0\)</span></p></td>
<td><p>0</p></td>
<td><p>Number of samples per thread</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">storeconfigs</span></code></p></td>
<td><p>integer</p></td>
<td><p>all values</p></td>
<td><p>0</p></td>
<td><p>Show configurations o</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">blocks_between_recompute</span></code></p></td>
<td><p>integer</p></td>
<td><p><span class="math notranslate nohighlight">\(\geq 0\)</span></p></td>
<td><p>dep.</p></td>
<td><p>Wavefunction recompute frequency</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">walkers</span></code> The number of walkers per MPI task. The initial default number of ixml{walkers} is one per OpenMP thread or per MPI task if threading is disabled. The number is rounded down to a multiple of the number of threads with a minimum of one per thread to ensure perfect load balancing. One walker per thread is created in the event fewer <code class="docutils literal notranslate"><span class="pre">walkers</span></code> than threads are requested.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blocks</span></code> This parameter is universal for all the QMC
methods. The MC processes are divided into a number of
<code class="docutils literal notranslate"><span class="pre">blocks</span></code>, each containing a number of steps. At the end of each block,
the statistics accumulated in the block are dumped into files,
e.g., <code class="docutils literal notranslate"><span class="pre">scalar.dat</span></code>. Typically, each block should have a sufficient number of steps that the I/O at the end of each block is negligible
compared with the computational cost. Each block should not take so
long that monitoring its progress is difficult. There should be a
sufficient number of <code class="docutils literal notranslate"><span class="pre">blocks</span></code> to perform statistical analysis.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">warmupsteps</span></code> - <code class="docutils literal notranslate"><span class="pre">warmupsteps</span></code> are used only for
equilibration. Property measurements are not performed during
warm-up steps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">steps</span></code> - <code class="docutils literal notranslate"><span class="pre">steps</span></code> are the number of energy and other property measurements to perform per block.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">substeps</span></code>  For each substep, an attempt is made to move each of the electrons once only by either particle-by-particle or an
all-electron move.  Because the local energy is evaluated only at
each full step and not each substep, <code class="docutils literal notranslate"><span class="pre">substeps</span></code> are computationally cheaper
and can be used to reduce the correlation between property measurements
at a lower cost.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usedrift</span></code> The VMC is implemented in two algorithms with
or without drift. In the no-drift algorithm, the move of each
electron is proposed with a Gaussian distribution. The standard
deviation is chosen as the time step input. In the drift algorithm,
electrons are moved by Langevin dynamics.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestep</span></code> The meaning of time step depends on whether or not
the drift is used. In general, larger time steps reduce the
time correlation but might also reduce the acceptance ratio,
reducing overall statistical efficiency. For VMC, typically the
acceptance ratio should be close to 50% for an efficient
simulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples</span></code> Seperate from conventional energy and other
property measurements, samples refers to storing whole electron
configurations in memory (âwalker samplesâ) as would be needed by subsequent
wavefunction optimization or DMC steps. <em>A standard VMC run to
measure the energy does not need samples to be set.</em></p>
<div class="math notranslate nohighlight">
\[\texttt{samples}=
\frac{\texttt{blocks}\cdot\texttt{steps}\cdot\texttt{walkers}}{\texttt{stepsbetweensamples}}\cdot\texttt{number of MPI tasks}\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">samplesperthread</span></code> This is an alternative way to set the target amount of samples and can be useful when preparing a stored population for a subsequent DMC calculation.</p>
<div class="math notranslate nohighlight">
\[\texttt{samplesperthread}=
\frac{\texttt{blocks}\cdot\texttt{steps}}{\texttt{stepsbetweensamples}}\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">stepsbetweensamples</span></code> Because samples generated by consecutive steps are correlated, having <code class="docutils literal notranslate"><span class="pre">stepsbetweensamples</span></code> larger than 1 can be used to reduces that correlation. In practice, using larger substeps is cheaper than using <code class="docutils literal notranslate"><span class="pre">stepsbetweensamples</span></code> to decorrelate samples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">storeconfigs</span></code> If <code class="docutils literal notranslate"><span class="pre">storeconfigs</span></code> is set to a nonzero value, then electron configurations during the VMC run are saved to files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blocks_between_recompute</span></code> Recompute the accuracy critical determinant part of the wavefunction
from scratch: =1 by default when using mixed precision. =0 (no
recompute) by default when not using mixed precision. Recomputing
introduces a performance penalty dependent on system size.</p></li>
</ul>
<p>An example VMC section for a simple VMC run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">qmc</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vmc&quot;</span> <span class="n">move</span><span class="o">=</span><span class="s2">&quot;pbyp&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">estimator</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LocalEnergy&quot;</span> <span class="n">hdf5</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="o">&gt;</span>    <span class="mi">256</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;warmupSteps&quot;</span><span class="o">&gt;</span>  <span class="mi">100</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;substeps&quot;</span><span class="o">&gt;</span>  <span class="mi">5</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;blocks&quot;</span><span class="o">&gt;</span>  <span class="mi">20</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="o">&gt;</span>  <span class="mi">100</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;timestep&quot;</span><span class="o">&gt;</span>  <span class="mf">1.0</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;usedrift&quot;</span><span class="o">&gt;</span>   <span class="n">yes</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">qmc</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here we set 256 <code class="docutils literal notranslate"><span class="pre">walkers</span></code> per MPI, have a brief initial equilibration of 100 <code class="docutils literal notranslate"><span class="pre">steps</span></code>, and then have 20 <code class="docutils literal notranslate"><span class="pre">blocks</span></code> of 100 <code class="docutils literal notranslate"><span class="pre">steps</span></code> with 5 <code class="docutils literal notranslate"><span class="pre">substeps</span></code> each.</p>
<p>The following is an example of VMC section storing configurations (walker samples) for optimization.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">qmc</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vmc&quot;</span> <span class="n">move</span><span class="o">=</span><span class="s2">&quot;pbyp&quot;</span> <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">estimator</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LocalEnergy&quot;</span> <span class="n">hdf5</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="o">&gt;</span>    <span class="mi">256</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;samples&quot;</span><span class="o">&gt;</span>    <span class="mi">2867200</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;stepsbetweensamples&quot;</span><span class="o">&gt;</span>    <span class="mi">1</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;substeps&quot;</span><span class="o">&gt;</span>  <span class="mi">5</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;warmupSteps&quot;</span><span class="o">&gt;</span>  <span class="mi">5</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;blocks&quot;</span><span class="o">&gt;</span>  <span class="mi">70</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;timestep&quot;</span><span class="o">&gt;</span>  <span class="mf">1.0</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;usedrift&quot;</span><span class="o">&gt;</span>   <span class="n">no</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">qmc</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="wavefunction-optimization">
<span id="optimization"></span><h2>Wavefunction optimization<a class="headerlink" href="#wavefunction-optimization" title="Permalink to this headline">Â¶</a></h2>
<p>Optimizing wavefunction is critical in all kinds of real-space QMC calculations
because it significantly improves both the accuracy and efficiency of computation.
However, it is very difficult to directly adopt deterministic minimization approaches because of the stochastic nature of evaluating quantities with MC.
Thanks to the algorithmic breakthrough during the first decade of this century and the tremendous computer power available,
it is now feasible to optimize tens of thousands of parameters in a wavefunction for a solid or molecule.
QMCPACK has multiple optimizers implemented based on the state-of-the-art linear method.
We are continually improving our optimizers for robustness and friendliness and are trying to provide a single solution.
Because of the large variation of wavefunction types carrying distinct characteristics, using several optimizers might be needed in some cases.
We strongly suggested reading recommendations from the experts who maintain these optimizers.</p>
<p>A typical optimization block looks like the following. It starts with method=âlinearâ and contains three blocks of parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;loop max=&quot;10&quot;&gt;
 &lt;qmc method=&quot;linear&quot; move=&quot;pbyp&quot; gpu=&quot;yes&quot;&gt;
   &lt;!-- Specify the VMC options --&gt;
   &lt;parameter name=&quot;walkers&quot;&gt;              256 &lt;/parameter&gt;
   &lt;parameter name=&quot;samples&quot;&gt;          2867200 &lt;/parameter&gt;
   &lt;parameter name=&quot;stepsbetweensamples&quot;&gt;    1 &lt;/parameter&gt;
   &lt;parameter name=&quot;substeps&quot;&gt;               5 &lt;/parameter&gt;
   &lt;parameter name=&quot;warmupSteps&quot;&gt;            5 &lt;/parameter&gt;
   &lt;parameter name=&quot;blocks&quot;&gt;                70 &lt;/parameter&gt;
   &lt;parameter name=&quot;timestep&quot;&gt;             1.0 &lt;/parameter&gt;
   &lt;parameter name=&quot;usedrift&quot;&gt;              no &lt;/parameter&gt;
   &lt;estimator name=&quot;LocalEnergy&quot; hdf5=&quot;no&quot;/&gt;
   ...
   &lt;!-- Specify the correlated sampling options and define the cost function --&gt;
   &lt;parameter name=&quot;minwalkers&quot;&gt;            0.3 &lt;/parameter&gt;
        &lt;cost name=&quot;energy&quot;&gt;               0.95 &lt;/cost&gt;
        &lt;cost name=&quot;unreweightedvariance&quot;&gt; 0.00 &lt;/cost&gt;
        &lt;cost name=&quot;reweightedvariance&quot;&gt;   0.05 &lt;/cost&gt;
   ...
   &lt;!-- Specify the optimizer options --&gt;
   &lt;parameter name=&quot;MinMethod&quot;&gt;    OneShiftOnly &lt;/parameter&gt;
   ...
 &lt;/qmc&gt;
&lt;/loop&gt;

-  Loop is helpful to repeatedly execute identical optimization blocks.

-  The first part is highly identical to a regular VMC block.

-  The second part is to specify the correlated sampling options and
   define the cost function.

-  The last part is used to specify the options of different optimizers,
   which can be very distinct from one to another.
</pre></div>
</div>
<div class="section" id="vmc-run-for-the-optimization">
<h3>VMC run for the optimization<a class="headerlink" href="#vmc-run-for-the-optimization" title="Permalink to this headline">Â¶</a></h3>
<p>The VMC calculation for the wavefunction optimization has a strict requirement
that <code class="docutils literal notranslate"><span class="pre">samples</span></code> or <code class="docutils literal notranslate"><span class="pre">samplesperthread</span></code> must be specified because of the optimizer needs for the stored <code class="docutils literal notranslate"><span class="pre">samples</span></code>.
The input parameters of this part are identical to the VMC method.</p>
<p>Recommendations:</p>
<ul class="simple">
<li><p>Run the inclusive VMC calculation correctly and efficiently because
this takes a significant amount of time during optimization. For
example, make sure the derived <code class="docutils literal notranslate"><span class="pre">steps</span></code> per block is 1 and use larger <code class="docutils literal notranslate"><span class="pre">substeps</span></code> to
control the correlation between <code class="docutils literal notranslate"><span class="pre">samples</span></code>.</p></li>
<li><p>A reasonable starting wavefunction is necessary. A lot of
optimization fails because of a bad wavefunction starting point. The
sign of a bad initial wavefunction includes but is not limited to a
very long equilibration time, low acceptance ratio, and huge
variance. The first thing to do after a failed optimization is to
check the information provided by the VMC calculation via
<code class="docutils literal notranslate"><span class="pre">*.scalar.dat</span> <span class="pre">files</span></code>.</p></li>
</ul>
</div>
<div class="section" id="correlated-sampling-and-cost-function">
<h3>Correlated sampling and cost function<a class="headerlink" href="#correlated-sampling-and-cost-function" title="Permalink to this headline">Â¶</a></h3>
<p>After generating the samples with VMC, the derivatives of the wavefunction with respect to the parameters are computed for proposing a new set of parameters by optimizers.
And later, a correlated sampling calculation is performed to quickly evaluate values of the cost function on the old set of parameters and the new set for further decisions.
The input parameters are listed in the following table.</p>
<p><code class="docutils literal notranslate"><span class="pre">linear</span></code> method:</p>
<blockquote>
<div><p>parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 13%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nonlocalpp</span></code></p></td>
<td><p>text</p></td>
<td><p>yes, no</p></td>
<td><p>no</p></td>
<td><p>include non-local PP energy in the cost function</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">minwalkers</span></code></p></td>
<td><p>real</p></td>
<td><p>0â1</p></td>
<td><p>0.3</p></td>
<td><p>Lower bound of the effective weight</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">maxWeight</span></code></p></td>
<td><p>real</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 1\)</span></p></td>
<td><p>1e6</p></td>
<td><p>Maximum weight allowed in reweighting</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maxWeight</span></code> The default should be good.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nonlocalpp</span></code> The <code class="docutils literal notranslate"><span class="pre">nonlocalpp</span></code> contribution to the local energy depends on the
wavefunction. When a new set of parameters is proposed, this
contribution needs to be updated if the cost function consists of local
energy. Fortunately, nonlocal contribution is chosen small when making a
PP for small locality error. We can ignore its change and avoid the
expensive computational cost. An implementation issue with GPU code is
that a large amount of memory is consumed with this option.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minwalkers</span></code> This is a <code class="docutils literal notranslate"><span class="pre">critical</span></code> parameter. When the ratio of effective samples to actual number of samples in a reweighting step goes lower than <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code>,
the proposed set of parameters is invalid.</p></li>
</ul>
<p>The cost function consists of three components: energy, unreweighted variance, and reweighted variance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">cost</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="o">&gt;</span>                   <span class="mf">0.95</span> <span class="o">&lt;/</span><span class="n">cost</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">cost</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;unreweightedvariance&quot;</span><span class="o">&gt;</span>     <span class="mf">0.00</span> <span class="o">&lt;/</span><span class="n">cost</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">cost</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;reweightedvariance&quot;</span><span class="o">&gt;</span>       <span class="mf">0.05</span> <span class="o">&lt;/</span><span class="n">cost</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="optimizers">
<h3>Optimizers<a class="headerlink" href="#optimizers" title="Permalink to this headline">Â¶</a></h3>
<p>QMCPACK implements a number of different optimizers each with different
priorities for accuracy, convergence, memory usage, and stability. The
optimizers can be switched among âOneShiftOnlyâ (default), âadaptive,â
âdescent,â âhybrid,â and âquarticâ (old) using the following line in the
optimization block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MinMethod&quot;</span><span class="o">&gt;</span> <span class="n">THE</span> <span class="n">METHOD</span> <span class="n">YOU</span> <span class="n">LIKE</span> <span class="o">&lt;/</span><span class="n">parameter</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="oneshiftonly-optimizer">
<h3>OneShiftOnly Optimizer<a class="headerlink" href="#oneshiftonly-optimizer" title="Permalink to this headline">Â¶</a></h3>
<p>The OneShiftOnly optimizer targets a fast optimization by moving parameters more aggressively. It works with OpenMP and GPU and can be considered for large systems.
This method relies on the effective weight of correlated sampling rather than the cost function value to justify a new set of parameters.
If the effective weight is larger than <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code>, the new set is taken whether or not the cost function value decreases.
If a proposed set is rejected, the standard output prints the measured ratio of effective samples to the total number of samples
and adjustment on <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code> can be made if needed.</p>
<p><code class="docutils literal notranslate"><span class="pre">linear</span></code> method:</p>
<blockquote>
<div><p>parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Values</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">shift_i</span></code></p></td>
<td><p>real</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>0.01</p></td>
<td><p>Direct stabilizer added to the Hamiltonian matrix</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">shift_s</span></code></p></td>
<td><p>real</p></td>
<td><p><span class="math notranslate nohighlight">\(&gt; 0\)</span></p></td>
<td><p>1.00</p></td>
<td><p>Initial stabilizer based on the overlap matrix</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shift_i</span></code> This is the direct term added to the diagonal of the Hamiltonian
matrix. It provides more stable but slower optimization with a large
value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift_s</span></code> This is the initial value of the stabilizer based on the overlap
matrix added to the Hamiltonian matrix. It provides more stable but
slower optimization with a large value. The used value is
auto-adjusted by the optimizer.</p></li>
</ul>
<p>Recommendations:</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">shift_i</span></code>, <code class="docutils literal notranslate"><span class="pre">shift_s</span></code> should be fine.</p></li>
<li><p>For hard cases, increasing <code class="docutils literal notranslate"><span class="pre">shift_i</span></code> (by a factor of 5 or 10) can significantly stabilize the optimization by reducing the pace towards the optimal parameter set.</p></li>
<li><p>If the VMC energy of the last optimization iterations grows significantly, increase <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code> closer to 1 and make the optimization stable.</p></li>
<li><p>If the first iterations of optimization are rejected on a reasonable initial wavefunction,
lower the <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code> value based on the measured value printed in the standard output to accept the move.</p></li>
</ul>
<p>We recommended using this optimizer in two sections with a very small <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code> in the first and a large value in the second, such as the following.
In the very beginning, parameters are far away from optimal values and large changes are proposed by the optimizer.
Having a small <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code> makes it much easier to accept these changes.
When the energy gradually converges, we can have a large <code class="docutils literal notranslate"><span class="pre">minwalkers</span></code> to avoid risky parameter sets.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;loop max=&quot;6&quot;&gt;
 &lt;qmc method=&quot;linear&quot; move=&quot;pbyp&quot; gpu=&quot;yes&quot;&gt;
   &lt;!-- Specify the VMC options --&gt;
   &lt;parameter name=&quot;walkers&quot;&gt;                1 &lt;/parameter&gt;
   &lt;parameter name=&quot;samples&quot;&gt;            10000 &lt;/parameter&gt;
   &lt;parameter name=&quot;stepsbetweensamples&quot;&gt;    1 &lt;/parameter&gt;
   &lt;parameter name=&quot;substeps&quot;&gt;               5 &lt;/parameter&gt;
   &lt;parameter name=&quot;warmupSteps&quot;&gt;            5 &lt;/parameter&gt;
   &lt;parameter name=&quot;blocks&quot;&gt;                25 &lt;/parameter&gt;
   &lt;parameter name=&quot;timestep&quot;&gt;             1.0 &lt;/parameter&gt;
   &lt;parameter name=&quot;usedrift&quot;&gt;              no &lt;/parameter&gt;
   &lt;estimator name=&quot;LocalEnergy&quot; hdf5=&quot;no&quot;/&gt;
   &lt;!-- Specify the optimizer options --&gt;
   &lt;parameter name=&quot;MinMethod&quot;&gt;    OneShiftOnly &lt;/parameter&gt;
   &lt;parameter name=&quot;minwalkers&quot;&gt;           1e-4 &lt;/parameter&gt;
 &lt;/qmc&gt;
&lt;/loop&gt;
&lt;loop max=&quot;12&quot;&gt;
 &lt;qmc method=&quot;linear&quot; move=&quot;pbyp&quot; gpu=&quot;yes&quot;&gt;
   &lt;!-- Specify the VMC options --&gt;
   &lt;parameter name=&quot;walkers&quot;&gt;                1 &lt;/parameter&gt;
   &lt;parameter name=&quot;samples&quot;&gt;            20000 &lt;/parameter&gt;
   &lt;parameter name=&quot;stepsbetweensamples&quot;&gt;    1 &lt;/parameter&gt;
   &lt;parameter name=&quot;substeps&quot;&gt;               5 &lt;/parameter&gt;
   &lt;parameter name=&quot;warmupSteps&quot;&gt;            2 &lt;/parameter&gt;
   &lt;parameter name=&quot;blocks&quot;&gt;                50 &lt;/parameter&gt;
   &lt;parameter name=&quot;timestep&quot;&gt;             1.0 &lt;/parameter&gt;
   &lt;parameter name=&quot;usedrift&quot;&gt;              no &lt;/parameter&gt;
   &lt;estimator name=&quot;LocalEnergy&quot; hdf5=&quot;no&quot;/&gt;
   &lt;!-- Specify the optimizer options --&gt;
   &lt;parameter name=&quot;MinMethod&quot;&gt;    OneShiftOnly &lt;/parameter&gt;
   &lt;parameter name=&quot;minwalkers&quot;&gt;            0.5 &lt;/parameter&gt;
 &lt;/qmc&gt;
&lt;/loop&gt;
</pre></div>
</div>
<p>For each optimization step, you will see</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The new set of parameters is valid. Updating the trial wave function!
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The new set of parameters is not valid. Revert to the old set!
</pre></div>
</div>
<p>Occasional rejection is fine. Frequent rejection indicates potential
problems, and users should inspect the VMC calculation or change
optimization strategy. To track the progress of optimization, use the
command <code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-q</span> <span class="pre">ev</span> <span class="pre">*.scalar.dat</span></code> to look at the VMC energy and
variance for each optimization step.</p>
</div>
<div class="section" id="adaptive-organizer">
<h3>Adaptive Organizer<a class="headerlink" href="#adaptive-organizer" title="Permalink to this headline">Â¶</a></h3>
<p>The default setting of the adaptive optimizer is to construct the linear
method Hamiltonian and overlap matrices explicitly and add different
shifts to the Hamiltonian matrix as âstabilizers.â The generalized
eigenvalue problem is solved for each shift to obtain updates to the
wavefunction parameters. Then a correlated sampling is performed for
each shiftâs updated wavefunction and the initial trial wavefunction
using the middle shiftâs updated wavefunction as the guiding function.
The cost function for these wavefunctions is compared, and the update
corresponding to the best cost function is selected. In the next
iteration, the median magnitude of the stabilizers is set to the
magnitude that generated the best update in the current iteration, thus
adapting the magnitude of the stabilizers automatically.</p>
<p>When the trial wavefunction contains more than 10,000 parameters,
constructing and storing the linear method matrices could become a
memory bottleneck. To avoid explicit construction of these matrices, the
adaptive optimizer implements the block linear method (BLM) approach.
<span class="bibtex" id="id1">[Zhao:2017:blocked_lm]</span> The BLM tries to find an
approximate solution <span class="math notranslate nohighlight">\(\vec{c}_{opt}\)</span> to the standard LM
generalized eigenvalue problem by dividing the variable space into a
number of blocks and making intelligent estimates for which directions
within those blocks will be most important for constructing
<span class="math notranslate nohighlight">\(\vec{c}_{opt}\)</span>, which is then obtained by solving a smaller, more
memory-efficient eigenproblem in the basis of these supposedly important
block-wise directions.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="hamiltonianobservable.html" class="btn btn-neutral float-left" title="Hamiltonian and Observables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, QMCPACK Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
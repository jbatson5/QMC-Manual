

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Analyzing QMCPACK data &mdash; QMCPACK Manual 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Periodic LCAO for Solids" href="LCAO.html" />
    <link rel="prev" title="Output Overview" href="output_overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> QMCPACK Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features of QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Obtaining, installing, and validating QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units used in QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_overview.html">Input file overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulationcell.html">Specifying the system to be simulated</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_wavefunction.html">Trial wavefunction specificaion</a></li>
<li class="toctree-l1"><a class="reference internal" href="hamiltonianobservable.html">Hamiltonian and Observables</a></li>
<li class="toctree-l1"><a class="reference internal" href="methods.html">Quantum Monte Carlo Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_overview.html">Output Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Analyzing QMCPACK data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-the-qmca-tool-to-obtain-total-energies-and-related-quantities">Using the qmca tool to obtain total energies and related quantities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-a-statistically-correct-mean-and-error-bar">Obtaining a statistically correct mean and error bar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#judging-wavefunction-optimization">Judging wavefunction optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#judging-diffusion-monte-carlo-runs">Judging diffusion Monte Carlo runs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-other-quantities">Obtaining other quantities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#processing-multiple-files">Processing multiple files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#twist-averaging">Twist averaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-output-units">Setting output units</a></li>
<li class="toctree-l3"><a class="reference internal" href="#speeding-up-trace-plotting">Speeding up trace plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#short-usage-examples">Short usage examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#production-quality-checklist">Production quality checklist</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-qmc-fit-tool-for-statistical-time-step-extrapolation-and-curve-fitting">Using the qmc-fit tool for statistical time step extrapolation and curve fitting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-jackknife-statistical-technique">The jackknife statistical technique</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performing-time-step-extrapolation">Performing time step extrapolation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-qdens-tool-to-obtain-electron-densities">Using the qdens tool to obtain electron densities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usage-examples">Usage examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-produced">Files produced</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LCAO.html">Periodic LCAO for Solids</a></li>
<li class="toctree-l1"><a class="reference internal" href="sCI.html">Selected Configuration Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="afqmc.html">Auxiliary-Field Quantum Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_qmc_statistics.html">Lab 1: MC Statistical Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_qmc_basics.html">Lab 2: QMC Basics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QMCPACK Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Analyzing QMCPACK data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/analyzing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="analyzing-qmcpack-data">
<span id="analyzing"></span><h1>Analyzing QMCPACK data<a class="headerlink" href="#analyzing-qmcpack-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="using-the-qmca-tool-to-obtain-total-energies-and-related-quantities">
<span id="qmca"></span><h2>Using the qmca tool to obtain total energies and related quantities<a class="headerlink" href="#using-the-qmca-tool-to-obtain-total-energies-and-related-quantities" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">qmca</span></code> tool is the primary means of analyzing scalar-valued data
generated by QMCPACK. Output files that contain scalar-valued data are
<code class="docutils literal notranslate"><span class="pre">*.scalar.dat</span></code> and <code class="docutils literal notranslate"><span class="pre">*.dmc.dat</span></code> (see <a class="reference internal" href="output_overview.html#output-overview"><span class="std std-ref">Output Overview</span></a> for a detailed description of these files).
Quantities that are available for analysis in <code class="docutils literal notranslate"><span class="pre">*.scalar.dat</span></code> files
include the local energy and its variance, kinetic energy, potential
energy and its components, acceptance ratio, and the average CPU time
spent per block, among others. The <code class="docutils literal notranslate"><span class="pre">*.dmc.dat</span></code> files provide
information regarding the DMC walker population in addition to the local
energy.</p>
<p>Basic capabilities of <code class="docutils literal notranslate"><span class="pre">qmca</span></code> include calculating mean values and
associated error bars, processing multiple files at once in batched
fashion, performing twist averaging, plotting mean values by series, and
plotting traces (per block or step) of the underlying data. These
capabilities are explained with accompanying examples in the following
subsections.</p>
<p>To use <code class="docutils literal notranslate"><span class="pre">qmca</span></code>, installations of Python and NumPy must be present on
the local machine. For graphical plotting, the matplotlib module must
also be available.</p>
<p>An overview of all supported input flags to <code class="docutils literal notranslate"><span class="pre">qmca</span></code> can be obtained by
typing <code class="docutils literal notranslate"><span class="pre">qmca</span></code> at the command line with no other inputs (also try
<code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-x</span></code> for a short list of examples):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;qmca
  no files provided, please see help info below

  Usage: qmca [options] [file(s)]

  Options:
    --version             show program&#39;s version number and exit
    -v, --verbose         Print detailed information (default=False).
    -q QUANTITIES, --quantities=QUANTITIES
                          Quantity or list of quantities to analyze.  See names
                          and abbreviations below (default=all).
    -u UNITS, --units=UNITS
                          Desired energy units.  Can be Ha (Hartree), Ry
                          (Rydberg), eV (electron volts), kJ_mol (k.
                          joule/mole), K (Kelvin), J (Joules) (default=Ha).
    -e EQUILIBRATION, --equilibration=EQUILIBRATION
                          Equilibration length in blocks (default=auto).
    -a, --average         Average over files in each series (default=False).
    -w WEIGHTS, --weights=WEIGHTS
                          List of weights for averaging (default=None).
    -b, --reblock         (pending) Use reblocking to calculate statistics
                          (default=False).
    -p, --plot            Plot quantities vs. series (default=False).
    -t, --trace           Plot a trace of quantities (default=False).
    -h, --histogram       (pending) Plot a histogram of quantities
                          (default=False).
    -o, --overlay         Overlay plots (default=False).
    --legend=LEGEND       Placement of legend.  None for no legend, outside for
                          outside legend (default=upper right).
    --noautocorr          Do not calculate autocorrelation. Warning: error bars
                          are no longer valid! (default=False).
    --noac                Alias for --noautocorr (default=False).
    --sac                 Show autocorrelation of sample data (default=False).
    --sv                  Show variance of sample data (default=False).
    -i, --image           (pending) Save image files (default=False).
    -r, --report          (pending) Write a report (default=False).
    -s, --show_options    Print user provided options (default=False).
    -x, --examples        Print examples and exit (default=False).
    --help                Print help information and exit (default=False).
    -d DESIRED_ERROR, --desired_error=DESIRED_ERROR
                          Show number of samples needed for desired error bar
                          (default=none).
    -n PARTICLE_NUMBER, --enlarge_system=PARTICLE_NUMBER
                          Show number of samples needed to maintain error bar on
                          larger system: desired particle number first, current
                          particle number second (default=none)
</pre></div>
</div>
<div class="section" id="obtaining-a-statistically-correct-mean-and-error-bar">
<span id="qmca-mean-error"></span><h3>Obtaining a statistically correct mean and error bar<a class="headerlink" href="#obtaining-a-statistically-correct-mean-and-error-bar" title="Permalink to this headline">¶</a></h3>
<p>A rough guess at the mean and error bar of the local energy can be
obtained in the following way with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">45.876150</span> <span class="o">+/-</span> <span class="mf">0.017688</span>
</pre></div>
</div>
<p>In this case the VMC energy of an 8-atom cell of diamond is estimated to
be <span class="math notranslate nohighlight">\(-45.876(2)\)</span> Hartrees (Ha). This rough guess should not be used
for production-level or publication-quality estimates.</p>
<p>To obtain production-level results, the underlying data should first be
inspected visually to ensure that all data included in the averaging can
be attributed to a distribution sharing the same mean. The first steps
of essentially any MC calculation (the “equilibration phase”) do not
belong to the equilibrium distribution and should be excluded from
estimates of the mean and its error bar.</p>
<p>We can plot a data trace (<code class="docutils literal notranslate"><span class="pre">-t</span></code>) of the local energy in the
following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">0</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">0</span></code> part indicates that we do not want any data
to be initially excluded from the calculation of averages.  The resulting
plot is shown in <a class="reference internal" href="#fig4"><span class="std std-numref">Fig. 4</span></a>.  The unphysical
equilibration period is visible on the left side of the plot.</p>
<div class="figure align-center" id="id1">
<span id="fig4"></span><a class="reference internal image-reference" href="_images/qmca_mean_error_trace.png"><img alt="_images/qmca_mean_error_trace.png" src="_images/qmca_mean_error_trace.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Trace of the VMC local energy for an 8-atom cell of diamond generated
with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>. The x-axis (“samples”) refers to the VMC block index in
this case.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Most of the data fluctuates around a well-defined mean (consistent
variations around a flat line).  This property is important to verify
by plotting the trace for each QMC run.</p>
<p>If we exclude none of the equilibration data points, we get an
erroneous estimate of <span class="math notranslate nohighlight">\(-45.870(2)\)</span> Ha for the local energy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">0</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">45.870071</span> <span class="o">+/-</span> <span class="mf">0.018072</span>
</pre></div>
</div>
<p>The equilibration period is typically estimated by eye, though a few conservative values should be checked to ensure that the mean remains
unaffected.  In this dataset, the equilibration appears to have been
reached after 100 or so samples.  After excluding the first 100
VMC blocks from the analysis we get</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">100</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">45.877363</span> <span class="o">+/-</span> <span class="mf">0.017432</span>
</pre></div>
</div>
<p>This estimate (<span class="math notranslate nohighlight">\(-45.877(2)\)</span> Ha) differs significantly from the
<span class="math notranslate nohighlight">\(-45.870(2)\)</span> Ha figure obtained from the full set of data, but it
agrees with the rough estimate of <span class="math notranslate nohighlight">\(-45.876(2)\)</span> Ha obtained with
the abbreviated command (<code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-q</span> <span class="pre">e</span> <span class="pre">qmc.s000.scalar.dat</span></code>). This is
because <code class="docutils literal notranslate"><span class="pre">qmca</span></code> makes a heuristic guess at the equilibration period and
got it reasonably correct in this case. In many cases, the heuristic
guess fails and should not be relied on for quality results.</p>
<p>We have so far obtained a statistically correct mean. To obtain a
statistically correct error bar, it is best to include <span class="math notranslate nohighlight">\(\sim\)</span>100
or more statistically independent samples. An estimate of the number of
independent samples can be obtained by considering the autocorrelation
time, which is essentially a measure of the number of samples that must
be traversed before an uncorrelated/independent sample is reached. We
can get an estimate of the autocorrelation time in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">100</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span> <span class="o">--</span><span class="n">sac</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">45.877363</span> <span class="o">+/-</span> <span class="mf">0.017432</span>    <span class="mf">4.8</span>
</pre></div>
</div>
<p>The flag <code class="docutils literal notranslate"><span class="pre">–sac</span></code> stands for (s)how (a)uto(c)orrelation. In this case,
the autocorrelation estimate is <span class="math notranslate nohighlight">\(4.8\approx 5\)</span> samples. Since the
total run contained 800 samples and we have excluded 100 of them, we can
estimate the number of independent samples as <span class="math notranslate nohighlight">\((800-100)/5=140\)</span>.
In this case, the error bar is expected to be estimated reasonably well.</p>
<div class="figure align-center" id="id2">
<span id="fig5"></span><a class="reference internal image-reference" href="_images/qmca_judge_opt.png"><img alt="_images/qmca_judge_opt.png" src="_images/qmca_judge_opt.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Trace of the local energy during one- and two-body Jastrow optimizations
for an 8-atom cell of diamond generated with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>. Data for each
optimization cycle (QMCPACK series) is separated by a vertical black
line.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>Keep in mind that the error bar represents the expected range of the
mean with a certainty of only <span class="math notranslate nohighlight">\(\sim 70\%\)</span>; i.e., it is a one sigma
error bar. The actual mean value will lie outside the range indicated by
the error bar in 1 out of every 3 runs, and in a set of 20 runs 1 value
can be expected to deviate from its estimate by twice the error bar.</p>
</div>
<div class="section" id="judging-wavefunction-optimization">
<h3>Judging wavefunction optimization<a class="headerlink" href="#judging-wavefunction-optimization" title="Permalink to this headline">¶</a></h3>
<p>Wavefunction optimization is a highly nonlinear and sometimes
sensitive process.  As such, there is a risk that systematic
errors encountered at this stage of the QMC process can be propagated
into subsequent (expensive) DMC runs unless they are guarded against
with vigilance.</p>
<p>In this section we again consider an 8-atom cell of diamond but now in
the context of Jastrow optimization (one- and two-body terms). In
optimization runs it is often preferable to use a large number of
<code class="docutils literal notranslate"><span class="pre">warmupsteps</span></code> (<span class="math notranslate nohighlight">\(\sim 100\)</span>) so that equilibration bias does not
propagate into the optimization process. We can check that the added
warm-up has had its intended effect by again checking the local energy
trace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>The resulting plot can be found in <a class="reference internal" href="#fig5"><span class="std std-numref">Fig. 5</span></a>. In
this case sufficient <code class="docutils literal notranslate"><span class="pre">warmupsteps</span></code> were used to exit the equilibration
period before samples were collected and we can proceed without using
the <code class="docutils literal notranslate"><span class="pre">-e</span></code> option with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.</p>
<p>After inspecting the trace, we should inspect the text output from
<code class="docutils literal notranslate"><span class="pre">qmca</span></code>, now including the total energy and its variance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="n">opt</span><span class="o">*</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
                            <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">0</span>  <span class="o">-</span><span class="mf">44.823616</span> <span class="o">+/-</span> <span class="mf">0.007430</span>   <span class="mf">7.054219</span> <span class="o">+/-</span> <span class="mf">0.041998</span>   <span class="mf">0.1574</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">1</span>  <span class="o">-</span><span class="mf">45.877643</span> <span class="o">+/-</span> <span class="mf">0.003329</span>   <span class="mf">1.095362</span> <span class="o">+/-</span> <span class="mf">0.041154</span>   <span class="mf">0.0239</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">45.883191</span> <span class="o">+/-</span> <span class="mf">0.004149</span>   <span class="mf">1.077942</span> <span class="o">+/-</span> <span class="mf">0.021555</span>   <span class="mf">0.0235</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">3</span>  <span class="o">-</span><span class="mf">45.877524</span> <span class="o">+/-</span> <span class="mf">0.003094</span>   <span class="mf">1.074047</span> <span class="o">+/-</span> <span class="mf">0.010491</span>   <span class="mf">0.0234</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">4</span>  <span class="o">-</span><span class="mf">45.886062</span> <span class="o">+/-</span> <span class="mf">0.003750</span>   <span class="mf">1.061707</span> <span class="o">+/-</span> <span class="mf">0.014459</span>   <span class="mf">0.0231</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">5</span>  <span class="o">-</span><span class="mf">45.877668</span> <span class="o">+/-</span> <span class="mf">0.003475</span>   <span class="mf">1.091585</span> <span class="o">+/-</span> <span class="mf">0.021637</span>   <span class="mf">0.0238</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">6</span>  <span class="o">-</span><span class="mf">45.877109</span> <span class="o">+/-</span> <span class="mf">0.003586</span>   <span class="mf">1.069205</span> <span class="o">+/-</span> <span class="mf">0.009387</span>   <span class="mf">0.0233</span>
<span class="n">opt</span>  <span class="n">series</span> <span class="mi">7</span>  <span class="o">-</span><span class="mf">45.882563</span> <span class="o">+/-</span> <span class="mf">0.004324</span>   <span class="mf">1.058771</span> <span class="o">+/-</span> <span class="mf">0.008651</span>   <span class="mf">0.0231</span>
</pre></div>
</div>
<p>The flags <code class="docutils literal notranslate"><span class="pre">-q</span> <span class="pre">ev</span></code> requested the energy (<code class="docutils literal notranslate"><span class="pre">e</span></code>) and the variance
(<code class="docutils literal notranslate"><span class="pre">v</span></code>). For this combination of quantities, a third column (<code class="docutils literal notranslate"><span class="pre">ratio</span></code>)
is printed containing the ratio of the variance and the absolute value
of the local energy. The variance/energy ratio is an intensive quantity
and is useful to inspect regardless of the system under study.
Successful optimization of molecules and solids of any size generally
result in comparable values for the variance/energy ratio.</p>
<p>The first line of the output (<code class="docutils literal notranslate"><span class="pre">series</span> <span class="pre">0</span></code>) corresponds to the local
energy and variance of the system without a Jastrow factor (all Jastrow
coefficients were initialized to zero in this case), reflecting the
quality of the orbitals alone. For pseudopotential systems, a
variance/energy ratio <span class="math notranslate nohighlight">\(&gt;0.20\)</span> Ha generally indicates there is a
problem with the input orbitals that needs to be resolved before
performing wavefunction optimization.</p>
<p>The subsequent lines correspond to energies and variances of
intermediate parameterizations of the trial wavefunction during the
optimization process. The output line containing <code class="docutils literal notranslate"><span class="pre">opt</span> <span class="pre">series</span> <span class="pre">1</span></code>, for
example, corresponds to the trial wavefunction parameterized during the
<code class="docutils literal notranslate"><span class="pre">series</span> <span class="pre">0</span></code> step (the parameters of this wavefunction would be found in
an output file matching <code class="docutils literal notranslate"><span class="pre">*s000*opt.xml</span></code>). The first thing to check
about the resulting optimization is again the variance/energy ratio. For
pseudopotential systems, a variance/energy ratio <span class="math notranslate nohighlight">\(&lt;0.03\)</span> Ha is
consistent with a trial wavefunction of production quality, and values
of <span class="math notranslate nohighlight">\(0.01\)</span> Ha are rarely obtainable for standard Slater-Jastrow
wavefunctions. By this metric, all parameterizations obtained for
optimizations performed in series 0-6 are of comparable quality (note
that the quality of the wavefunction obtained during optimization series
7 is effectively unknown).</p>
<p>A good way to further discriminate among the parameterizations is to
plot the energy and variance as a function of series with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="n">opt</span><span class="o">*</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-p</span></code> option results in plots of means plus error bars
vs. series for all requested quantities.
The resulting plots for the local energy and variance are shown
in <a class="reference internal" href="#fig6"><span class="std std-numref">Fig. 6</span></a>.  In this case, the resulting energies
and variances are statistically indistinguishable for all optimization
cycles.</p>
<p>A good way to choose the optimal wavefunction for use in DMC is to
select the one with the lowest statistically significant energy within
the set of optimized wavefunctions with reasonable variance (e.g., among
those with a variance/energy ratio <span class="math notranslate nohighlight">\(&lt;0.03\)</span> Ha). For
pseudopotential calculations, minimizing according to the total energy
is recommended to reduce locality errors in DMC.</p>
<a class="reference internal image-reference" href="_images/qmca_opt_energy.png"><img alt="_images/qmca_opt_energy.png" class="align-center" src="_images/qmca_opt_energy.png" style="width: 400px;" /></a>
<div class="figure align-center" id="id3">
<span id="fig6"></span><a class="reference internal image-reference" href="_images/qmca_opt_variance.png"><img alt="_images/qmca_opt_variance.png" src="_images/qmca_opt_variance.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">Energy and variance vs. optimization series for an 8-atom cell of
diamond as plotted by <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="judging-diffusion-monte-carlo-runs">
<span id="qmca-judge-dmc"></span><h3>Judging diffusion Monte Carlo runs<a class="headerlink" href="#judging-diffusion-monte-carlo-runs" title="Permalink to this headline">¶</a></h3>
<p>Judging the quality of the DMC projection process requires more
care than is needed in VMC. To reduce bias, a small
time step is required in the approximate projector but this also
leads to slow equilibration and long autocorrelation times.
Systematic errors in the projection process can also arise from
statistical fluctuations due to pseudopotentials or from trial
wavefunctions with larger-than-necessary variance.</p>
<p>To illustrate the problems that can arise with respect to slow
equilibration and long autocorrelation times, we consider the 8-atom
diamond system with VMC (<span class="math notranslate nohighlight">\(200\)</span> blocks of <span class="math notranslate nohighlight">\(160\)</span> steps)
followed by DMC (<span class="math notranslate nohighlight">\(400\)</span> blocks of <span class="math notranslate nohighlight">\(5\)</span> steps) with a small
time step (<span class="math notranslate nohighlight">\(0.002\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>). A good first step in
assessing the quality of any DMC run is to plot the trace of the local
energy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">0</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<div class="figure align-center" id="id4">
<span id="fig7"></span><a class="reference internal image-reference" href="_images/qmca_short_dmc.png"><img alt="_images/qmca_short_dmc.png" src="_images/qmca_short_dmc.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">Trace of the local energy for VMC followed by DMC with a small time step
(<span class="math notranslate nohighlight">\(0.002\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>) for an 8-atom cell of diamond
generated with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The resulting trace plot is shown in <a class="reference internal" href="#fig7"><span class="std std-numref">Fig. 7</span></a>. As
always, the DMC local energy decreases exponentially away from the VMC
value, but in this case it takes a long time to do so. At least half of
the DMC run is inefficiently consumed by equilibration. If we are not
careful to inspect and remove the transient, the estimated DMC energy
will be strongly biased by the transient as shown by the horizontal red
line (estimated mean) in the figure. The autocorrelation time is also
large (<span class="math notranslate nohighlight">\(\sim 12\)</span> blocks):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">200</span> <span class="o">--</span><span class="n">sac</span> <span class="o">*</span><span class="n">s001</span><span class="o">.</span><span class="n">scalar</span><span class="o">*</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">1</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">46.045720</span> <span class="o">+/-</span> <span class="mf">0.004813</span>   <span class="mf">11.6</span>
</pre></div>
</div>
<p>Of the included 200 blocks, fewer than 20 contribute to the estimated error
bar, indicating that we cannot trust the reported error bar.
This can also be demonstrated directly from the data.  If we halve the number
of included samples to 100, we expect from Gaussian statistics
that the error bar will grow by a factor of <span class="math notranslate nohighlight">\(\sqrt{2}\)</span>, but instead we
get</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">300</span> <span class="o">*</span><span class="n">s001</span><span class="o">.</span><span class="n">scalar</span><span class="o">*</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">1</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">46.048537</span> <span class="o">+/-</span> <span class="mf">0.009280</span>
</pre></div>
</div>
<p>which erroneously shows an estimated increase in the error bar by a
factor of about 2. Overall, this run is simply too short to gain
meaningful information.</p>
<p>Consider the case in which we are interested in the cohesive energy of
diamond, and, after having performed a time step study of the cohesive
energy, we have found that the energy difference between bulk diamond
and atomic carbon converges to our required accuracy with a larger time
step of <span class="math notranslate nohighlight">\(0.01\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>. In a production setting, a small
cell could be used to determine the appropriate time step, while a
larger cell would subsequently be used to obtain a converged cohesive
energy, though for purposes of demonstration we still proceed here with
the 8-atom cell. The new time step of <span class="math notranslate nohighlight">\(0.01\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>
will result in a shorter autocorrelation time than the smaller time step
used previously, but we would like to shorten the equilibration time
further still. This can be achieved by using a larger time step (say
<span class="math notranslate nohighlight">\(0.02\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>) in a short intermediate DMC run used to
walk down the transient. The rapidly achieved equilibrium with the
<span class="math notranslate nohighlight">\(0.02\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span> time step projector will be much nearer
to the <span class="math notranslate nohighlight">\(0.01\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span> time step we seek than the
original VMC equilibrium, so we can expect a shortened secondary
equilibration time in the production <span class="math notranslate nohighlight">\(0.01\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span> time
step run. Note that this procedure is fully general, even if having to
deal with an even shorter time step (e.g., <span class="math notranslate nohighlight">\(0.002\)</span>
Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>) for a particular problem.</p>
<p>We now rerun the previous example but with an intermediate DMC
calculation using <span class="math notranslate nohighlight">\(40\)</span> blocks of <span class="math notranslate nohighlight">\(5\)</span> steps with a time step
of <span class="math notranslate nohighlight">\(0.02\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>, followed by a production DMC
calculation using <span class="math notranslate nohighlight">\(400\)</span> blocks of <span class="math notranslate nohighlight">\(10\)</span> steps with a time
step of <span class="math notranslate nohighlight">\(0.01\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>. We again plot the local energy
trace using <code class="docutils literal notranslate"><span class="pre">qmca</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">0</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>with the result shown in <a class="reference internal" href="#fig8"><span class="std std-numref">Fig. 8</span></a>.
The projection transient has been effectively contained in the
short DMC run with a larger time step.  As expected, the
production run contains only a short equilibration period.
Removing the first 20 blocks as a precaution, we obtain an estimate
of the total energy in VMC and DMC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="o">--</span><span class="n">sac</span> <span class="n">qmc</span><span class="o">.*.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
                            <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>  <span class="o">-</span><span class="mf">45.881042</span> <span class="o">+/-</span> <span class="mf">0.001283</span>    <span class="mf">1.0</span>   <span class="mf">1.076726</span> <span class="o">+/-</span> <span class="mf">0.007013</span>    <span class="mf">1.0</span>   <span class="mf">0.0235</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">1</span>  <span class="o">-</span><span class="mf">46.040814</span> <span class="o">+/-</span> <span class="mf">0.005046</span>    <span class="mf">3.9</span>   <span class="mf">1.011303</span> <span class="o">+/-</span> <span class="mf">0.016807</span>    <span class="mf">1.1</span>   <span class="mf">0.0220</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.032960</span> <span class="o">+/-</span> <span class="mf">0.002077</span>    <span class="mf">5.2</span>   <span class="mf">1.014940</span> <span class="o">+/-</span> <span class="mf">0.002547</span>    <span class="mf">1.0</span>   <span class="mf">0.0220</span>
</pre></div>
</div>
<div class="figure align-center" id="id5">
<span id="fig8"></span><a class="reference internal image-reference" href="_images/qmca_accel_dmc.png"><img alt="_images/qmca_accel_dmc.png" src="_images/qmca_accel_dmc.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">Trace of the local energy for VMC followed by a short intermediate DMC
with a large time step (<span class="math notranslate nohighlight">\(0.02\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>) and finally a
production DMC run with a time step of <span class="math notranslate nohighlight">\(0.01\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>.
Calculations were performed in an 8-atom cell of diamond.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>Notice that the variance/energy ratio in DMC (<span class="math notranslate nohighlight">\(0.220\)</span> Ha) is
similar to but slightly smaller than that obtained with VMC
(<span class="math notranslate nohighlight">\(0.235\)</span> Ha). If the DMC variance/energy ratio is ever
significantly larger than with VMC, this is cause to be concerned about
the correctness of the DMC run. Also notice the estimated
autocorrelation time (<span class="math notranslate nohighlight">\(\sim 5\)</span> blocks). This leaves us with an
estimated <span class="math notranslate nohighlight">\(\sim 76\)</span> independent samples, though we should recall
that the autocorrelation time is also a statistical estimate that can be
improved with more data. We can gain a better estimate of the
autocorrelation time by using the <code class="docutils literal notranslate"><span class="pre">*.dmc.dat</span></code> files, which contain
output data resolved per step rather than per block (there are
<span class="math notranslate nohighlight">\(10\times\)</span> more steps than blocks in this example case):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">200</span> <span class="o">--</span><span class="n">sac</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">dmc</span><span class="o">.</span><span class="n">dat</span>
                            <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.032909</span> <span class="o">+/-</span> <span class="mf">0.002068</span>   <span class="mf">31.2</span>   <span class="mf">1.015781</span> <span class="o">+/-</span> <span class="mf">0.002536</span>    <span class="mf">1.4</span>   <span class="mf">0.0221</span>
</pre></div>
</div>
<p>This results in an estimated autocorrelation time of <span class="math notranslate nohighlight">\(\sim 31\)</span>
steps, or <span class="math notranslate nohighlight">\(\sim 3\)</span> blocks, indicating that we actually have
<span class="math notranslate nohighlight">\(\sim 122\)</span> independent samples, which should be sufficient to
obtain a trustworthy error bar. Our final DMC total energy is estimated
to be <span class="math notranslate nohighlight">\(-46.0329(2)\)</span> Ha.</p>
<p>Another simulation property that should be explicitly monitored
is the behavior of the DMC walker population.  Data regarding the
walker population is contained in the <code class="docutils literal notranslate"><span class="pre">*.dmc.dat</span></code> files.
In <a class="reference internal" href="#fig9"><span class="std std-numref">Fig. 9</span></a> we show the trace of the DMC
walker population for the current run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">nw</span> <span class="o">*</span><span class="n">dmc</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">1</span>  <span class="n">NumOfWalkers</span>          <span class="o">=</span>  <span class="mf">2056.905405</span> <span class="o">+/-</span> <span class="mf">8.775527</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="n">NumOfWalkers</span>          <span class="o">=</span>  <span class="mf">2050.164160</span> <span class="o">+/-</span> <span class="mf">4.954850</span>
</pre></div>
</div>
<p>Following a DMC run, the walker population should be checked for two
qualities: (1) that the population is sufficiently large (a number
<span class="math notranslate nohighlight">\(&gt;2,000\)</span> is generally sufficient to reduce population control
bias) and (2) that the population fluctuates benignly around its
intended target value. In this case the target walker count (provided in
the input file) was <span class="math notranslate nohighlight">\(2,048\)</span> and we can confirm from the plot that
the population is simply fluctuating around this value. Also, from the
text output we have a dynamic population estimate of 2,050(5) walkers.
Rapid population reductions or increases—population explosions—are
indicative of problems with a run. These issues sometimes result from
using a considerably poor wavefunction (see comments regarding
variance/energy ratio in the preceding subsections). QMCPACK has
internal guards in place that prevent the population from exceeding
certain maximum and minimum bounds, so in particularly faulty runs one
might see the population “stabilize” to a constant value much larger or
smaller than the target. In such cases the cause(s) for the divergent
population behavior needs to be investigated and resolved before
proceeding further.</p>
<div class="figure align-center" id="id6">
<span id="fig9"></span><a class="reference internal image-reference" href="_images/qmca_pop_trace.png"><img alt="_images/qmca_pop_trace.png" src="_images/qmca_pop_trace.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Trace of the DMC walker population for an 8-atom cell of diamond
obtained with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="obtaining-other-quantities">
<span id="qmca-other-quantities"></span><h3>Obtaining other quantities<a class="headerlink" href="#obtaining-other-quantities" title="Permalink to this headline">¶</a></h3>
<p>A number of other scalar-valued quantities are available with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.
To obtain text output for all quantities available, simply exclude the
<code class="docutils literal notranslate"><span class="pre">-q</span></code> option used in previous examples. The following example shows
output for a DMC calculation of the 8-atom diamond system from the
<code class="docutils literal notranslate"><span class="pre">scalar.dat</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">46.0330</span> <span class="o">+/-</span>           <span class="mf">0.0021</span>
  <span class="n">Variance</span>              <span class="o">=</span>            <span class="mf">1.0149</span> <span class="o">+/-</span>           <span class="mf">0.0025</span>
  <span class="n">Kinetic</span>               <span class="o">=</span>            <span class="mf">33.851</span> <span class="o">+/-</span>            <span class="mf">0.019</span>
  <span class="n">LocalPotential</span>        <span class="o">=</span>           <span class="o">-</span><span class="mf">79.884</span> <span class="o">+/-</span>            <span class="mf">0.020</span>
  <span class="n">ElecElec</span>              <span class="o">=</span>          <span class="o">-</span><span class="mf">11.4483</span> <span class="o">+/-</span>           <span class="mf">0.0083</span>
  <span class="n">LocalECP</span>              <span class="o">=</span>           <span class="o">-</span><span class="mf">22.615</span> <span class="o">+/-</span>            <span class="mf">0.029</span>
  <span class="n">NonLocalECP</span>           <span class="o">=</span>            <span class="mf">5.2815</span> <span class="o">+/-</span>           <span class="mf">0.0079</span>
  <span class="n">IonIon</span>                <span class="o">=</span>            <span class="o">-</span><span class="mf">51.10</span> <span class="o">+/-</span>             <span class="mf">0.00</span>
  <span class="n">LocalEnergy_sq</span>        <span class="o">=</span>           <span class="mf">2120.05</span> <span class="o">+/-</span>             <span class="mf">0.19</span>
  <span class="n">BlockWeight</span>           <span class="o">=</span>          <span class="mf">20514.27</span> <span class="o">+/-</span>            <span class="mf">48.38</span>
  <span class="n">BlockCPU</span>              <span class="o">=</span>            <span class="mf">1.4890</span> <span class="o">+/-</span>           <span class="mf">0.0038</span>
  <span class="n">AcceptRatio</span>           <span class="o">=</span>         <span class="mf">0.9963954</span> <span class="o">+/-</span>        <span class="mf">0.0000055</span>
  <span class="n">Efficiency</span>            <span class="o">=</span>             <span class="mf">71.88</span> <span class="o">+/-</span>             <span class="mf">0.00</span>
  <span class="n">TotalTime</span>             <span class="o">=</span>            <span class="mf">565.80</span> <span class="o">+/-</span>             <span class="mf">0.00</span>
  <span class="n">TotalSamples</span>          <span class="o">=</span>           <span class="mi">7795421</span> <span class="o">+/-</span>                <span class="mi">0</span>
</pre></div>
</div>
<p>Similarly, for the <code class="docutils literal notranslate"><span class="pre">dmc.dat</span></code> file we get</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">dmc</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">46.0329</span> <span class="o">+/-</span>           <span class="mf">0.0020</span>
  <span class="n">Variance</span>              <span class="o">=</span>            <span class="mf">1.0162</span> <span class="o">+/-</span>           <span class="mf">0.0025</span>
  <span class="n">TotalSamples</span>          <span class="o">=</span>           <span class="mi">8201275</span> <span class="o">+/-</span>                <span class="mi">0</span>
  <span class="n">TrialEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">46.0343</span> <span class="o">+/-</span>           <span class="mf">0.0023</span>
  <span class="n">DiffEff</span>               <span class="o">=</span>         <span class="mf">0.9939150</span> <span class="o">+/-</span>        <span class="mf">0.0000088</span>
  <span class="n">Weight</span>                <span class="o">=</span>           <span class="mf">2050.23</span> <span class="o">+/-</span>             <span class="mf">4.82</span>
  <span class="n">NumOfWalkers</span>          <span class="o">=</span>              <span class="mi">2050</span> <span class="o">+/-</span>                <span class="mi">5</span>
  <span class="n">LivingFraction</span>        <span class="o">=</span>          <span class="mf">0.996427</span> <span class="o">+/-</span>         <span class="mf">0.000021</span>
  <span class="n">AvgSentWalkers</span>        <span class="o">=</span>            <span class="mf">0.2625</span> <span class="o">+/-</span>           <span class="mf">0.0011</span>
</pre></div>
</div>
<p>Any subset of desired quantities can be obtained by using the <code class="docutils literal notranslate"><span class="pre">-q</span></code>
option with either the full names of the quantities just listed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="s1">&#39;LocalEnergy Kinetic LocalPotential&#39;</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">46.0330</span> <span class="o">+/-</span>           <span class="mf">0.0021</span>
  <span class="n">Kinetic</span>               <span class="o">=</span>            <span class="mf">33.851</span> <span class="o">+/-</span>            <span class="mf">0.019</span>
  <span class="n">LocalPotential</span>        <span class="o">=</span>           <span class="o">-</span><span class="mf">79.884</span> <span class="o">+/-</span>            <span class="mf">0.020</span>
</pre></div>
</div>
<p>or with their corresponding abbreviations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ekp</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">46.0330</span> <span class="o">+/-</span>           <span class="mf">0.0021</span>
  <span class="n">Kinetic</span>               <span class="o">=</span>            <span class="mf">33.851</span> <span class="o">+/-</span>            <span class="mf">0.019</span>
  <span class="n">LocalPotential</span>        <span class="o">=</span>           <span class="o">-</span><span class="mf">79.884</span> <span class="o">+/-</span>            <span class="mf">0.020</span>
</pre></div>
</div>
<p>Abbreviations for each quantity can be found by typing <code class="docutils literal notranslate"><span class="pre">qmca</span></code> at the
command line with no other input. This following is a current list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Abbreviations</span> <span class="ow">and</span> <span class="n">full</span> <span class="n">names</span> <span class="k">for</span> <span class="n">quantities</span><span class="p">:</span>
    <span class="n">ar</span>              <span class="o">=</span> <span class="n">AcceptRatio</span>
    <span class="n">bc</span>              <span class="o">=</span> <span class="n">BlockCPU</span>
    <span class="n">bw</span>              <span class="o">=</span> <span class="n">BlockWeight</span>
    <span class="n">ce</span>              <span class="o">=</span> <span class="n">CorrectedEnergy</span>
    <span class="n">de</span>              <span class="o">=</span> <span class="n">DiffEff</span>
    <span class="n">e</span>               <span class="o">=</span> <span class="n">LocalEnergy</span>
    <span class="n">ee</span>              <span class="o">=</span> <span class="n">ElecElec</span>
    <span class="n">eff</span>             <span class="o">=</span> <span class="n">Efficiency</span>
    <span class="n">ii</span>              <span class="o">=</span> <span class="n">IonIon</span>
    <span class="n">k</span>               <span class="o">=</span> <span class="n">Kinetic</span>
    <span class="n">kc</span>              <span class="o">=</span> <span class="n">KEcorr</span>
    <span class="n">l</span>               <span class="o">=</span> <span class="n">LocalECP</span>
    <span class="n">le2</span>             <span class="o">=</span> <span class="n">LocalEnergy_sq</span>
    <span class="n">mpc</span>             <span class="o">=</span> <span class="n">MPC</span>
    <span class="n">n</span>               <span class="o">=</span> <span class="n">NonLocalECP</span>
    <span class="n">nw</span>              <span class="o">=</span> <span class="n">NumOfWalkers</span>
    <span class="n">p</span>               <span class="o">=</span> <span class="n">LocalPotential</span>
    <span class="n">sw</span>              <span class="o">=</span> <span class="n">AvgSentWalkers</span>
    <span class="n">te</span>              <span class="o">=</span> <span class="n">TrialEnergy</span>
    <span class="n">ts</span>              <span class="o">=</span> <span class="n">TotalSamples</span>
    <span class="n">tt</span>              <span class="o">=</span> <span class="n">TotalTime</span>
    <span class="n">v</span>               <span class="o">=</span> <span class="n">Variance</span>
    <span class="n">w</span>               <span class="o">=</span> <span class="n">Weight</span>
</pre></div>
</div>
<p>See the output overview for <code class="docutils literal notranslate"><span class="pre">scalar.dat</span></code>
(<a class="reference internal" href="output_overview.html#scalardat-file"><span class="std std-ref">The .scalar.dat file</span></a>) and <code class="docutils literal notranslate"><span class="pre">dmc.dat</span></code>
(<a class="reference internal" href="output_overview.html#dmc-file"><span class="std std-ref">The .dmc.dat file</span></a>) for more information about
these quantities.  The data analysis aspects for these
quantities are essentially the same as for the local
energy as covered in the preceding subsections.
Quantities that do not belong to an equilibrium distribution
(e.g., <code class="docutils literal notranslate"><span class="pre">BlockCPU</span></code>) are somewhat different, though they
still exhibit statistical fluctuations.</p>
</div>
<div class="section" id="processing-multiple-files">
<span id="qmca-multiple-files"></span><h3>Processing multiple files<a class="headerlink" href="#processing-multiple-files" title="Permalink to this headline">¶</a></h3>
<p>Batch file processing is a common use case for <code class="docutils literal notranslate"><span class="pre">qmca</span></code>. If we consider
an “equation-of-state” calculation involving the 8-atom diamond cell we
have used so far, we might be interested in the total energy for the
various supercell volumes along the trajectory from compression to
expansion. After checking the traces
(<code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-t</span> <span class="pre">-q</span> <span class="pre">e</span> <span class="pre">scale_*/vmc/*scalar*</span></code>) to settle on a sensible
equilibration cutoff as discussed in the preceding subsections, we can
obtain the total energies all at once:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="n">scale_</span><span class="o">*/</span><span class="n">vmc</span><span class="o">/*</span><span class="n">scalar</span><span class="o">*</span>
                            <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">80</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">44.670984</span> <span class="o">+/-</span> <span class="mf">0.006051</span>  <span class="mf">2.542384</span> <span class="o">+/-</span> <span class="mf">0.019902</span>  <span class="mf">0.0569</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">82</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">44.982818</span> <span class="o">+/-</span> <span class="mf">0.005757</span>  <span class="mf">2.413011</span> <span class="o">+/-</span> <span class="mf">0.022626</span>  <span class="mf">0.0536</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">84</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.228257</span> <span class="o">+/-</span> <span class="mf">0.005374</span>  <span class="mf">2.258577</span> <span class="o">+/-</span> <span class="mf">0.019322</span>  <span class="mf">0.0499</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">86</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.415842</span> <span class="o">+/-</span> <span class="mf">0.005532</span>  <span class="mf">2.204980</span> <span class="o">+/-</span> <span class="mf">0.052978</span>  <span class="mf">0.0486</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">88</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.570215</span> <span class="o">+/-</span> <span class="mf">0.004651</span>  <span class="mf">2.061374</span> <span class="o">+/-</span> <span class="mf">0.014359</span>  <span class="mf">0.0452</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">90</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.683684</span> <span class="o">+/-</span> <span class="mf">0.005009</span>  <span class="mf">1.988539</span> <span class="o">+/-</span> <span class="mf">0.018267</span>  <span class="mf">0.0435</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">92</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.751359</span> <span class="o">+/-</span> <span class="mf">0.004928</span>  <span class="mf">1.913282</span> <span class="o">+/-</span> <span class="mf">0.013998</span>  <span class="mf">0.0418</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">94</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.791622</span> <span class="o">+/-</span> <span class="mf">0.005026</span>  <span class="mf">1.843704</span> <span class="o">+/-</span> <span class="mf">0.014460</span>  <span class="mf">0.0403</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">96</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.809256</span> <span class="o">+/-</span> <span class="mf">0.005053</span>  <span class="mf">1.829103</span> <span class="o">+/-</span> <span class="mf">0.014536</span>  <span class="mf">0.0399</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">98</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.806235</span> <span class="o">+/-</span> <span class="mf">0.004963</span>  <span class="mf">1.775391</span> <span class="o">+/-</span> <span class="mf">0.015199</span>  <span class="mf">0.0388</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">00</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.783481</span> <span class="o">+/-</span> <span class="mf">0.005293</span>  <span class="mf">1.726869</span> <span class="o">+/-</span> <span class="mf">0.012001</span>  <span class="mf">0.0377</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">02</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.741655</span> <span class="o">+/-</span> <span class="mf">0.005627</span>  <span class="mf">1.681776</span> <span class="o">+/-</span> <span class="mf">0.011496</span>  <span class="mf">0.0368</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">04</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.685101</span> <span class="o">+/-</span> <span class="mf">0.005353</span>  <span class="mf">1.682608</span> <span class="o">+/-</span> <span class="mf">0.015423</span>  <span class="mf">0.0368</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">06</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.615164</span> <span class="o">+/-</span> <span class="mf">0.005978</span>  <span class="mf">1.652155</span> <span class="o">+/-</span> <span class="mf">0.010945</span>  <span class="mf">0.0362</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">08</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.543037</span> <span class="o">+/-</span> <span class="mf">0.005191</span>  <span class="mf">1.646375</span> <span class="o">+/-</span> <span class="mf">0.013446</span>  <span class="mf">0.0361</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">10</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.450976</span> <span class="o">+/-</span> <span class="mf">0.004794</span>  <span class="mf">1.707649</span> <span class="o">+/-</span> <span class="mf">0.048186</span>  <span class="mf">0.0376</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">12</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.371851</span> <span class="o">+/-</span> <span class="mf">0.005103</span>  <span class="mf">1.686997</span> <span class="o">+/-</span> <span class="mf">0.035920</span>  <span class="mf">0.0372</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">14</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.265490</span> <span class="o">+/-</span> <span class="mf">0.005311</span>  <span class="mf">1.631614</span> <span class="o">+/-</span> <span class="mf">0.012381</span>  <span class="mf">0.0360</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">16</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.161961</span> <span class="o">+/-</span> <span class="mf">0.004868</span>  <span class="mf">1.656586</span> <span class="o">+/-</span> <span class="mf">0.014788</span>  <span class="mf">0.0367</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">18</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">45.062579</span> <span class="o">+/-</span> <span class="mf">0.005971</span>  <span class="mf">1.671998</span> <span class="o">+/-</span> <span class="mf">0.019942</span>  <span class="mf">0.0371</span>
<span class="n">scale_1</span><span class="o">.</span><span class="mi">20</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">44.960477</span> <span class="o">+/-</span> <span class="mf">0.004888</span>  <span class="mf">1.651864</span> <span class="o">+/-</span> <span class="mf">0.009756</span>  <span class="mf">0.0367</span>
</pre></div>
</div>
<p>In this case, we are using a Jastrow factor optimized only at the
equilibrium geometry (<code class="docutils literal notranslate"><span class="pre">scale_1.00</span></code>) but with radial cutoffs restricted
to the Wigner-Seitz radius of the most compressed supercell
(<code class="docutils literal notranslate"><span class="pre">scale_0.80</span></code>) to avoid introducing wavefunction cusps at the cell
boundary (had we tried, QMCPACK would have aborted with a warning in
this case). It is clear that this restricted Jastrow factor is not an
optimal choice because it yields variance/energy ratios between
<span class="math notranslate nohighlight">\(0.036\)</span> and <span class="math notranslate nohighlight">\(0.057\)</span> Ha. This issue is largely a result of
our undersized (8-atom) supercell; larger cells should always be used in
real production calculations.</p>
<p>Batch processing is also possible for multiple quantities.  If multiple
quantities are requested, an additional line is inserted to separate
results from different runs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="s1">&#39;e bc eff&#39;</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="n">scale_</span><span class="o">*/</span><span class="n">vmc</span><span class="o">/*</span><span class="n">scalar</span><span class="o">*</span>
<span class="n">scale_0</span><span class="o">.</span><span class="mi">80</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">44.6710</span> <span class="o">+/-</span>           <span class="mf">0.0061</span>
  <span class="n">BlockCPU</span>              <span class="o">=</span>           <span class="mf">0.02986</span> <span class="o">+/-</span>          <span class="mf">0.00038</span>
  <span class="n">Efficiency</span>            <span class="o">=</span>          <span class="mf">38104.00</span> <span class="o">+/-</span>             <span class="mf">0.00</span>

<span class="n">scale_0</span><span class="o">.</span><span class="mi">82</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">44.9828</span> <span class="o">+/-</span>           <span class="mf">0.0058</span>
  <span class="n">BlockCPU</span>              <span class="o">=</span>           <span class="mf">0.02826</span> <span class="o">+/-</span>          <span class="mf">0.00013</span>
  <span class="n">Efficiency</span>            <span class="o">=</span>          <span class="mf">44483.91</span> <span class="o">+/-</span>             <span class="mf">0.00</span>

<span class="n">scale_0</span><span class="o">.</span><span class="mi">84</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">45.2283</span> <span class="o">+/-</span>           <span class="mf">0.0054</span>
  <span class="n">BlockCPU</span>              <span class="o">=</span>           <span class="mf">0.02747</span> <span class="o">+/-</span>          <span class="mf">0.00030</span>
  <span class="n">Efficiency</span>            <span class="o">=</span>          <span class="mf">52525.12</span> <span class="o">+/-</span>             <span class="mf">0.00</span>

<span class="n">scale_0</span><span class="o">.</span><span class="mi">86</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">45.4158</span> <span class="o">+/-</span>           <span class="mf">0.0055</span>
  <span class="n">BlockCPU</span>              <span class="o">=</span>           <span class="mf">0.02679</span> <span class="o">+/-</span>          <span class="mf">0.00013</span>
  <span class="n">Efficiency</span>            <span class="o">=</span>          <span class="mf">50811.55</span> <span class="o">+/-</span>             <span class="mf">0.00</span>

<span class="n">scale_0</span><span class="o">.</span><span class="mi">88</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">45.5702</span> <span class="o">+/-</span>           <span class="mf">0.0047</span>
  <span class="n">BlockCPU</span>              <span class="o">=</span>           <span class="mf">0.02598</span> <span class="o">+/-</span>          <span class="mf">0.00015</span>
  <span class="n">Efficiency</span>            <span class="o">=</span>          <span class="mf">74148.79</span> <span class="o">+/-</span>             <span class="mf">0.00</span>

<span class="n">scale_0</span><span class="o">.</span><span class="mi">90</span><span class="o">/</span><span class="n">vmc</span><span class="o">/</span><span class="n">qmc</span>  <span class="n">series</span> <span class="mi">0</span>
  <span class="n">LocalEnergy</span>           <span class="o">=</span>          <span class="o">-</span><span class="mf">45.6837</span> <span class="o">+/-</span>           <span class="mf">0.0050</span>
  <span class="n">BlockCPU</span>              <span class="o">=</span>           <span class="mf">0.02527</span> <span class="o">+/-</span>          <span class="mf">0.00011</span>
  <span class="n">Efficiency</span>            <span class="o">=</span>          <span class="mf">65714.98</span> <span class="o">+/-</span>             <span class="mf">0.00</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="twist-averaging">
<span id="qmca-twist-average"></span><h3>Twist averaging<a class="headerlink" href="#twist-averaging" title="Permalink to this headline">¶</a></h3>
<p>Twist averaging can be performed straightforwardly for any output
quantity listed in <a class="reference internal" href="#qmca-other-quantities"><span class="std std-ref">Obtaining other quantities</span></a> with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.
We illustrate these capabilities by repeating the 8-atom diamond DMC
runs performed in Section <a class="reference internal" href="#qmca-judge-dmc"><span class="std std-ref">Judging diffusion Monte Carlo runs</span></a> at 8 real-valued
supercell twist angles (a <span class="math notranslate nohighlight">\(2\times 2\times 2\)</span> Monkhorst-Pack grid
centered at the <span class="math notranslate nohighlight">\(\Gamma\)</span>-point). Data traces for each twist can be
overlapped on the same plot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">to</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;30 20 30&#39;</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span> <span class="o">--</span><span class="n">legend</span> <span class="n">outside</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-o</span></code> option requests the plots to be overlapped; otherwise,
8 separate plots would be generated.  The
equilibration input <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">'30</span> <span class="pre">20</span> <span class="pre">30'</span></code> cuts out from
the analyzed data the first 30 blocks for series 0 (VMC),
20 blocks for series 1 (intermediate DMC), and 30 blocks for
series 2 (production DMC).  The resulting plot is shown in
<a class="reference internal" href="#fig10"><span class="std std-numref">Fig. 10</span></a>.</p>
<div class="figure align-center" id="id7">
<span id="fig10"></span><a class="reference internal image-reference" href="_images/qmca_twist_trace_overlap.png"><img alt="_images/qmca_twist_trace_overlap.png" src="_images/qmca_twist_trace_overlap.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">Overlapped energy traces from VMC to DMC for an 8-supercell diamond
obtained with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>. Data for each twist appears in a different
color.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>Twist averaging is performed by providing the <code class="docutils literal notranslate"><span class="pre">-a</span></code>
option.  If provided on its own, uniform weights are applied
to each twist angle.  To obtain a trace plot with twist averaging
enforced, use a command similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;30 20 30&#39;</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>The resulting plot is shown in <a class="reference internal" href="#fig11"><span class="std std-numref">Fig. 11</span></a>. As
can be seen from the trace plot, the chosen equilibration lengths are
appropriate, and we proceed to obtain the twist-averaged total energy
from the <code class="docutils literal notranslate"><span class="pre">scalar.dat</span></code> files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">--</span><span class="n">sac</span> <span class="o">*</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">*</span>
                            <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">avg</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">45.873369</span> <span class="o">+/-</span> <span class="mf">0.000753</span>    <span class="mf">5.3</span>   <span class="mf">1.028751</span> <span class="o">+/-</span> <span class="mf">0.001056</span>    <span class="mf">1.3</span>   <span class="mf">0.0224</span>
</pre></div>
</div>
<p>and also from the <code class="docutils literal notranslate"><span class="pre">dmc.dat</span></code> files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">300</span> <span class="o">--</span><span class="n">sac</span> <span class="o">*</span><span class="n">s002</span><span class="o">.</span><span class="n">dmc</span><span class="o">*</span>
                          <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">avg</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">45.873371</span> <span class="o">+/-</span> <span class="mf">0.000741</span>   <span class="mf">30.5</span>   <span class="mf">1.028843</span> <span class="o">+/-</span> <span class="mf">0.000972</span>    <span class="mf">1.6</span>   <span class="mf">0.0224</span>
</pre></div>
</div>
<p>yielding a twist-averaged total energy of <span class="math notranslate nohighlight">\(-45.8733(8)\)</span> Ha.</p>
<div class="figure align-center" id="id8">
<span id="fig11"></span><a class="reference internal image-reference" href="_images/qmca_twist_average_trace.png"><img alt="_images/qmca_twist_average_trace.png" src="_images/qmca_twist_average_trace.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">Twist-averaged energy trace from VMC to DMC for an 8-supercell diamond obtained with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>As can be seen from <a class="reference internal" href="#fig10"><span class="std std-numref">Fig. 10</span></a>, some of the twist
angles are degenerate. This is seen more clearly in the text output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">*</span>
                            <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g000</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">45.264510</span> <span class="o">+/-</span> <span class="mf">0.001942</span>   <span class="mf">1.057065</span> <span class="o">+/-</span> <span class="mf">0.002318</span>   <span class="mf">0.0234</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g001</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.035511</span> <span class="o">+/-</span> <span class="mf">0.001806</span>   <span class="mf">1.015992</span> <span class="o">+/-</span> <span class="mf">0.002836</span>   <span class="mf">0.0221</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g002</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.035410</span> <span class="o">+/-</span> <span class="mf">0.001538</span>   <span class="mf">1.015039</span> <span class="o">+/-</span> <span class="mf">0.002661</span>   <span class="mf">0.0220</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g003</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.047285</span> <span class="o">+/-</span> <span class="mf">0.001898</span>   <span class="mf">1.018219</span> <span class="o">+/-</span> <span class="mf">0.002588</span>   <span class="mf">0.0221</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g004</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.034225</span> <span class="o">+/-</span> <span class="mf">0.002539</span>   <span class="mf">1.013420</span> <span class="o">+/-</span> <span class="mf">0.002835</span>   <span class="mf">0.0220</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g005</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.046731</span> <span class="o">+/-</span> <span class="mf">0.002963</span>   <span class="mf">1.018337</span> <span class="o">+/-</span> <span class="mf">0.004109</span>   <span class="mf">0.0221</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g006</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">46.047133</span> <span class="o">+/-</span> <span class="mf">0.001958</span>   <span class="mf">1.021483</span> <span class="o">+/-</span> <span class="mf">0.003082</span>   <span class="mf">0.0222</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">g007</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">45.476146</span> <span class="o">+/-</span> <span class="mf">0.002065</span>   <span class="mf">1.070456</span> <span class="o">+/-</span> <span class="mf">0.003133</span>   <span class="mf">0.0235</span>
</pre></div>
</div>
<p>The degenerate twists grouped by set are <span class="math notranslate nohighlight">\(\{0\}\)</span>,
<span class="math notranslate nohighlight">\(\{1,2,4\}\)</span>, <span class="math notranslate nohighlight">\(\{3,5,6\}\)</span>, and <span class="math notranslate nohighlight">\(\{7\}\)</span>.</p>
<p>Alternatively, the run could have been performed at the four
unique (irreducible) twist angles <em>only</em>.  We will emulate this situation by
analyzing data for twists 0, 1, 3, and 7 only.  In a production setting
with irreducibly weighted twists, the run would be performed on these twists
alone; we reuse the uniform twist data for illustration purposes only.</p>
<p>We can use <code class="docutils literal notranslate"><span class="pre">qmca</span></code> to perform twist averaging with different
weights applied to each twist:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">w</span> <span class="s1">&#39;1 3 3 1&#39;</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">g000</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">*</span> <span class="o">*</span><span class="n">g001</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">*</span> <span class="o">*</span><span class="n">g003</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">*</span> <span class="o">*</span><span class="n">g007</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">*</span>
                            <span class="n">LocalEnergy</span>               <span class="n">Variance</span>           <span class="n">ratio</span>
<span class="n">avg</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="o">-</span><span class="mf">45.873631</span> <span class="o">+/-</span> <span class="mf">0.001044</span>   <span class="mf">1.028769</span> <span class="o">+/-</span> <span class="mf">0.001520</span>   <span class="mf">0.0224</span>
</pre></div>
</div>
<p>yielding a total energy value of <span class="math notranslate nohighlight">\(-45.874(1)\)</span> Ha, in agreement with the
uniform weighted twist average performed previously.</p>
<p>The decision of whether or not to perform irreducible weighted twist
averaging should be made on the basis of efficiency.  The relative
efficiency of irreducible vs. uniform weighted twist averaging
depends on the irreducible weights and the ratio of the lengths of
the available sampling and equilibration periods.  A formula for
the relative efficiency of these two cases is derived and discussed
in more detail in <span class="xref std std-ref">appendix-a</span>.</p>
</div>
<div class="section" id="setting-output-units">
<span id="qmca-output-units"></span><h3>Setting output units<a class="headerlink" href="#setting-output-units" title="Permalink to this headline">¶</a></h3>
<p>Estimates outputted by <code class="docutils literal notranslate"><span class="pre">qmca</span></code> are in Hartree units by default. The
output units for energetic quantities can be changed by using the <code class="docutils literal notranslate"><span class="pre">-u</span></code>
option.</p>
<p>Energy in Hartrees:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">u</span> <span class="n">Ha</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">46.032960</span> <span class="o">+/-</span> <span class="mf">0.002077</span>
</pre></div>
</div>
<p>Energy in electron volts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">u</span> <span class="n">eV</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">1252.620565</span> <span class="o">+/-</span> <span class="mf">0.056521</span>
</pre></div>
</div>
<p>Energy in Rydbergs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">u</span> <span class="n">rydberg</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">92.065919</span> <span class="o">+/-</span> <span class="mf">0.004154</span>
</pre></div>
</div>
<p>Energy in kilojoules per mole:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">u</span> <span class="n">kj_mol</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="n">qmc</span>  <span class="n">series</span> <span class="mi">2</span>  <span class="n">LocalEnergy</span>           <span class="o">=</span>  <span class="o">-</span><span class="mf">120859.512998</span> <span class="o">+/-</span> <span class="mf">5.453431</span>
</pre></div>
</div>
</div>
<div class="section" id="speeding-up-trace-plotting">
<span id="qmca-fast-trace-plot"></span><h3>Speeding up trace plotting<a class="headerlink" href="#speeding-up-trace-plotting" title="Permalink to this headline">¶</a></h3>
<p>When working with many files or files with many entries, <code class="docutils literal notranslate"><span class="pre">qmca</span></code> might
take a long time to produce plots. The time delay is actually due to the
autocorrelation time estimate used to calculate error bars. The
calculation time for the autocorrelation scales as
<span class="math notranslate nohighlight">\(\mathcal{O}(M^2)\)</span>, with <span class="math notranslate nohighlight">\(M\)</span> being the number of statistical
samples. If you are interested only in plotting traces and not in the
estimated error bars, the autocorrelation time estimation can be turned
off with the <code class="docutils literal notranslate"><span class="pre">–noac</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="o">--</span><span class="n">noac</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>Note that the resulting error bars printed to the console will be
underestimated and are not meaningful. Do <em>not</em> use <code class="docutils literal notranslate"><span class="pre">–noac</span></code> in
conjunction with the <code class="docutils literal notranslate"><span class="pre">-p</span></code> plotting option as these plots are of no use
without meaningful error bars.</p>
</div>
<div class="section" id="short-usage-examples">
<span id="qmca-short-example"></span><h3>Short usage examples<a class="headerlink" href="#short-usage-examples" title="Permalink to this headline">¶</a></h3>
<p>Plotting a trace of the local energy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Applying an equilibration cutoff to VMC data (series 0):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">s000</span><span class="o">.</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Applying the same equilibration cutoff to VMC and DMC data (series 0, 1, 2):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Applying different equilibration cutoffs to VMC and DMC data (series 0, 1, 2):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;30 20 40&#39;</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining the energy, variance, and variance/energy ratio for all series:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Overlaying plots of mean + error bar for energy and variance for separate
two- and three-body Jastrow optimization runs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">po</span> <span class="o">-</span><span class="n">q</span> <span class="n">ev</span> <span class="o">./</span><span class="n">optJ2</span><span class="o">/*</span><span class="n">scalar</span><span class="o">*</span> <span class="o">./</span><span class="n">optJ3</span><span class="o">/*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining the acceptance ratio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ar</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining the average DMC walker population:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">nw</span> <span class="o">-</span><span class="n">e</span> <span class="mi">400</span> <span class="o">*</span><span class="n">s002</span><span class="o">.</span><span class="n">dmc</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>Obtaining the MC efficiency:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">eff</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining the total wall clock time per series:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">tt</span> <span class="o">-</span><span class="n">e</span> <span class="mi">0</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining the average wall clock time spent per block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">bc</span> <span class="o">-</span><span class="n">e</span> <span class="mi">0</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining a subset of desired quantities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="s1">&#39;e v ar eff&#39;</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining all available quantities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
<p>Obtaining the twist-averaged total energy with uniform weights:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>Obtaining the twist-averaged total energy with specific weights:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">w</span> <span class="s1">&#39;1 3 3 1&#39;</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>Obtaining the local, kinetic, and potential energies in eV:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">q</span> <span class="n">ekp</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">-</span><span class="n">u</span> <span class="n">eV</span> <span class="o">*</span><span class="n">scalar</span><span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="production-quality-checklist">
<span id="qmca-production-checklist"></span><h3>Production quality checklist<a class="headerlink" href="#production-quality-checklist" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Inspect the trace plots (<code class="docutils literal notranslate"><span class="pre">-t</span></code> option) for any oddities in the data.
Typical behavior is a short equilibration period followed by benign
fluctuations around a clear mean value. There should not be any large
spikes in the data. This applies to <em>all</em> runs (VMC, optimization,
DMC, etc.).</p></li>
<li><p>Remove all equilibration steps (<code class="docutils literal notranslate"><span class="pre">-e</span></code> option) from the data by
inspecting the trace plot.</p></li>
<li><p>Check the quality of the orbitals (standalone Jastrow-less VMC or
sometimes the first <code class="docutils literal notranslate"><span class="pre">scalar</span></code> file produced during optimization) by
inspecting the variance/energy ratio <code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-q</span> <span class="pre">ev</span> <span class="pre">*scalar*</span></code>. For
pseudopotential systems without a Jastrow, the variance/energy ratio
should not exceed <span class="math notranslate nohighlight">\(0.2\)</span> Ha; otherwise, there is a problem with
the orbitals.</p></li>
<li><p>Check the quality of the optimized Jastrow factor by inspecting the
variance/energy ratio. For pseudopotential systems with a Jastrow,
the variance/energy ratio should not exceed <span class="math notranslate nohighlight">\(0.04\)</span> Ha for
pseudopotential systems. A good Jastrow is indicated by a
variance/energy ratio in the range of <span class="math notranslate nohighlight">\(0.01-0.03\)</span> Ha. A value
less than <span class="math notranslate nohighlight">\(0.01\)</span> Ha is difficult to achieve.</p></li>
<li><p>Confirm that the optimization has converged by plotting the energy
and variance vs. optimization series (<code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-p</span> <span class="pre">-q</span> <span class="pre">ev</span> <span class="pre">*scalar*</span></code>). Do
not assume that optimization has converged in only a few cycles. Use
at least 10 cycles with about 100,000 samples unless you already have
experience with the system in question.</p></li>
<li><p>Optimize Jastrow factors according to energy minimization to reduce
locality errors arising from the use of nonlocal pseudopotentials in
DMC. A good approach is to optimize with a few cycles of variance
minimization followed by several cycles of energy minimization.</p></li>
<li><p>Occasionally try optimizing with more samples and/or cycles to see if
improved results are obtained.</p></li>
<li><p>If using a B-spline representation of the orbitals, converge the VMC
energy and variance with respect to the mesh size (controlled via
meshfactor). This is best done in the presence of any Jastrow factor
to reduce noise. Consider using the hybrid LMTO representation of the
orbitals as this can reduce both the VMC/DMC variance and the DMC
time step error, in addition to saving memory.</p></li>
<li><p>Check the variance/energy ratio of all production VMC and DMC
calculations. In all cases, the DMC ratio should be slightly less
than the VMC ratio and both should abide the preceding guidelines,
i.e., the ratio should be less than <span class="math notranslate nohighlight">\(0.04\)</span> Ha for
pseudopotential systems. The production ratio should also be
consistent with what is observed during wavefunction optimization.</p></li>
<li><p>Be aware of population control bias in DMC. Run with a population of
<span class="math notranslate nohighlight">\(\sim 2,000\)</span> or greater. Occasionally repeat a run using a
larger population to explicitly confirm that population control bias
is small.</p></li>
<li><p>Check the stability of the DMC walker population by plotting the
trace of the population size (<code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-t</span> <span class="pre">-q</span> <span class="pre">nw</span> <span class="pre">*dmc.dat</span></code>). Verify
that the average walker population is consistent with the requested
value provided in the input.</p></li>
<li><p>In DMC, perform a time step study to obtain either (1) extrapolated
results or (2) a time step for future production where an energy
difference shows convergence (e.g., a band gap or defect formation
energy). For pseudopotential systems, converged time steps for many
systems are in the range of <span class="math notranslate nohighlight">\(0.002-0.01\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>, but
the actual converged time step must be explicitly checked.</p></li>
<li><p>In periodic systems, converge the total energy with respect to the
size of the twist/k-point grid. Results for smaller systems can
easily be transferred to larger ones (e.g., a
<span class="math notranslate nohighlight">\(2 \times 2 \times 2\)</span> twist grid in a
<span class="math notranslate nohighlight">\(2 \times 2 \times 2\)</span> tiled cell is equivalent to a
<span class="math notranslate nohighlight">\(1 \times 1 \times 1\)</span> twist grid in a
<span class="math notranslate nohighlight">\(4 \times 4 \times 4\)</span> tiled cell).</p></li>
<li><p>In periodic systems, perform finite-size extrapolation including two
body corrections (needed for cohesive energy/phase stability studies)
unless it can be shown that finite-size effects cancel for the energy
difference in question (e.g., some defect formation energies).</p></li>
</ol>
</div>
</div>
<div class="section" id="using-the-qmc-fit-tool-for-statistical-time-step-extrapolation-and-curve-fitting">
<span id="qmcfit"></span><h2>Using the qmc-fit tool for statistical time step extrapolation and curve fitting<a class="headerlink" href="#using-the-qmc-fit-tool-for-statistical-time-step-extrapolation-and-curve-fitting" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">qmc-fit</span></code> tool is used to provide statistical estimates of
curve-fitting parameters based on QMCPACK data. Although <code class="docutils literal notranslate"><span class="pre">qmc-fit</span></code>
will eventually support many types of fitted curves (e.g., Morse
potential binding curves and various equation-of-state fitting curves),
it is currently limited to estimating fitting parameters related to time
step extrapolation.</p>
<div class="section" id="the-jackknife-statistical-technique">
<h3>The jackknife statistical technique<a class="headerlink" href="#the-jackknife-statistical-technique" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">qmc-fit</span></code> tool obtains estimates of fitting parameter means and
associated error bars via the “jack-knife” technique. This technique is
a powerful and general tool to obtain meaningful error bars for any
quantity that is related in a nonlinear fashion to an underlying set of
statistical data. For this reason, we give a brief overview of the
jackknife technique before proceeding with usage instructions for the
<code class="docutils literal notranslate"><span class="pre">qmc-fit</span></code> tool.</p>
<p>Consider <span class="math notranslate nohighlight">\(N\)</span> statistical variables <span class="math notranslate nohighlight">\(\{x_n\}_{n=1}^N\)</span> that
have been outputted by one or more simulation runs. If we have <span class="math notranslate nohighlight">\(M\)</span>
samples of each of the <span class="math notranslate nohighlight">\(N\)</span> variables, then the mean values of each
these variables can be estimated in the standard way, that is,
<span class="math notranslate nohighlight">\(\bar{x}_n\approx \tfrac{1}{M}\sum_{m=1}^Mx_{nm}\)</span>.</p>
<p>Suppose we are interested in <span class="math notranslate nohighlight">\(P\)</span> statistical quantities
<span class="math notranslate nohighlight">\(\{y_p\}_{p=1}^P\)</span> that are related to the original <span class="math notranslate nohighlight">\(N\)</span>
variables by a known multidimensional function <span class="math notranslate nohighlight">\(F\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eq46">
<span class="eqno">(46)<a class="headerlink" href="#equation-eq46" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
   y_1,y_2,\ldots,y_P &amp;= F(x_1,x_2,\ldots,x_N)\quad \textrm{or} \nonumber \\
   \vec{y} &amp;= F(\vec{x})\:.\end{aligned}\end{split}\]</div>
<p>The relationship implied by <span class="math notranslate nohighlight">\(F\)</span> is completely general. For
example, the <span class="math notranslate nohighlight">\(\{x_n\}\)</span> might be elements of a matrix with
<span class="math notranslate nohighlight">\(\{y_p\}\)</span> being the eigenvalues, or <span class="math notranslate nohighlight">\(F\)</span> might be a fitting
procedure for <span class="math notranslate nohighlight">\(N\)</span> energies at different time steps with <span class="math notranslate nohighlight">\(P\)</span>
fitting parameters. An approximate guess at the mean value of
<span class="math notranslate nohighlight">\(\vec{y}\)</span> can be obtained by evaluating <span class="math notranslate nohighlight">\(F\)</span> at the mean
value of <span class="math notranslate nohighlight">\(\vec{x}\)</span> (i.e. <span class="math notranslate nohighlight">\(F(\bar{x}_1\ldots\bar{x}_N)\)</span>), but
with this approach we have no way to estimate the statistical error bar
of any <span class="math notranslate nohighlight">\(\bar{y}_p\)</span>.</p>
<p>In the jackknife procedure, the statistical variability intrinsic to the
underlying data <span class="math notranslate nohighlight">\(\{x_n\}\)</span> is used to obtain estimates of the mean
and error bar of <span class="math notranslate nohighlight">\(\{y_p\}\)</span>. We first construct a new set of
<span class="math notranslate nohighlight">\(x\)</span> statistical data by taking the average over all samples but
one:</p>
<div class="math notranslate nohighlight" id="equation-eq47">
<span class="eqno">(47)<a class="headerlink" href="#equation-eq47" title="Permalink to this equation">¶</a></span>\[\tilde{x}_{nm} = \frac{1}{N-1}(N\bar{x}_n-x_{nm})\qquad m\in [1,M]\:.\]</div>
<p>The result is a distribution of approximate <span class="math notranslate nohighlight">\(x\)</span> mean values. These
are used to construct a distribution of approximate means for <span class="math notranslate nohighlight">\(y\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eq48">
<span class="eqno">(48)<a class="headerlink" href="#equation-eq48" title="Permalink to this equation">¶</a></span>\[\tilde{y}_{1m},\ldots,\tilde{y}_{Pm} = F(\tilde{x}_{1m},\ldots,\tilde{x}_{Nm}) \qquad m\in [1,M]\:.\]</div>
<p>Estimates for the mean and error bar of the quantities of
interest can finally be obtained using the following formulas:</p>
<div class="math notranslate nohighlight" id="equation-eq49">
<span class="eqno">(49)<a class="headerlink" href="#equation-eq49" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
   \bar{y}_p &amp;= \frac{1}{M}\sum_{m=1}^M\tilde{y}_{pm}\:.  \\
   \sigma_{y_p} &amp;= \sqrt{\frac{M-1}{M}\left(\sum_{m=1}^M\tilde{y}_{pm}^2-M\bar{y}_p^2\right)}\:.\end{aligned}\end{split}\]</div>
</div>
<div class="section" id="performing-time-step-extrapolation">
<h3>Performing time step extrapolation<a class="headerlink" href="#performing-time-step-extrapolation" title="Permalink to this headline">¶</a></h3>
<p>In this section, we use a 32-atom supercell of MnO as an example system
for time step extrapolation. Data for this system has been collected in
DMC using the following sequence of time steps:
<span class="math notranslate nohighlight">\(0.04,~0.02,~0.01,~0.005,~0.0025,~0.00125\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>. For
a typical production pseudopotential study, time steps in the range of
<span class="math notranslate nohighlight">\(0.02-0.002\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span> are usually sufficient and it is
recommended to increase the number of steps/blocks by a factor of two
when the time step is halved. To perform accurate statistical fitting,
we must first understand the equilibration and autocorrelation
properties of the inputted local energy data. After plotting the local
energy traces (<code class="docutils literal notranslate"><span class="pre">qmca</span> <span class="pre">-t</span> <span class="pre">-q</span> <span class="pre">e</span> <span class="pre">-e</span> <span class="pre">0</span> <span class="pre">./qmc*/*scalar*</span></code>), it is clear that
an equilibration period of <span class="math notranslate nohighlight">\(30\)</span> blocks is reasonable. Approximate
autocorrelation lengths are also obtained with <code class="docutils literal notranslate"><span class="pre">qmca</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmca</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">-</span><span class="n">q</span> <span class="n">e</span> <span class="o">--</span><span class="n">sac</span> <span class="o">./</span><span class="n">qmc</span><span class="o">*/</span><span class="n">qmc</span><span class="o">.</span><span class="n">g000</span><span class="o">.</span><span class="n">s002</span><span class="o">.</span><span class="n">scalar</span><span class="o">.</span><span class="n">dat</span>
<span class="o">./</span><span class="n">qmc_tm_0</span><span class="o">.</span><span class="mi">00125</span><span class="o">/</span><span class="n">qmc</span><span class="o">.</span><span class="n">g000</span> <span class="n">series</span> <span class="mi">2</span> <span class="n">LocalEnergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3848.234513</span> <span class="o">+/-</span> <span class="mf">0.055754</span>  <span class="mf">1.7</span>
<span class="o">./</span><span class="n">qmc_tm_0</span><span class="o">.</span><span class="mi">00250</span><span class="o">/</span><span class="n">qmc</span><span class="o">.</span><span class="n">g000</span> <span class="n">series</span> <span class="mi">2</span> <span class="n">LocalEnergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3848.237614</span> <span class="o">+/-</span> <span class="mf">0.055432</span>  <span class="mf">2.2</span>
<span class="o">./</span><span class="n">qmc_tm_0</span><span class="o">.</span><span class="mi">00500</span><span class="o">/</span><span class="n">qmc</span><span class="o">.</span><span class="n">g000</span> <span class="n">series</span> <span class="mi">2</span> <span class="n">LocalEnergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3848.349741</span> <span class="o">+/-</span> <span class="mf">0.069729</span>  <span class="mf">2.8</span>
<span class="o">./</span><span class="n">qmc_tm_0</span><span class="o">.</span><span class="mi">01000</span><span class="o">/</span><span class="n">qmc</span><span class="o">.</span><span class="n">g000</span> <span class="n">series</span> <span class="mi">2</span> <span class="n">LocalEnergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3848.274596</span> <span class="o">+/-</span> <span class="mf">0.126407</span>  <span class="mf">3.9</span>
<span class="o">./</span><span class="n">qmc_tm_0</span><span class="o">.</span><span class="mi">02000</span><span class="o">/</span><span class="n">qmc</span><span class="o">.</span><span class="n">g000</span> <span class="n">series</span> <span class="mi">2</span> <span class="n">LocalEnergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3848.539017</span> <span class="o">+/-</span> <span class="mf">0.075740</span>  <span class="mf">2.4</span>
<span class="o">./</span><span class="n">qmc_tm_0</span><span class="o">.</span><span class="mi">04000</span><span class="o">/</span><span class="n">qmc</span><span class="o">.</span><span class="n">g000</span> <span class="n">series</span> <span class="mi">2</span> <span class="n">LocalEnergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3848.976424</span> <span class="o">+/-</span> <span class="mf">0.075305</span>  <span class="mf">1.8</span>
</pre></div>
</div>
<p>The autocorrelation must be removed from the data before jackknifing, so
we will reblock the data by a factor of 4.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">qmc-fit</span></code> tool can be used in the following way to obtain a linear
time step fit of the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmc</span><span class="o">-</span><span class="n">fit</span> <span class="n">ts</span> <span class="o">-</span><span class="n">e</span> <span class="mi">30</span> <span class="o">-</span><span class="n">b</span> <span class="mi">4</span> <span class="o">-</span><span class="n">s</span> <span class="mi">2</span> <span class="o">-</span><span class="n">t</span> <span class="s1">&#39;0.00125 0.0025 0.005 0.01 0.02 0.04&#39;</span> <span class="o">./</span><span class="n">qmc</span><span class="o">*/*</span><span class="n">scalar</span><span class="o">*</span>
<span class="n">fit</span> <span class="n">function</span>  <span class="p">:</span> <span class="n">linear</span>
<span class="n">fitted</span> <span class="n">formula</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">3848.193</span> <span class="o">+/-</span> <span class="mf">0.037</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">18.95</span> <span class="o">+/-</span> <span class="mf">1.95</span><span class="p">)</span><span class="o">*</span><span class="n">t</span>
<span class="n">intercept</span>     <span class="p">:</span> <span class="o">-</span><span class="mf">3848.193</span> <span class="o">+/-</span> <span class="mf">0.037</span>  <span class="n">Ha</span>
</pre></div>
</div>
<p>The input arguments are as follows: <code class="docutils literal notranslate"><span class="pre">ts</span></code> indicates we are performing a
time step fit, <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">30</span></code> is the equilibration period removed from each
set of scalar data, <code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">4</span></code> indicates the data will be reblocked by a
factor of 4 (e.g., a file containing 400 entries will be block averaged
into a new set of 100 before jackknife fitting), <code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">2</span></code> indicates that
the time step data begins with series 2 (scalar files matching
<code class="docutils literal notranslate"><span class="pre">*s000*</span></code> or <code class="docutils literal notranslate"><span class="pre">*s001*</span></code> are to be excluded), and <code class="docutils literal notranslate"><span class="pre">-t</span></code> ‘0.00125 0.0025
0.005 0.01 0.02 0.04’ provides a list of time step values corresponding
to the inputted scalar files. The <code class="docutils literal notranslate"><span class="pre">-e</span></code> and <code class="docutils literal notranslate"><span class="pre">-b</span></code> options can receive
a list of file-specific values (same format as <code class="docutils literal notranslate"><span class="pre">-t</span></code>) if desired. As
can be seen from the text output, the parameters for the linear fit are
printed with error bars obtained with jackknife resampling and the zero
time step “intercept” is <span class="math notranslate nohighlight">\(-3848.19(4)\)</span> Ha. In addition to text
output, the previous command will result in a plot of the fit with the
zero time step value shown as a red dot, as shown in the top panel of
<a class="reference internal" href="#fig12"><span class="std std-numref">Fig. 12</span></a>.</p>
<p>Different fitting functions are supported via the <code class="docutils literal notranslate"><span class="pre">-f</span></code> option.
Currently supported options include <code class="docutils literal notranslate"><span class="pre">linear</span></code> (<span class="math notranslate nohighlight">\(a+bt\)</span>),
<code class="docutils literal notranslate"><span class="pre">quadratic</span></code> (<span class="math notranslate nohighlight">\(a+bt+ct^2\)</span>), and <code class="docutils literal notranslate"><span class="pre">sqrt</span></code>
(<span class="math notranslate nohighlight">\(a+b\sqrt{t}+ct\)</span>). Results for a quadratic fit are shown
subsequently and in the bottom panel of <a class="reference internal" href="#fig12"><span class="std std-numref">Fig. 12</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">qmc</span><span class="o">-</span><span class="n">fit</span> <span class="n">ts</span> <span class="o">-</span><span class="n">f</span> <span class="n">quadratic</span> <span class="o">-</span><span class="n">e30</span> <span class="o">-</span><span class="n">b4</span> <span class="o">-</span><span class="n">s2</span> <span class="o">-</span><span class="n">t</span> <span class="s1">&#39;0.00125 0.0025 0.005 0.01 0.02 0.04&#39;</span> <span class="o">./</span><span class="n">qmc</span><span class="o">*/*</span><span class="n">scalar</span><span class="o">*</span>
<span class="n">fit</span> <span class="n">function</span>  <span class="p">:</span> <span class="n">quadratic</span>
<span class="n">fitted</span> <span class="n">formula</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">3848.245</span> <span class="o">+/-</span> <span class="mf">0.047</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">7.25</span> <span class="o">+/-</span> <span class="mf">8.33</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">285.00</span> <span class="o">+/-</span> <span class="mf">202.39</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">^</span><span class="mi">2</span>
<span class="n">intercept</span>     <span class="p">:</span> <span class="o">-</span><span class="mf">3848.245</span> <span class="o">+/-</span> <span class="mf">0.047</span>  <span class="n">Ha</span>
</pre></div>
</div>
<p>In this case, we find a zero time step estimate of <span class="math notranslate nohighlight">\(-3848.25(5)\)</span>
Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>. A time step of <span class="math notranslate nohighlight">\(0.04\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span> might
be on the large side to include in time step extrapolation, and it is
likely to have an outsize influence in the case of linear extrapolation.
Upon excluding this point, linear extrapolation yields a zero timestep
value of <span class="math notranslate nohighlight">\(-3848.22(4)\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>. Note that quadratic
extrapolation can result in intrinsically larger uncertainty in the
extrapolated value. For example, when the <span class="math notranslate nohighlight">\(0.04\)</span> Ha<span class="math notranslate nohighlight">\(^{-1}\)</span>
point is excluded, the uncertainty grows by 50% and we obtain an
estimated value of <span class="math notranslate nohighlight">\(-3848.28(7)\)</span> instead.</p>
<a class="reference internal image-reference" href="_images/qmcfit_timestep_linear.png"><img alt="_images/qmcfit_timestep_linear.png" class="align-center" src="_images/qmcfit_timestep_linear.png" style="width: 400px;" /></a>
<div class="figure align-center" id="id9">
<span id="fig12"></span><a class="reference internal image-reference" href="_images/qmcfit_timestep_quadratic.png"><img alt="_images/qmcfit_timestep_quadratic.png" src="_images/qmcfit_timestep_quadratic.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">Linear (top) and quadratic (bottom) time step fits to DMC data for a 32-atom supercell of MnO obtained with <code class="docutils literal notranslate"><span class="pre">qmc-fit</span></code>.  Zero time step estimates are indicated by the red data point on the left side of either panel.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="using-the-qdens-tool-to-obtain-electron-densities">
<span id="qdens"></span><h2>Using the qdens tool to obtain electron densities<a class="headerlink" href="#using-the-qdens-tool-to-obtain-electron-densities" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">qdens</span></code> tool is provided to post-process the heavy density data
produced by QMCPACK and output the mean density (with and without
errorbars) in file formats viewable with, e.g., XCrysDen or VESTA. The
tool currently works only with the <code class="docutils literal notranslate"><span class="pre">SpinDensity</span></code> estimator in QMCPACK.</p>
<p>Note: this tool is provisional and may be changed or replaced at any
time. The planned successor to this tool (<code class="docutils literal notranslate"><span class="pre">qstat</span></code>) will expand access
to other observables and will retain at least the non-plotting
capabilities of <code class="docutils literal notranslate"><span class="pre">qdens</span></code>.</p>
<p>To use <code class="docutils literal notranslate"><span class="pre">qdens</span></code>, Nexus must be installed along with NumPy and H5Py. A
short list of example use cases are covered in the next section. Current
input flags are:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>&gt;qdens

Usage: qdens [options] [file(s)]

Options:
  --version             show program&#39;s version number and exit
  -h, --help            Print help information and exit (default=False).
  -v, --verbose         Print detailed information (default=False).
  -f FORMATS, --formats=FORMATS
                        Format or list of formats for density file output.
                        Options: dat, xsf, chgcar (default=None).
  -e EQUILIBRATION, --equilibration=EQUILIBRATION
                        Equilibration length in blocks (default=0).
  -r REBLOCK, --reblock=REBLOCK
                        Block coarsening factor; use estimated autocorrelation
                        length (default=None).
  -a, --average         Average over files in each series (default=False).
  -w WEIGHTS, --weights=WEIGHTS
                        List of weights for averaging (default=None).
  -i INPUT, --input=INPUT
                        QMCPACK input file containing structure and grid
                        information (default=None).
  -s STRUCTURE, --structure=STRUCTURE
                        File containing atomic structure (default=None).
  -g GRID, --grid=GRID  Density grid dimensions (default=None).
  -c CELL, --cell=CELL  Simulation cell axes (default=None).
  --lineplot=LINEPLOT   Produce a line plot along the selected dimension: 0,
                        1, or 2 (default=None).
  --noplot              Do not show plots interactively (default=False).
</pre></div>
</div>
<div class="section" id="usage-examples">
<h3>Usage examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h3>
<p>Process a single file, excluding the first 40 blocks, and produce XSF files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qdens</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="o">-</span><span class="n">f</span> <span class="n">xsf</span> <span class="o">-</span><span class="n">i</span> <span class="n">qmc</span><span class="o">.</span><span class="ow">in</span><span class="o">.</span><span class="n">xml</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">stat</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
<p>Process files for all available series:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qdens</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="o">-</span><span class="n">f</span> <span class="n">xsf</span> <span class="o">-</span><span class="n">i</span> <span class="n">qmc</span><span class="o">.</span><span class="ow">in</span><span class="o">.</span><span class="n">xml</span> <span class="o">*</span><span class="n">stat</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
<p>Combine groups of 10 adjacent statistical blocks together (appropriate if the
estimated autocorrelation time is about 10 blocks):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qdens</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="o">-</span><span class="n">r</span> <span class="mi">10</span> <span class="o">-</span><span class="n">f</span> <span class="n">xsf</span> <span class="o">-</span><span class="n">i</span> <span class="n">qmc</span><span class="o">.</span><span class="ow">in</span><span class="o">.</span><span class="n">xml</span> <span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">stat</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
<p>Apply different equilibration lengths and reblocking factors to each
series (below is appropriate if there are three series, e.g. <code class="docutils literal notranslate"><span class="pre">s000</span></code>,
<code class="docutils literal notranslate"><span class="pre">s001</span></code>, and <code class="docutils literal notranslate"><span class="pre">s002</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qdens</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;20 20 40&#39;</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;4 4 8&#39;</span> <span class="o">-</span><span class="n">f</span> <span class="n">xsf</span> <span class="o">-</span><span class="n">i</span> <span class="n">qmc</span><span class="o">.</span><span class="ow">in</span><span class="o">.</span><span class="n">xml</span> <span class="o">*</span><span class="n">stat</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
<p>Produce twist averaged densities (also works with multiple series and reblocking):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qdens</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">e</span> <span class="mi">40</span> <span class="o">-</span><span class="n">f</span> <span class="n">xsf</span> <span class="o">-</span><span class="n">i</span> <span class="n">qmc</span><span class="o">.</span><span class="n">g000</span><span class="o">.</span><span class="n">twistnum_0</span><span class="o">.</span><span class="ow">in</span><span class="o">.</span><span class="n">xml</span> <span class="n">qmc</span><span class="o">.</span><span class="n">g</span><span class="o">*.</span><span class="n">s000</span><span class="o">.</span><span class="n">stat</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
<p>Twist averaging with arbitrary weights can be performed via the <code class="docutils literal notranslate"><span class="pre">-w</span></code>
option in a fashion identical to <code class="docutils literal notranslate"><span class="pre">qmca</span></code>.</p>
</div>
<div class="section" id="files-produced">
<h3>Files produced<a class="headerlink" href="#files-produced" title="Permalink to this headline">¶</a></h3>
<p>Look for files with names and extensions similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">-</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">+</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>

<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_d</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_d</span><span class="o">-</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_d</span><span class="o">+</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>

<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">+</span><span class="n">d</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">+</span><span class="n">d</span><span class="o">-</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>

<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">-</span><span class="n">d</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">-</span><span class="n">d</span><span class="o">-</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>
<span class="n">qmc</span><span class="o">.</span><span class="n">s000</span><span class="o">.</span><span class="n">SpinDensity_u</span><span class="o">-</span><span class="n">d</span><span class="o">+</span><span class="n">err</span><span class="o">.</span><span class="n">xsf</span>
</pre></div>
</div>
<p>Files postfixed with <code class="docutils literal notranslate"><span class="pre">u</span></code> relate to the up electron density, <code class="docutils literal notranslate"><span class="pre">d</span></code> to
down, <code class="docutils literal notranslate"><span class="pre">u+d</span></code> to the total charge density, and <code class="docutils literal notranslate"><span class="pre">u-d</span></code> to the difference
between up and down electron densities.</p>
<p>Files without <code class="docutils literal notranslate"><span class="pre">err</span></code> in the name contain only the mean, whereas files
with <code class="docutils literal notranslate"><span class="pre">+err</span></code>/<code class="docutils literal notranslate"><span class="pre">-err</span></code> in the name contain the mean plus/minus the
estimated error bar. Please use caution in interpreting the error bars
as their accuracy depends crucially on a correct estimation of the
autocorrelation time by the user (see <code class="docutils literal notranslate"><span class="pre">-r</span></code> option) and having a
sufficient number of blocks remaining following any reblocking.</p>
<p>When twist averaging, the group tag (e.g. <code class="docutils literal notranslate"><span class="pre">g000</span></code> or similar) will be
replaced with <code class="docutils literal notranslate"><span class="pre">avg</span></code> in the names of the outputted files.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="LCAO.html" class="btn btn-neutral float-right" title="Periodic LCAO for Solids" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="output_overview.html" class="btn btn-neutral float-left" title="Output Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, QMCPACK Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
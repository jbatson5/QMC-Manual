

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Selected Configuration Interaction &mdash; QMCPACK Manual  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Auxiliary-Field Quantum Monte Carlo" href="afqmc.html" />
    <link rel="prev" title="Periodic LCAO for Solids" href="LCAO.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> QMCPACK Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features of QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Obtaining, installing, and validating QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units used in QMCPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_overview.html">Input file overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulationcell.html">Specifying the system to be simulated</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_wavefunction.html">Trial wavefunction specificaion</a></li>
<li class="toctree-l1"><a class="reference internal" href="hamiltonianobservable.html">Hamiltonian and Observables</a></li>
<li class="toctree-l1"><a class="reference internal" href="methods.html">Quantum Monte Carlo Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_overview.html">Output Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzing.html">Analyzing QMCPACK data</a></li>
<li class="toctree-l1"><a class="reference internal" href="LCAO.html">Periodic LCAO for Solids</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Selected Configuration Interaction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#theoretical-background">Theoretical background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cipsi-wavefunction-interface">CIPSI wavefunction interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="afqmc.html">Auxiliary-Field Quantum Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_qmc_statistics.html">Lab 1: MC Statistical Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_qmc_basics.html">Lab 2: QMC Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_advanced_molecules.html">Lab 3: Advanced molecular calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_condensed_matter.html">Lab 4: Condensed Matter Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_excited.html">Lab 5: Excited state calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional_tools.html">Additional Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_tools.html">External Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to the Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_testing.html">Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="design_features.html">QMCPACK Design and Feature Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices.html">Appendices</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QMCPACK Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Selected Configuration Interaction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sCI.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="selected-configuration-interaction">
<span id="sci"></span><h1>Selected Configuration Interaction<a class="headerlink" href="#selected-configuration-interaction" title="Permalink to this headline">¶</a></h1>
<p>A direct path towards improving the accuracy of a QMC calculation is
through a better trial wavefunction.  Although using a multireference
wavefunction can be straightforward in theory, in actual practice
methods such as CASSCF are not always intuitive and often require
being an expert in either the method or the code generating the
wavefunction.  An alternative is to use a selected configuration of
interaction method (selected CI) such as CIPSI (configuration
interaction using a perturbative selection done iteratively). This
provides a direct route to systematically improving the wavefunction.</p>
<div class="section" id="theoretical-background">
<h2>Theoretical background<a class="headerlink" href="#theoretical-background" title="Permalink to this headline">¶</a></h2>
<p>The principle behind selected CI is rather simple and was first published in 1955 by R. K. Nesbet <a class="bibtex reference internal" href="#nesbet1955" id="id1">[Nes55]</a>. The first calculations on atoms were performed by Diner, Malrieu, and Claverie <a class="bibtex reference internal" href="#diner1967" id="id2">[DMC67]</a> in 1967 and became computationally viable for larger molecules in 2013 by Caffarel et al. <a class="bibtex reference internal" href="#caffarel2013" id="id3">[EG13]</a>.</p>
<p>As described by Caffarel et al. in <a class="bibtex reference internal" href="#caffarel2013" id="id4">[EG13]</a>,
multideterminantal expansions of the ground-state wavefunction
<span class="math notranslate nohighlight">\(\Psi_T\)</span> are written as a linear combination of Slater determinants</p>
<div class="math notranslate nohighlight" id="equation-eq51">
<span class="eqno">(51)<a class="headerlink" href="#equation-eq51" title="Permalink to this equation">¶</a></span>\[\sum_k c_k \sum_q d_{k,q}D_{k,q\uparrow } (r^{\uparrow})D_{k,q\downarrow}(r^{\downarrow})\:,\]</div>
<p>where each determinant corresponds to a given occupation by the
<span class="math notranslate nohighlight">\(N_{\alpha}\)</span> and <span class="math notranslate nohighlight">\(N_{\beta}\)</span> electrons of
<span class="math notranslate nohighlight">\(N=N_{\alpha}+N_{\beta}\)</span> orbitals among a set of M spin-orbitals
<span class="math notranslate nohighlight">\(\{\phi_1,.,\phi_M\}\)</span> (restricted case). When no symmetries are
considered, the maximum number of such determinants is</p>
<div class="math notranslate nohighlight" id="equation-eq52">
<span class="eqno">(52)<a class="headerlink" href="#equation-eq52" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
\left(
\begin{array}{c} M \hspace{1.5mm} \\ N_{\alpha}  \end{array}
\right).
\left(
\begin{array}{c} M \hspace{1.5mm} \\ N_{\beta}  \end{array}
\right),\end{aligned}\end{split}\]</div>
<p>a number that grows factorially with M and N. The best representation of the exact wavefunction in the determinantal basis is the full configuration interaction (FCI) wavefunction written as</p>
<div class="math notranslate nohighlight" id="equation-eq53">
<span class="eqno">(53)<a class="headerlink" href="#equation-eq53" title="Permalink to this equation">¶</a></span>\[|{\Psi_0}\rangle=\sum_{i} c_{i}|{D_i}\rangle\:,\]</div>
<p>where <span class="math notranslate nohighlight">\(c_i\)</span> are the ground-state coefficients obtained by
diagonalizing the matrix, <span class="math notranslate nohighlight">\(H_{ij}=\langle{D_i}|H|{D_j}\rangle\)</span>, within the
full orthonormalized set <span class="math notranslate nohighlight">\(\langle{D_i}||{D_j}\rangle=\delta_{ij}\)</span> of
determinants <span class="math notranslate nohighlight">\(|{D_i}\rangle\)</span>. CIPSI provides a convenient method to
build up to this full wavefunction with a single criteria.</p>
<p>A CIPSI wavefunction is built iteratively starting from a reference
wavefunction, usually Hartree-Fock or CASSCF, by adding all single and
double excitations and then iteratively selecting relevant
determinants according to some criteria. Detailed iterative steps can
be found in the reference by Caffarel et al. and references
within <a class="bibtex reference internal" href="#caffarel2013" id="id5">[EG13]</a>, <a class="bibtex reference internal" href="#scemama2016" id="id6">[SAGC16]</a>, <a class="bibtex reference internal" href="#scemama2018" id="id7">[SGCL0]</a> and <a class="bibtex reference internal" href="#garniron2017-2" id="id8">[GSLC17]</a> and
are summarized as follows:</p>
<ul class="simple">
<li><p>Step 1: Define a reference wavefunction:</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq54">
<span class="eqno">(54)<a class="headerlink" href="#equation-eq54" title="Permalink to this equation">¶</a></span>\[\begin{gathered}
       \begin{aligned}
         |{\Psi}\rangle&amp;=\sum_{i\in D} c_i|{i}\rangle \,         \,
         &amp;E_{var}&amp;= \frac{\langle{\Psi}|\hat{H}|{\Psi}\rangle}{\langle{\Psi}||{\Psi}\rangle}.
       \end{aligned}
     \end{gathered}\]</div>
<ul class="simple">
<li><p>Step 2: Generate external determinants <span class="math notranslate nohighlight">\(|{\alpha}\rangle\)</span>:
New determinants are added by generating all single and double
excitations from determinants <span class="math notranslate nohighlight">\(i \in D\)</span> such as:</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq55">
<span class="eqno">(55)<a class="headerlink" href="#equation-eq55" title="Permalink to this equation">¶</a></span>\[\langle{\Psi_0^{(n)}}|H|{D_{i_c}}\rangle\neq 0\:.\]</div>
<ul class="simple">
<li><p>Step 3: Evaluate the second-order perturbative contribution to each determinant <span class="math notranslate nohighlight">\(|{\alpha}\rangle\)</span>:</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq56">
<span class="eqno">(56)<a class="headerlink" href="#equation-eq56" title="Permalink to this equation">¶</a></span>\[\Delta E=\frac{\langle{\Psi}|\hat{H}|{\alpha}\rangle\langle{\alpha}|\hat{H}|{\Psi}\rangle}{E_{var}-\langle{\alpha}|\hat{H}|{\alpha}\rangle}\:.\]</div>
<ul class="simple">
<li><p>Step 4: Select the determinants with the largest contributions and add them to the Hamiltonian.</p></li>
<li><p>Step 5: Diagonalize the Hamiltonian within the new added determinants and update the wavefunction and the the value of <span class="math notranslate nohighlight">\(E_{var}\)</span>.</p></li>
<li><p>Step 6: Iterate until reaching convergence.</p></li>
</ul>
<p>Repeating this process leads to a multireference trial wavefunction of high quality that can be used in QMC.</p>
<div class="math notranslate nohighlight" id="equation-eq57">
<span class="eqno">(57)<a class="headerlink" href="#equation-eq57" title="Permalink to this equation">¶</a></span>\[\Psi_T(r)=e^{J(r)}\sum_k c_k \sum_q d_{k,q}D_{k,q\uparrow } (r^{\uparrow})D_{k,q\downarrow}(r^{\downarrow})\:.\]</div>
<p>The linear coefficients <span class="math notranslate nohighlight">\(c_k\)</span> are then optimized with the presence
of the Jastrow function.</p>
<p>Note the following:</p>
<ul class="simple">
<li><p>When all determinants <span class="math notranslate nohighlight">\(|{\alpha}\rangle\)</span> are selected, the full
configuration interaction result is obtained.</p></li>
<li><p>CIPSI can be seen as a deterministic counterpart of FCIQMC.</p></li>
<li><p>In practice, any wavefunction method can be made multireference with
CIPSI. For instance, a multireference coupled cluster (MRCC) with
CIPSI is implemented in QP. <a class="bibtex reference internal" href="#garniron2017-1" id="id9">[GGMS17]</a></p></li>
<li><p>At any time, with CIPSI selection,
<span class="math notranslate nohighlight">\(E_{PT_2}=\sum_\alpha \Delta E_\alpha\)</span> estimates the distance
to the FCI solution.</p></li>
</ul>
<div class="section" id="cipsi-wavefunction-interface">
<span id="cipsi"></span><h3>CIPSI wavefunction interface<a class="headerlink" href="#cipsi-wavefunction-interface" title="Permalink to this headline">¶</a></h3>
<p>The CIPSI method is implemented in the QP code:cite:<cite>QP</cite> developed by the Caffarel group. Once the trial wavefunction is generated, QP is able to produce output readable by the QMCPACK converter as described in <a class="reference internal" href="additional_tools.html#convert4qmc"><span class="std std-ref">convert4qmc</span></a>. QP can be installed with multiple plugins for different levels of theory in quantum chemistry. When installing the “QMC” plugin, QP can save the wavefunction in a format readable by the QMCPACK converter.</p>
<p>In the following we use the <span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span> molecule
(<a class="reference internal" href="#fig13"><span class="std std-numref">Fig. 13</span></a>) as an example of how to run a multireference
calculation with CIPSI as a trial wavefunction for . The choice of this
molecule is motivated by its multireference nature. Although the
molecule remains small enough for CCSD(T) calculations with aug-cc-pVTZ
basis set, the D1 diagnostic shows a very high value for
<span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span>, suggesting a multireference character. Therefore, an
accurate reference for the system is not available, and it becomes
difficult to trust the quality of a single-determinant wavefunction even
when using the DFT-B3LYP exchange and correlation functional. Therefore,
in the following, we show an example of how to systematically improve
the nodal surface by increasing the number of determinants in the trial
wavefunction.</p>
<div class="figure align-center" id="id11">
<span id="fig13"></span><a class="reference internal image-reference" href="_images/Reactant.jpg"><img alt="_images/Reactant.jpg" src="_images/Reactant.jpg" style="width: 200px;" /></a>
<p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text"><span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span> molecule.</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
<p>The following steps show how to run from Hartree-Fock to selected CI using QP, convert the wavefunction to a QMCPACK trial wavefunction, and analyze the result.</p>
<ul>
<li><p>Step 1: Generate the QP input file.
QP takes for input an XYZ file containing the geometry of the molecule such as:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 26%" />
<col style="width: 26%" />
<col style="width: 26%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>8</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>C2O2H3N</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>C</p></td>
<td><p>1.067070</p></td>
<td><p>-0.370798</p></td>
<td><p>0.020324</p></td>
</tr>
<tr class="row-even"><td><p>C</p></td>
<td><p>-1.115770</p></td>
<td><p>-0.239135</p></td>
<td><p>0.081860</p></td>
</tr>
<tr class="row-odd"><td><p>O</p></td>
<td><p>-0.537581</p></td>
<td><p>1.047619</p></td>
<td><p>-0.091020</p></td>
</tr>
<tr class="row-even"><td><p>N</p></td>
<td><p>0.879629</p></td>
<td><p>0.882518</p></td>
<td><p>0.046830</p></td>
</tr>
<tr class="row-odd"><td><p>H</p></td>
<td><p>-1.525096</p></td>
<td><p>-0.354103</p></td>
<td><p>1.092299</p></td>
</tr>
<tr class="row-even"><td><p>H</p></td>
<td><p>-1.868807</p></td>
<td><p>-0.416543</p></td>
<td><p>-0.683862</p></td>
</tr>
<tr class="row-odd"><td><p>H</p></td>
<td><p>2.035229</p></td>
<td><p>-0.841662</p></td>
<td><p>0.053363</p></td>
</tr>
<tr class="row-even"><td><p>O</p></td>
<td><p>-0.025736</p></td>
<td><p>-1.160835</p></td>
<td><p>-0.084319</p></td>
</tr>
</tbody>
</table>
<p>The input file is generated through the following command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_create_ezfio_from_xyz</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">xyz</span> <span class="o">-</span><span class="n">b</span> <span class="n">cc</span><span class="o">-</span><span class="n">pvtz</span>
</pre></div>
</div>
<p>This means that we will be simulating the molecule in all electrons
within the cc-pVTZ basis set. Other options are, of course, possible
such as using ECPs, different spin multiplicities, etc. For more
details, see the QP tutorial at
<a class="reference external" href="https://github.com/LCPQ/quantum_package/wiki/Tutorial">https://github.com/LCPQ/quantum_package/wiki/Tutorial</a>.</p>
<p>A directory called <code class="docutils literal notranslate"><span class="pre">C2O2H3N.ezfio</span></code> is created and contains all the
relevant data to run the SCF Hartree-Fock calculation. Note that because
of the large size of molecular orbitals (MOs) (220), it is preferable to
run QP in parallel. QP parallelization is based on a master/slave
process that allows a master node to manage the work load between
multiple MPI processes through the LibZMQ library. In practice, the run
is submitted to one master node and is then submitted to as many nodes
as necessary to speed up the calculations. If a slave node dies before
the end of its task, the master node will resubmit the workload to
another available node. If more nodes are added at any time during the
simulation, the master node will use them to reduce the time to
solution.</p>
</li>
<li><p>Step 2: Run Hartree-Fock.
To save the integrals on disk and avoid recomputing them later, edit
the <code class="docutils literal notranslate"><span class="pre">ezfio</span></code> directory with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_edit</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span>
</pre></div>
</div>
<p>This will generate a temporary file showing all the contents of the
simulation and opens an editor to allow modification of their values.
Look for <code class="docutils literal notranslate"><span class="pre">disk_access_ao_integrals</span></code> and modify its value from <code class="docutils literal notranslate"><span class="pre">None</span></code>
to <code class="docutils literal notranslate"><span class="pre">Write</span></code>.</p>
<p>To run a simulation with QP, use the binary texttt{qp_run} with the desired level of theory, in this case Hartree-Fock (SCF).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">1</span> <span class="n">qp_run</span> <span class="n">SCF</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span> <span class="o">&amp;&gt;</span> <span class="n">C2O2H3N</span><span class="o">-</span><span class="n">SCF</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>If run in serial, the evaluation of the integrals and the Hamiltonian diagonalization would take a substantial amount of computer time. We recommend adding a few more slave nodes to help speed up the calculation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">20</span> <span class="n">qp_run</span> <span class="o">-</span><span class="n">slave</span> <span class="n">qp_ao_ints</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span> <span class="o">&amp;&gt;</span> <span class="n">C2O2H3N</span><span class="o">-</span><span class="n">SCF</span><span class="o">-</span><span class="n">Slave</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>The total Hartree-Fock energy of the system in cc-pVTZ is
<em>:math:`E_{HF}=-283.0992`</em>Ha.</p>
</li>
<li><p>Step 3: Freeze core electrons. To avoid making excitation from the core electrons, freeze the core electrons and do only the excitations from the valence electrons.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_set_frozen_core</span><span class="o">.</span><span class="n">py</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span>
</pre></div>
</div>
<p>This will will automatically freeze the orbitals from 1 to 5, leaving the remaining orbitals active.</p>
</li>
<li><p>Step 4: Transform atomic orbitals (AOs) to MOs.
This step is the most costly, especially given that its implementation in QP is serial. We recommend completing it in a separate run and on one node.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_run</span> <span class="n">four_idx_transform</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span>
</pre></div>
</div>
<p>The MO integrals are now saved on disk, and unless the orbitals are changed, they will not be recomputed.</p>
</li>
<li><p>Step 5: CIPSI
At this point the wavefunction is ready for the selected CI. By default,
QP has two convergence criteria: the number of determinants (set by
default to 1M) or the value of PT2 (set by default to
<span class="math notranslate nohighlight">\(1.10^{-4}\)</span>Ha). For this molecule, the total number of
determinants in the FCI space is <span class="math notranslate nohighlight">\(2.07e+88\)</span> determinants. Although
this number is completely out of range of what is possible to compute,
we will set the limit of determinants in QP to 5M determinants and see
whether the nodal surface of the wavefunction is converged enough for
the DMC. At this point it is important to remember that the main value
of CIPSI compared with other selected CI methods, is that the value of
PT2 is evaluated directly at each step, giving a good estimate of the
error to the FCI energy. This allows us to conclude that when the E+PT2
energy is converged, the nodal surface is also probably converged.
Similar to the SCF runs, FCI runs have to be submitted in parallel with
a master/slave process:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">1</span> <span class="n">qp_run</span> <span class="n">fci_zmq</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span> <span class="o">&amp;&gt;</span> <span class="n">C2O2H3N</span><span class="o">-</span><span class="n">FCI</span><span class="o">.</span><span class="n">out</span>
<span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">199</span> <span class="n">qp_run</span> <span class="o">-</span><span class="n">slave</span> <span class="n">selection_davidson_slave</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span>\\
<span class="o">&amp;&gt;</span> <span class="n">C2O2H3N</span><span class="o">-</span><span class="n">FCI</span><span class="o">-</span><span class="n">Slave</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
</li>
<li><p>Step 6 (optional): Natural orbitals
Although this step is optional, it is important to note that using natural orbitals instead of Hartree-Fock orbitals will always improve the quality of the wavefunction and the nodal surface by reducing the number of needed determinants for the same accuracy. When a full convergence to the FCI limit is attainable, this step will not lead to any change in the energy but will only reduce the total number of determinants. However, if a full convergence is not possible, this step can significantly increase the accuracy of the calculation at the same number of determinants.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_run</span> <span class="n">save_natorb</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span>
</pre></div>
</div>
<p>At this point, the orbitals are modified, a new
AO <span class="math notranslate nohighlight">\(\rightarrow\)</span>MO transformation is required, and steps 3 and
4 need to be run again.</p>
</li>
<li><p>Step 7: Analyze the CIPSI results.
<a class="reference internal" href="#fig14"><span class="std std-numref">Fig. 14</span></a> shows the evolution of the variational energy and the energy corrected with PT2 as a function of the number of determinants up to 4M determinants. Although it is clear that the raw variational energy is far from being converged, the Energy + PT2 appears converged around 0.4M determinants.</p></li>
</ul>
<div class="figure align-center" id="id12">
<span id="fig14"></span><a class="reference internal image-reference" href="_images/CIPSI.jpg"><img alt="_images/CIPSI.jpg" src="_images/CIPSI.jpg" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">Evolution of the variational energy and the Energy + PT2 as a function
of the number of determinants for the <span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span> molecule.</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</div>
<ul>
<li><p>Step 8: Truncate the number of determinants.
Although using all the 4M determinants from CIPSI always guarantees that
all important determinants are kept in the wavefunction, practically,
such a large number of determinants would make any QMC calculation
prohibitively expensive because the cost of evaluating a determinant in
DMC grows as <span class="math notranslate nohighlight">\(\sqrt[]{N_{det}}\)</span>, where <span class="math notranslate nohighlight">\(N_{det}\)</span> is the
number of determinants in the trial wavefunction. To truncate the number
of determinants, we follow the method described by Scemama et
al. <a class="bibtex reference internal" href="#scemama2018" id="id10">[SGCL0]</a> where the wavefunction is truncated
by independently removing spin-up and spin-down determinants whose
contribution to the norm of the wavefunction is below a user-defined
threshold, <span class="math notranslate nohighlight">\(\epsilon\)</span>. For this step, we choose to truncate the
determinants whose coefficients are below, <span class="math notranslate nohighlight">\(1.10^{-3}\)</span>,
<span class="math notranslate nohighlight">\(1.10^{-4}\)</span>, <span class="math notranslate nohighlight">\(1.10^{-5}\)</span>, and <span class="math notranslate nohighlight">\(1.10^{-6}\)</span>, translating
to 239, 44539, 541380, and 908128 determinants, respectively.</p>
<p>To  truncate the determinants in QP, edit the <code class="docutils literal notranslate"><span class="pre">ezfio</span></code> file as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_edit</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span>
</pre></div>
</div>
<p>Then look for <code class="docutils literal notranslate"><span class="pre">ci\_threshold</span></code> and modify the value according to the desired threshold. Use the following run to truncate the determinants:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_run</span> <span class="n">truncate_wf_spin</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span>
</pre></div>
</div>
</li>
</ul>
<table class="docutils align-default" id="table11">
<colgroup>
<col style="width: 47%" />
<col style="width: 26%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>N_det</p></th>
<th class="head"><p>Energy</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Hartree-Fock</p></td>
<td><p>1</p></td>
<td><p>-281.6729</p></td>
</tr>
<tr class="row-odd"><td><p>Natural orbitals</p></td>
<td><p>1</p></td>
<td><p>-281.6735</p></td>
</tr>
<tr class="row-even"><td><p>E_Variational</p></td>
<td><p>438,753</p></td>
<td><p>-282.2951</p></td>
</tr>
<tr class="row-odd"><td><p>E_Variational</p></td>
<td><p>4,068,271</p></td>
<td><p>-282.4882</p></td>
</tr>
<tr class="row-even"><td><p>E+PT2</p></td>
<td><p>438,753</p></td>
<td><p>-282.6809</p></td>
</tr>
<tr class="row-odd"><td><p>E+PT2</p></td>
<td><p>4,068,271</p></td>
<td><p>-282.6805</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong><a class="reference internal" href="#table11"><span class="std std-numref">Table 11</span></a> Energies of <span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span> using orbitals from
Hartree-Fock, natural orbitals, and 0.4M and 4M determinants</strong></p><ul>
<li><p>Save the wavefunction for QMCPACK.
The wavefunction in QP is now ready to be converted to QMCPACK format.
Save the wavefunction into QMCPACK format and then convert the wavefunction using the <code class="docutils literal notranslate"><span class="pre">convert4qmc</span></code> tool.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qp_run</span> <span class="n">save_for_qmcpack</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">ezfio</span> <span class="o">&amp;&gt;</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">dump</span>
<span class="n">convert4qmc</span> <span class="o">-</span><span class="n">QP</span> <span class="n">C2O2H3N</span><span class="o">.</span><span class="n">dump</span> <span class="o">-</span><span class="n">addCusp</span> <span class="o">-</span><span class="n">production</span>
</pre></div>
</div>
<p>Since we are running all-electron calculations, orbitals in QMC need
to be corrected for the electron-nuclearcusp condition.  This is done
by adding the option <code class="docutils literal notranslate"><span class="pre">-addCusp</span></code> to <code class="docutils literal notranslate"><span class="pre">convert4qmc</span></code>, which
adds a tag forcing QMCPACK to run the correction or read them from a
file if pre-computed. When running multiple DMC runs with different
truncation thresholds, only the number of determinants is varied and
the orbitals remain unchanged from one calculation to another and the
cusp correction needs to be run only once.</p>
</li>
<li><p>Step 10: Run QMCPACK.
At this point, running a multideterminant DMC becomes identical to running a regular DMC with QMCPACK;
After correcting the orbitals for the cusp, optimize the Jastrow functions and then run the DMC. It is important, however, to note a few items:</p>
<ol class="arabic simple">
<li><p>QMCPACK allows reoptimization of the coefficients of the
determinants during the Jastrow optimization step. Although this has
proven to lower the energy significantly when the number of
determinants is below 10k, a large number of determinants from CIPSI
is often too large to optimize conveniently. Keeping the coefficients
of the determinants from CIPSI unoptimized is an alternative strategy.</p></li>
<li><p>The large determinant expansion and the Jastrows are both trying
to recover the missing correlations from the system. When optimizing
the Jastrows, we recommend first optimizing J1 and J2 without the J3,
and then with the added J3. Trying to initially optimize J1, J2, and J3
at the same time could lead to numerical instabilities.</p></li>
<li><p>The parameters of the Jastrow function will need to be optimized
for each truncation scheme and usually cannot be reused efficiently
from one truncation scheme to another.</p></li>
</ol>
</li>
<li><p>Step 11: Analyze the DMC results from QMCPACK.
From <a class="reference internal" href="#table12"><span class="std std-numref">Table 12</span></a>, we can see that increasing the number
of determinants from 0.5M to almost 1M keeps the energy
within error bars and does not improve the quality of the nodal
surface. We can conclude that the DMC energy is converged at 0.54M
determinants. Note that this number of determinants
also corresponds to the convergence of E+PT2 in CIPSI calculations,
confirming for this case that the convergence of the nodal surface can
follow the convergence of E+PT2 instead of the more difficult
variational energy.</p></li>
</ul>
<table class="docutils align-default" id="table12">
<colgroup>
<col style="width: 24%" />
<col style="width: 45%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>N_det</p></th>
<th class="head"><p>DMC</p></th>
<th class="head"><p>CISPI</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>-283.0696 (6)</p></td>
<td><p>-283.0063</p></td>
</tr>
<tr class="row-odd"><td><p>239</p></td>
<td><p>-283.0730 (9)</p></td>
<td><p>-282.9063</p></td>
</tr>
<tr class="row-even"><td><p>44,539</p></td>
<td><p>-283.078 (1)</p></td>
<td><p>-282.7339</p></td>
</tr>
<tr class="row-odd"><td><p>541,380</p></td>
<td><p>-283.088 (1)</p></td>
<td><p>-282.6772</p></td>
</tr>
<tr class="row-even"><td><p>908,128</p></td>
<td><p>-283.089 (1)</p></td>
<td><p>-282.6775</p></td>
</tr>
</tbody>
</table>
<p class="centered">
<strong>Table 12 DMC Energies and CIPSI(E+PT2) of <span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span> in
function of the number of determinants in the trial wavefunction.</strong></p><p>As mentioned in previous sections, DMC is variational relative to the
exact nodal surface. A nodal surface is “better” if it lowers DMC
energy. To assess the quality of the nodal surface from CIPSI, we
compare these DMC results to other single-determinant calculations from
multiple nodal surfaces and theories. <a class="reference internal" href="#fig15"><span class="std std-numref">Fig. 15</span></a> shows
the energy of the <span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span> molecule as a function of different
single-determinant trial wavefunctions with an aug-cc-pVTZ basis set,
including Hartree-Fock, DFT-PBE, and hybrid functionals B3LYP and PBE0.
The last four points in the plot show the systematic improvement of the
nodal surface as a function of the number of determinants.</p>
<div class="figure align-center" id="id13">
<span id="fig15"></span><a class="reference internal image-reference" href="_images/DMC-Multidet.jpg"><img alt="_images/DMC-Multidet.jpg" src="_images/DMC-Multidet.jpg" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">DMC energy of the <span class="math notranslate nohighlight">\(C_2O_2H_3N\)</span> molecule as a function of different
single-determinant trial wavefunctions with aug-ccp-VTZ basis set using
nodal surfaces from Hartree-Fock, DFT-PBE, and DFT with hybrid
functionals PBE0 and P3LYP. As indicated, the CIPSI trial wavefunction
contains 239, 44539, 514380, and 908128 determinants (D).</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</div>
<p>When the DMC-CIPSI energy is converged with respect to the number of
determinants, its nodal surface is still lower than the best SD-DMC
(B3LYP) by 6(1) mHa. When compared with CCSD(T) with the same basis set,
<span class="math notranslate nohighlight">\(E_{CCSD(T)}\)</span> is 4 mHa higher than DMC-CIPSI and 2 mHa lower than
DMC-B3LYP. Although 6 (1) mHa can seem very small, it is important to
remember that CCSD(T) cannot correctly describe multireference systems;
therefore, it is impossible to assess the correctness of the
single-determinant–DMC result, making CIPSI-DMC calculations an ideal
benchmark tool for multireference systems.</p>
<p id="bibtex-bibliography-sCI-0"><dl class="citation">
<dt class="bibtex label" id="diner1967"><span class="brackets"><a class="fn-backref" href="#id2">DMC67</a></span></dt>
<dd><p>S. Diner, J. P. Malrieu, and P. Claverie. The use of perturbation methods for the study of the effects of configuration interaction. <em>Theoretica chimica acta</em>, 8(5):390–403, 1967. <a class="reference external" href="https://doi.org/10.1007/BF00529454">doi:10.1007/BF00529454</a>.</p>
</dd>
<dt class="bibtex label" id="caffarel2013"><span class="brackets">EG13</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>,<a href="#id5">3</a>)</span></dt>
<dd><p>M. Caffarel E. Giner, A. Scemama. Using perturbatively selected configuration interaction in quantum monte carlo calculations. <em>Canadian Journal of Chemistry</em>, 91:9, 2013.</p>
</dd>
<dt class="bibtex label" id="garniron2017-1"><span class="brackets"><a class="fn-backref" href="#id9">GGMS17</a></span></dt>
<dd><p>Yann Garniron, Emmanuel Giner, Jean-Paul Malrieu, and Anthony Scemama. Alternative definition of excitation amplitudes in multi-reference state-specific coupled cluster. <em>The Journal of Chemical Physics</em>, 146(15):154107, 2017. <a class="reference external" href="https://arxiv.org/abs/https://doi.org/10.1063/1.4980034">arXiv:https://doi.org/10.1063/1.4980034</a>, <a class="reference external" href="https://doi.org/10.1063/1.4980034">doi:10.1063/1.4980034</a>.</p>
</dd>
<dt class="bibtex label" id="garniron2017-2"><span class="brackets"><a class="fn-backref" href="#id8">GSLC17</a></span></dt>
<dd><p>Yann Garniron, Anthony Scemama, Pierre-François Loos, and Michel Caffarel. Hybrid stochastic-deterministic calculation of the second-order perturbative contribution of multireference perturbation theory. <em>The Journal of Chemical Physics</em>, 147(3):034101, 2017. <a class="reference external" href="https://arxiv.org/abs/https://doi.org/10.1063/1.4992127">arXiv:https://doi.org/10.1063/1.4992127</a>, <a class="reference external" href="https://doi.org/10.1063/1.4992127">doi:10.1063/1.4992127</a>.</p>
</dd>
<dt class="bibtex label" id="nesbet1955"><span class="brackets"><a class="fn-backref" href="#id1">Nes55</a></span></dt>
<dd><p>R. K. Nesbet. Configuration interaction in orbital theories. <em>Proceedings of the Royal Society of London A: Mathematical, Physical and Engineering Sciences</em>, 230(1182):312–321, 1955. URL: <a class="reference external" href="http://rspa.royalsocietypublishing.org/content/230/1182/312">http://rspa.royalsocietypublishing.org/content/230/1182/312</a>, <a class="reference external" href="https://arxiv.org/abs/http://rspa.royalsocietypublishing.org/content/230/1182/312.full.pdf">arXiv:http://rspa.royalsocietypublishing.org/content/230/1182/312.full.pdf</a>, <a class="reference external" href="https://doi.org/10.1098/rspa.1955.0134">doi:10.1098/rspa.1955.0134</a>.</p>
</dd>
<dt class="bibtex label" id="scemama2016"><span class="brackets"><a class="fn-backref" href="#id6">SAGC16</a></span></dt>
<dd><p>Anthony Scemama, Thomas Applencourt, Emmanuel Giner, and Michel Caffarel. Quantum monte carlo with very large multideterminant wavefunctions. <em>Journal of Computational Chemistry</em>, 37(20):1866–1875, 2016. <a class="reference external" href="https://doi.org/10.1002/jcc.24382">doi:10.1002/jcc.24382</a>.</p>
</dd>
<dt class="bibtex label" id="scemama2018"><span class="brackets">SGCL0</span><span class="fn-backref">(<a href="#id7">1</a>,<a href="#id10">2</a>)</span></dt>
<dd><p>Anthony Scemama, Yann Garniron, Michel Caffarel, and Pierre-Francois Loos. Deterministic construction of nodal surfaces within quantum monte carlo: the case of fes. <em>Journal of Chemical Theory and Computation</em>, 0(ja):null, 0. <a class="reference external" href="https://arxiv.org/abs/http://dx.doi.org/10.1021/acs.jctc.7b01250">arXiv:http://dx.doi.org/10.1021/acs.jctc.7b01250</a>, <a class="reference external" href="https://doi.org/10.1021/acs.jctc.7b01250">doi:10.1021/acs.jctc.7b01250</a>.</p>
</dd>
<dt class="bibtex label" id="qp"><span class="brackets">Sce17</span></dt>
<dd><p>A. Scemamma. Quantum package. <span><a class="reference external" href="#"></a></span>https://github.com/LCPQ/quantum_package, 2013–2017.</p>
</dd>
</dl>
</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="afqmc.html" class="btn btn-neutral float-right" title="Auxiliary-Field Quantum Monte Carlo" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="LCAO.html" class="btn btn-neutral float-left" title="Periodic LCAO for Solids" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, QMCPACK Developers

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>